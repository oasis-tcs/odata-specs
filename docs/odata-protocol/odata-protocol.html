<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <meta name="description" content="The Open Data Protocol (OData) enables the creation of REST-based data services, which allow resources, identified using Uniform Resource Locators (URLs) and defined in an Entity Data Model (EDM), to be published and edited by Web clients using simple HTTP messages. This document defines the core semantics and facilities of the protocol." />
  <title>OData Version 4.02. Part 1: Protocol</title>
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    /* The extra [class] is a hack that increases specificity enough to
       override a similar rule in reveal.js */
    ul.task-list[class]{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      font-size: inherit;
      width: 0.8em;
      margin: 0 0.8em 0.2em -1.6em;
      vertical-align: middle;
    }
    /* CSS for syntax highlighting */
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      {   }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span.al { color: #ff0000; font-weight: bold; } /* Alert */
    code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
    code span.at { color: #7d9029; } /* Attribute */
    code span.bn { color: #40a070; } /* BaseN */
    code span.bu { color: #008000; } /* BuiltIn */
    code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #4070a0; } /* Char */
    code span.cn { color: #880000; } /* Constant */
    code span.co { color: #60a0b0; font-style: italic; } /* Comment */
    code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
    code span.do { color: #ba2121; font-style: italic; } /* Documentation */
    code span.dt { color: #902000; } /* DataType */
    code span.dv { color: #40a070; } /* DecVal */
    code span.er { color: #ff0000; font-weight: bold; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #40a070; } /* Float */
    code span.fu { color: #06287e; } /* Function */
    code span.im { color: #008000; font-weight: bold; } /* Import */
    code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
    code span.kw { color: #007020; font-weight: bold; } /* Keyword */
    code span.op { color: #666666; } /* Operator */
    code span.ot { color: #007020; } /* Other */
    code span.pp { color: #bc7a00; } /* Preprocessor */
    code span.sc { color: #4070a0; } /* SpecialChar */
    code span.ss { color: #bb6688; } /* SpecialString */
    code span.st { color: #4070a0; } /* String */
    code span.va { color: #19177c; } /* Variable */
    code span.vs { color: #4070a0; } /* VerbatimString */
    code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
  </style>
  <link rel="stylesheet" href="styles/markdown-styles-v1.7.3b.css" />
  <link rel="stylesheet" href="styles/odata.css" />
  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>
</head>
<body>
<p><img src="https://docs.oasis-open.org/templates/OASISLogo-v3.0.png" alt="OASIS Logo" /></p>
<hr />
<h1 id="odata-version-402-part-1-protocol">OData Version 4.02. Part 1: Protocol</h1>
<h2 id="committee-specification-draft-02">Committee Specification Draft 02</h2>
<details open><summary>
<h2 id="28-february-2024">28 February 2024</h2>
</summary>
<p><span class="math inline">\(\hbox{}\)</span></p>
<h4 id="this-stage">This stage:</h4>
<p><a href="https://docs.oasis-open.org/odata/odata/v4.02/csd02/part1-protocol/odata-v4.02-csd02-part1-protocol.md">https://docs.oasis-open.org/odata/odata/v4.02/csd02/part1-protocol/odata-v4.02-csd02-part1-protocol.md</a> (Authoritative)<br />
<a href="https://docs.oasis-open.org/odata/odata/v4.02/csd02/part1-protocol/odata-v4.02-csd02-part1-protocol.html">https://docs.oasis-open.org/odata/odata/v4.02/csd02/part1-protocol/odata-v4.02-csd02-part1-protocol.html</a><br />
<a href="https://docs.oasis-open.org/odata/odata/v4.02/csd02/part1-protocol/odata-v4.02-csd02-part1-protocol.pdf">https://docs.oasis-open.org/odata/odata/v4.02/csd02/part1-protocol/odata-v4.02-csd02-part1-protocol.pdf</a></p>
<h4 id="previous-stage">Previous stage:</h4>
<p><a href="https://docs.oasis-open.org/odata/odata/v4.02/csd01/part1-protocol/odata-v4.02-csd01-part1-protocol.md">https://docs.oasis-open.org/odata/odata/v4.02/csd01/part1-protocol/odata-v4.02-csd01-part1-protocol.md</a> (Authoritative)<br />
<a href="https://docs.oasis-open.org/odata/odata/v4.02/csd01/part1-protocol/odata-v4.02-csd01-part1-protocol.html">https://docs.oasis-open.org/odata/odata/v4.02/csd01/part1-protocol/odata-v4.02-csd01-part1-protocol.html</a><br />
<a href="https://docs.oasis-open.org/odata/odata/v4.02/csd01/part1-protocol/odata-v4.02-csd01-part1-protocol.pdf">https://docs.oasis-open.org/odata/odata/v4.02/csd01/part1-protocol/odata-v4.02-csd01-part1-protocol.pdf</a></p>
<h4 id="latest-stage">Latest stage:</h4>
<p><a href="https://docs.oasis-open.org/odata/odata/v4.02/odata-v4.02-part1-protocol.md">https://docs.oasis-open.org/odata/odata/v4.02/odata-v4.02-part1-protocol.md</a> (Authoritative)<br />
<a href="https://docs.oasis-open.org/odata/odata/v4.02/odata-v4.02-part1-protocol.html">https://docs.oasis-open.org/odata/odata/v4.02/odata-v4.02-part1-protocol.html</a><br />
<a href="https://docs.oasis-open.org/odata/odata/v4.02/odata-v4.02-part1-protocol.pdf">https://docs.oasis-open.org/odata/odata/v4.02/odata-v4.02-part1-protocol.pdf</a></p>
<h4 id="technical-committee">Technical Committee:</h4>
<p><a href="https://www.oasis-open.org/committees/odata/">OASIS Open Data Protocol (OData) TC</a></p>
<h4 id="chairs">Chairs:</h4>
<p>Ralf Handl (<a href="mailto:ralf.handl@sap.com">ralf.handl@sap.com</a>), <a href="http://www.sap.com/">SAP SE</a><br />
Michael Pizzo (<a href="mailto:mikep@microsoft.com">mikep@microsoft.com</a>), <a href="http://www.microsoft.com/">Microsoft</a></p>
<h4 id="editors">Editors:</h4>
<p>Michael Pizzo (<a href="mailto:mikep@microsoft.com">mikep@microsoft.com</a>), <a href="http://www.microsoft.com/">Microsoft</a><br />
Ralf Handl (<a href="mailto:ralf.handl@sap.com">ralf.handl@sap.com</a>), <a href="http://www.sap.com/">SAP SE</a><br />
Heiko Thei√üen (<a href="mailto:heiko.theissen@sap.com">heiko.theissen@sap.com</a>), <a href="http://www.sap.com/">SAP SE</a></p>
<h4 id="additional-artifacts">Additional artifacts:</h4>
<p>This prose specification is one component of a Work Product that also includes:</p>
<ul>
<li><em>OData Version 4.02 Part 1: Protocol</em> (this document). <a href="https://docs.oasis-open.org/odata/odata/v4.02/csd02/part1-protocol/odata-v4.02-csd02-part1-protocol.html">https://docs.oasis-open.org/odata/odata/v4.02/csd02/part1-protocol/odata-v4.02-csd02-part1-protocol.html</a></li>
<li><em>OData Version 4.02 Part 2: URL Conventions</em>. <a href="https://docs.oasis-open.org/odata/odata/v4.02/csd02/part2-url-conventions/odata-v4.02-csd02-part2-url-conventions.html">https://docs.oasis-open.org/odata/odata/v4.02/csd02/part2-url-conventions/odata-v4.02-csd02-part2-url-conventions.html</a></li>
<li>ABNF components: <em>OData ABNF Construction Rules Version 4.02 and OData ABNF Test Cases Version 4.02</em>. <a href="https://docs.oasis-open.org/odata/odata/v4.02/csd02/abnf/">https://docs.oasis-open.org/odata/odata/v4.02/csd02/abnf/</a>.</li>
</ul>
<h4 id="related-work"><a name="RelatedWork">Related work:</a></h4>
<p>This specification replaces or supersedes:</p>
<ul>
<li><em>OData Version 4.01. Part 1: Protocol</em>. Edited by Michael Pizzo, Ralf Handl, and Martin Zurmuehl. OASIS Standard. Latest stage: <a href="https://docs.oasis-open.org/odata/odata/v4.01/odata-v4.01-part1-protocol.html">https://docs.oasis-open.org/odata/odata/v4.01/odata-v4.01-part1-protocol.html</a></li>
<li><em>OData Version 4.0. Part 1: Protocol</em>. Edited by Michael Pizzo, Ralf Handl, and Martin Zurmuehl. OASIS Standard. Latest stage: <a href="http://docs.oasis-open.org/odata/odata/v4.0/odata-v4.0-part1-protocol.html">http://docs.oasis-open.org/odata/odata/v4.0/odata-v4.0-part1-protocol.html</a></li>
</ul>
<p>This specification is related to:</p>
<ul>
<li><em>OData Vocabularies Version 4.0</em>. Edited by Michael Pizzo, Ralf Handl, and Ram Jeyaraman. Latest stage: <a href="https://docs.oasis-open.org/odata/odata-vocabularies/v4.0/odata-vocabularies-v4.0.html">https://docs.oasis-open.org/odata/odata-vocabularies/v4.0/odata-vocabularies-v4.0.html</a></li>
<li><em>OData Common Schema Definition Language (CSDL) JSON Representation Version 4.02</em>. Edited by Michael Pizzo, Ralf Handl, and Heiko Thei√üen. Latest stage: <a href="https://docs.oasis-open.org/odata/odata-csdl-json/v4.02/odata-csdl-json-v4.02.html">https://docs.oasis-open.org/odata/odata-csdl-json/v4.02/odata-csdl-json-v4.02.html</a></li>
<li><em>OData Common Schema Definition Language (CSDL) XML Representation Version 4.02</em>. Edited by Michael Pizzo, Ralf Handl, and Heiko Thei√üen. Latest stage: <a href="https://docs.oasis-open.org/odata/odata-csdl-xml/v4.02/odata-csdl-xml-v4.02.html">https://docs.oasis-open.org/odata/odata-csdl-xml/v4.02/odata-csdl-xml-v4.02.html</a></li>
<li><em>OData JSON Format Version 4.02</em>. Edited by Michael Pizzo, Ralf Handl, and Heiko Thei√üen. Latest stage: <a href="https://docs.oasis-open.org/odata/odata-json-format/v4.02/odata-json-format-v4.02.html">https://docs.oasis-open.org/odata/odata-json-format/v4.02/odata-json-format-v4.02.html</a></li>
<li><em>OData Data Aggregation Extension Version 4.0</em>. Edited by Ralf Handl, Hubert Heijkers, Gerald Krause, Michael Pizzo, Heiko Thei√üen, and Martin Zurmuehl. Latest stage: <a href="https://docs.oasis-open.org/odata/odata-data-aggregation-ext/v4.0/odata-data-aggregation-ext-v4.0.html">https://docs.oasis-open.org/odata/odata-data-aggregation-ext/v4.0/odata-data-aggregation-ext-v4.0.html</a></li>
<li><em>OData Extension for Temporal Data Version 4.0</em>. Edited by Ralf Handl, Hubert Heijkers, Gerald Krause, Michael Pizzo, Heiko Thei√üen, and Martin Zurmuehl. Latest stage: <a href="https://docs.oasis-open.org/odata/odata-temporal-ext/v4.0/odata-temporal-ext-v4.0.html">https://docs.oasis-open.org/odata/odata-temporal-ext/v4.0/odata-temporal-ext-v4.0.html</a></li>
</ul>
<h4 id="abstract">Abstract:</h4>
<p>The Open Data Protocol (OData) enables the creation of REST-based data services, which allow resources, identified using Uniform Resource Locators (URLs) and defined in an Entity Data Model (EDM), to be published and edited by Web clients using simple HTTP messages. This document defines the core semantics and facilities of the protocol.</p>
<h4 id="status">Status:</h4>
<p>This document was last revised or approved by the OASIS Open Data Protocol (OData) TC on the above date. The level of approval is also listed above. Check the ‚ÄúLatest stage‚Äù location noted above for possible later revisions of this document. Any other numbered Versions and other technical work produced by the Technical Committee (TC) are listed at <a href="https://groups.oasis-open.org/communities/tc-community-home2?CommunityKey=e7cac2a9-2d18-4640-b94d-018dc7d3f0e2#technical">https://groups.oasis-open.org/communities/tc-community-home2?CommunityKey=e7cac2a9-2d18-4640-b94d-018dc7d3f0e2#technical</a>.</p>
<p>TC members should send comments on this specification to the TC‚Äôs email list. Any individual may submit comments to the TC by sending email to <a href="mailto:Technical-Committee-Comments@oasis-open.org">Technical-Committee-Comments@oasis-open.org</a>. Please use a Subject line like ‚ÄúComment on OData Protocol‚Äù.</p>
<p>This specification is provided under the <a href="https://www.oasis-open.org/policies-guidelines/ipr/#RF-on-RAND-Mode">RF on RAND Terms Mode</a> of the <a href="https://www.oasis-open.org/policies-guidelines/ipr/">OASIS IPR Policy</a>, the mode chosen when the Technical Committee was established. For information on whether any patents have been disclosed that may be essential to implementing this specification, and any offers of patent licensing terms, please refer to the Intellectual Property Rights section of the TC‚Äôs web page (<a href="https://www.oasis-open.org/committees/odata/ipr.php">https://www.oasis-open.org/committees/odata/ipr.php</a>).</p>
<p>Note that any machine-readable content (<a href="https://www.oasis-open.org/policies-guidelines/tc-process-2017-05-26/#wpComponentsCompLang">Computer Language Definitions</a>) declared Normative for this Work Product is provided in separate plain text files. In the event of a discrepancy between any such plain text file and display content in the Work Product‚Äôs prose narrative document(s), the content in the separate plain text file prevails.</p>
<h4 id="key-words">Key words:</h4>
<p>The key words ‚ÄúMUST‚Äù, ‚ÄúMUST NOT‚Äù, ‚ÄúREQUIRED‚Äù, ‚ÄúSHALL‚Äù, ‚ÄúSHALL NOT‚Äù, ‚ÄúSHOULD‚Äù, ‚ÄúSHOULD NOT‚Äù, ‚ÄúRECOMMENDED‚Äù, ‚ÄúNOT RECOMMENDED‚Äù, ‚ÄúMAY‚Äù, and ‚ÄúOPTIONAL‚Äù in this document are to be interpreted as described in BCP 14 <a href="#rfc2119">RFC2119</a> and <a href="#rfc8174">RFC8174</a> when, and only when, they appear in all capitals, as shown here.</p>
<h4 id="citation-format">Citation format:</h4>
<p>When referencing this specification the following citation format should be used:</p>
<p><strong>[OData-v4.02-Part1]</strong></p>
<p><em>OData Version 4.02. Part 1: Protocol</em>. Edited by Michael Pizzo, Ralf Handl, and Heiko Thei√üen. 28 February 2024. OASIS Committee Specification Draft 02. <a href="https://docs.oasis-open.org/odata/odata/v4.02/csd02/odata-v4.02-csd02-part1-protocol.html">https://docs.oasis-open.org/odata/odata/v4.02/csd02/odata-v4.02-csd02-part1-protocol.html</a>. Latest stage: <a href="https://docs.oasis-open.org/odata/odata/v4.02/odata-v4.02-part1-protocol.html">https://docs.oasis-open.org/odata/odata/v4.02/odata-v4.02-part1-protocol.html</a>.</p>
<h4 id="notices">Notices</h4>
<p>Copyright ¬© OASIS Open 2024. All Rights Reserved.</p>
<p>Distributed under the terms of the OASIS <a href="https://www.oasis-open.org/policies-guidelines/ipr/">IPR Policy</a>.</p>
<p>The name ‚ÄúOASIS‚Äù is a trademark of <a href="https://www.oasis-open.org/">OASIS</a>, the owner and developer of this specification, and should be used only to refer to the organization and its official outputs.</p>
<p>For complete copyright information please see the full Notices section in an Appendix below.</p>
</details>
</details>
<hr />
<details open><summary>
<h1 id="table-of-contents">Table of Contents</h1>
</summary>
<div class="toc">
<ul>
<li><a href="#Introduction">1 Introduction</a>
<ul>
<li><a href="#ChangesfromEarlierVersions">1.1 Changes from Earlier Versions</a></li>
<li><a href="#Glossary">1.2 Glossary</a>
<ul>
<li><a href="#DefinitionsofTerms">1.2.1 Definitions of Terms</a></li>
<li><a href="#AcronymsandAbbreviations">1.2.2 Acronyms and Abbreviations</a></li>
<li><a href="#DocumentConventions">1.2.3 Document Conventions</a></li>
</ul></li>
</ul></li>
<li><a href="#Overview">2 Overview</a></li>
<li><a href="#DataModel">3 Data Model</a>
<ul>
<li><a href="#Annotations">3.1 Annotations</a></li>
</ul></li>
<li><a href="#ServiceModel">4 Service Model</a>
<ul>
<li><a href="#EntityIdsandEntityReferences">4.1 Entity-Ids and Entity References</a></li>
<li><a href="#ReadURLsandEditURLs">4.2 Read URLs and Edit URLs</a></li>
<li><a href="#TransientEntities">4.3 Transient Entities</a></li>
<li><a href="#DefaultNamespaces">4.4 Default Namespaces</a></li>
</ul></li>
<li><a href="#Versioning">5 Versioning</a>
<ul>
<li><a href="#ProtocolVersioning">5.1 Protocol Versioning</a></li>
<li><a href="#ModelVersioning">5.2 Model Versioning</a></li>
</ul></li>
<li><a href="#Extensibility">6 Extensibility</a>
<ul>
<li><a href="#QueryOptionExtensibility">6.1 Query Option Extensibility</a></li>
<li><a href="#PayloadExtensibility">6.2 Payload Extensibility</a></li>
<li><a href="#ActionFunctionExtensibility">6.3 Action/Function Extensibility</a></li>
<li><a href="#VocabularyExtensibility">6.4 Vocabulary Extensibility</a></li>
<li><a href="#HeaderFieldExtensibility">6.5 Header Field Extensibility</a></li>
<li><a href="#FormatExtensibility">6.6 Format Extensibility</a></li>
</ul></li>
<li><a href="#Formats">7 Formats</a></li>
<li><a href="#HeaderFields">8 Header Fields</a>
<ul>
<li><a href="#CommonHeaders">8.1 Common Headers</a>
<ul>
<li><a href="#HeaderContentType">8.1.1 Header <code>Content-Type</code></a></li>
<li><a href="#HeaderContentEncoding">8.1.2 Header <code>Content-Encoding</code></a></li>
<li><a href="#HeaderContentLanguage">8.1.3 Header <code>Content-Language</code></a></li>
<li><a href="#HeaderContentLength">8.1.4 Header <code>Content-Length</code></a></li>
<li><a href="#HeaderODataVersion">8.1.5 Header <code>OData-Version</code></a></li>
</ul></li>
<li><a href="#RequestHeaders">8.2 Request Headers</a>
<ul>
<li><a href="#HeaderAccept">8.2.1 Header <code>Accept</code></a></li>
<li><a href="#HeaderAcceptCharset">8.2.2 Header <code>Accept-Charset</code></a></li>
<li><a href="#HeaderAcceptLanguage">8.2.3 Header <code>Accept-Language</code></a></li>
<li><a href="#HeaderIfMatch">8.2.4 Header <code>If-Match</code></a></li>
<li><a href="#HeaderIfNoneMatch">8.2.5 Header <code>If-None-Match</code></a></li>
<li><a href="#HeaderIsolationODataIsolation">8.2.6 Header <code>Isolation</code> (<code>OData-Isolation</code>)</a></li>
<li><a href="#HeaderODataMaxVersion">8.2.7 Header <code>OData-MaxVersion</code></a></li>
<li><a href="#HeaderPrefer">8.2.8 Header <code>Prefer</code></a>
<ul>
<li><a href="#Preferenceallowentityreferencesodataallowentityreferences">8.2.8.1 Preference <code>allow-entityreferences</code> (<code>odata.allow-entityreferences</code>)</a></li>
<li><a href="#Preferencecallbackodatacallback">8.2.8.2 Preference <code>callback</code> (<code>odata.callback</code>)</a></li>
<li><a href="#Preferencecontinueonerrorodatacontinueonerror">8.2.8.3 Preference <code>continue-on-error</code> (<code>odata.continue-on-error</code>)</a></li>
<li><a href="#Preferenceincludeannotationsodataincludeannotations">8.2.8.4 Preference <code>include-annotations</code> (<code>odata.include-annotations</code>)</a></li>
<li><a href="#Preferencemaxpagesizeodatamaxpagesize">8.2.8.5 Preference <code>maxpagesize</code> (<code>odata.maxpagesize</code>)</a></li>
<li><a href="#Preferenceomitvalues">8.2.8.6 Preference <code>omit-values</code></a></li>
<li><a href="#Preferencereturnrepresentationandreturnminimal">8.2.8.7 Preference <code>return=representation</code> and <code>return=minimal</code></a></li>
<li><a href="#Preferencerespondasync">8.2.8.8 Preference <code>respond-async</code></a></li>
<li><a href="#Preferencetrackchangesodatatrackchanges">8.2.8.9 Preference <code>track-changes</code> (<code>odata.track-changes</code>)</a></li>
<li><a href="#Preferencewait">8.2.8.10 Preference <code>wait</code></a></li>
</ul></li>
</ul></li>
<li><a href="#ResponseHeaders">8.3 Response Headers</a>
<ul>
<li><a href="#HeaderAsyncResult">8.3.1 Header <code>AsyncResult</code></a></li>
<li><a href="#HeaderETag">8.3.2 Header <code>ETag</code></a></li>
<li><a href="#HeaderLocation">8.3.3 Header <code>Location</code></a></li>
<li><a href="#HeaderODataEntityId">8.3.4 Header <code>OData-EntityId</code></a></li>
<li><a href="#HeaderODataError">8.3.5 Header <code>OData-Error</code></a></li>
<li><a href="#HeaderPreferenceApplied">8.3.6 Header <code>Preference-Applied</code></a></li>
<li><a href="#HeaderRetryAfter">8.3.7 Header <code>Retry-After</code></a></li>
<li><a href="#HeaderVary">8.3.8 Header <code>Vary</code></a></li>
</ul></li>
</ul></li>
<li><a href="#CommonResponseStatusCodes">9 Common Response Status Codes</a>
<ul>
<li><a href="#SuccessResponses">9.1 Success Responses</a>
<ul>
<li><a href="#ResponseCode200OK">9.1.1 Response Code <code>200 OK</code></a></li>
<li><a href="#ResponseCode201Created">9.1.2 Response Code <code>201 Created</code></a></li>
<li><a href="#ResponseCode202Accepted">9.1.3 Response Code <code>202 Accepted</code></a></li>
<li><a href="#ResponseCode204NoContent">9.1.4 Response Code <code>204 No Content</code></a></li>
<li><a href="#ResponseCode3xxRedirection">9.1.5 Response Code <code>3xx Redirection</code></a></li>
<li><a href="#ResponseCode304NotModified">9.1.6 Response Code <code>304 Not Modified</code></a></li>
</ul></li>
<li><a href="#ClientErrorResponses">9.2 Client Error Responses</a>
<ul>
<li><a href="#ResponseCode404NotFound">9.2.1 Response Code <code>404 Not Found</code></a></li>
<li><a href="#ResponseCode405MethodNotAllowed">9.2.2 Response Code <code>405 Method Not Allowed</code></a></li>
<li><a href="#ResponseCode406NotAcceptable">9.2.3 Response Code <code>406 Not Acceptable</code></a></li>
<li><a href="#ResponseCode410Gone">9.2.4 Response Code <code>410 Gone</code></a></li>
<li><a href="#ResponseCode412PreconditionFailed">9.2.5 Response Code <code>412 Precondition Failed</code></a></li>
<li><a href="#ResponseCode424FailedDependency">9.2.6 Response Code <code>424 Failed Dependency</code></a></li>
</ul></li>
<li><a href="#ServerErrorResponses">9.3 Server Error Responses</a>
<ul>
<li><a href="#ResponseCode501NotImplemented">9.3.1 Response Code <code>501 Not Implemented</code></a></li>
</ul></li>
<li><a href="#ErrorResponseBody">9.4 Error Response Body</a></li>
<li><a href="#InStreamErrors">9.5 In-Stream Errors</a></li>
</ul></li>
<li><a href="#ContextURL">10 Context URL</a>
<ul>
<li><a href="#ServiceDocument">10.1 Service Document</a></li>
<li><a href="#CollectionofEntities">10.2 Collection of Entities</a></li>
<li><a href="#Entity">10.3 Entity</a></li>
<li><a href="#Singleton">10.4 Singleton</a></li>
<li><a href="#CollectionofDerivedEntities">10.5 Collection of Derived Entities</a></li>
<li><a href="#DerivedEntity">10.6 Derived Entity</a></li>
<li><a href="#CollectionofProjectedEntities">10.7 Collection of Projected Entities</a></li>
<li><a href="#ProjectedEntity">10.8 Projected Entity</a></li>
<li><a href="#CollectionofExpandedEntities">10.9 Collection of Expanded Entities</a></li>
<li><a href="#ExpandedEntity">10.10 Expanded Entity</a></li>
<li><a href="#CollectionofEntityReferences">10.11 Collection of Entity References</a></li>
<li><a href="#EntityReference">10.12 Entity Reference</a></li>
<li><a href="#PropertyValue">10.13 Property Value</a></li>
<li><a href="#CollectionofComplexorPrimitiveTypes">10.14 Collection of Complex or Primitive Types</a></li>
<li><a href="#ComplexorPrimitiveType">10.15 Complex or Primitive Type</a></li>
<li><a href="#OperationResult">10.16 Operation Result</a></li>
<li><a href="#DeltaPayloadResponse">10.17 Delta Payload Response</a></li>
<li><a href="#IteminaDeltaPayloadResponse">10.18 Item in a Delta Payload Response</a></li>
<li><a href="#allResponse">10.19 <code>$all</code> Response</a></li>
<li><a href="#crossjoinResponse">10.20 <code>$crossjoin</code> Response</a></li>
</ul></li>
<li><a href="#DataServiceRequests">11 Data Service Requests</a>
<ul>
<li><a href="#MetadataRequests">11.1 Metadata Requests</a>
<ul>
<li><a href="#ServiceDocumentRequest">11.1.1 Service Document Request</a></li>
<li><a href="#MetadataDocumentRequest">11.1.2 Metadata Document Request</a></li>
</ul></li>
<li><a href="#RequestingData">11.2 Requesting Data</a>
<ul>
<li><a href="#SystemQueryOptions">11.2.1 System Query Options</a></li>
<li><a href="#RequestingIndividualEntities">11.2.2 Requesting Individual Entities</a></li>
<li><a href="#RequestingtheMediaStreamofaMediaEntityusingvalue">11.2.3 Requesting the Media Stream of a Media Entity using <code>$value</code></a></li>
<li><a href="#RequestingIndividualProperties">11.2.4 Requesting Individual Properties</a>
<ul>
<li><a href="#RequestingStreamProperties">11.2.4.1 Requesting Stream Properties</a></li>
<li><a href="#RequestingaRawValueusingvalue">11.2.4.2 Requesting a Raw Value using <code>$value</code></a></li>
</ul></li>
<li><a href="#SpecifyingPropertiestoReturn">11.2.5 Specifying Properties to Return</a>
<ul>
<li><a href="#SystemQueryOptionselect">11.2.5.1 System Query Option <code>$select</code></a></li>
<li><a href="#SystemQueryOptionexpand">11.2.5.2 System Query Option <code>$expand</code></a>
<ul>
<li><a href="#ExpandOptions">11.2.5.2.1 Expand Options</a>
<ul>
<li><a href="#ExpandOptionlevels">11.2.5.2.1.1 Expand Option <code>$levels</code></a></li>
</ul></li>
</ul></li>
<li><a href="#SystemQueryOptioncompute">11.2.5.3 System Query Option <code>$compute</code></a></li>
</ul></li>
<li><a href="#QueryingCollections">11.2.6 Querying Collections</a>
<ul>
<li><a href="#SystemQueryOptionfilter">11.2.6.1 System Query Option <code>$filter</code></a>
<ul>
<li><a href="#BuiltinFilterOperations">11.2.6.1.1 Built-in Filter Operations</a></li>
<li><a href="#BuiltinQueryFunctions">11.2.6.1.2 Built-in Query Functions</a></li>
<li><a href="#ParameterAliases">11.2.6.1.3 Parameter Aliases</a></li>
</ul></li>
<li><a href="#SystemQueryOptionorderby">11.2.6.2 System Query Option <code>$orderby</code></a></li>
<li><a href="#SystemQueryOptiontop">11.2.6.3 System Query Option <code>$top</code></a></li>
<li><a href="#SystemQueryOptionskip">11.2.6.4 System Query Option <code>$skip</code></a></li>
<li><a href="#SystemQueryOptioncount">11.2.6.5 System Query Option <code>$count</code></a></li>
<li><a href="#SystemQueryOptionsearch">11.2.6.6 System Query Option <code>$search</code></a></li>
<li><a href="#ServerDrivenPaging">11.2.6.7 Server-Driven Paging</a></li>
<li><a href="#RequestinganIndividualMemberofanOrderedCollection">11.2.6.8 Requesting an Individual Member of an Ordered Collection</a></li>
</ul></li>
<li><a href="#RequestingRelatedEntities">11.2.7 Requesting Related Entities</a></li>
<li><a href="#RequestingEntityReferences">11.2.8 Requesting Entity References</a></li>
<li><a href="#ResolvinganEntityId">11.2.9 Resolving an Entity-Id</a></li>
<li><a href="#RequestingtheNumberofItemsinaCollection">11.2.10 Requesting the Number of Items in a Collection</a></li>
<li><a href="#SystemQueryOptionformat">11.2.11 System Query Option <code>$format</code></a></li>
<li><a href="#SystemQueryOptionschemaversion">11.2.12 System Query Option <code>$schemaversion</code></a></li>
</ul></li>
<li><a href="#RequestingChanges">11.3 Requesting Changes</a>
<ul>
<li><a href="#DeltaLinks">11.3.1 Delta Links</a></li>
<li><a href="#UsingDeltaLinks">11.3.2 Using Delta Links</a></li>
<li><a href="#DeltaPayloads">11.3.3 Delta Payloads</a></li>
</ul></li>
<li><a href="#DataModification">11.4 Data Modification</a>
<ul>
<li><a href="#CommonDataModificationSemantics">11.4.1 Common Data Modification Semantics</a>
<ul>
<li><a href="#UseofETagsforAvoidingUpdateConflicts">11.4.1.1 Use of ETags for Avoiding Update Conflicts</a></li>
<li><a href="#HandlingofDateTimeOffsetValues">11.4.1.2 Handling of DateTimeOffset Values</a></li>
<li><a href="#HandlingofPropertiesNotAdvertisedinMetadata">11.4.1.3 Handling of Properties Not Advertised in Metadata</a></li>
<li><a href="#HandlingofIntegrityConstraints">11.4.1.4 Handling of Integrity Constraints</a></li>
<li><a href="#ReturningResultsfromDataModificationRequests">11.4.1.5 Returning Results from Data Modification Requests</a></li>
</ul></li>
<li><a href="#CreateanEntity">11.4.2 Create an Entity</a>
<ul>
<li><a href="#LinktoRelatedEntitiesWhenCreatinganEntity">11.4.2.1 Link to Related Entities When Creating an Entity</a></li>
<li><a href="#CreateRelatedEntitiesWhenCreatinganEntity">11.4.2.2 Create Related Entities When Creating an Entity</a></li>
</ul></li>
<li><a href="#UpdateanEntity">11.4.3 Update an Entity</a>
<ul>
<li><a href="#UpdateRelatedEntitiesWhenUpdatinganEntity">11.4.3.1 Update Related Entities When Updating an Entity</a></li>
</ul></li>
<li><a href="#UpsertanEntity">11.4.4 Upsert an Entity</a></li>
<li><a href="#DeleteanEntity">11.4.5 Delete an Entity</a></li>
<li><a href="#ModifyingRelationshipsbetweenEntities">11.4.6 Modifying Relationships between Entities</a>
<ul>
<li><a href="#AddaReferencetoaCollectionValuedNavigationProperty">11.4.6.1 Add a Reference to a Collection-Valued Navigation Property</a></li>
<li><a href="#RemoveaReferencetoanEntity">11.4.6.2 Remove a Reference to an Entity</a></li>
<li><a href="#ChangetheReferenceinaSingleValuedNavigationProperty">11.4.6.3 Change the Reference in a Single-Valued Navigation Property</a></li>
<li><a href="#ReplaceallReferencesinaCollectionValuedNavigationProperty">11.4.6.4 Replace all References in a Collection-Valued Navigation Property</a></li>
</ul></li>
<li><a href="#ManagingMediaEntities">11.4.7 Managing Media Entities</a>
<ul>
<li><a href="#CreateaMediaEntity">11.4.7.1 Create a Media Entity</a></li>
<li><a href="#UpdateaMediaEntityStream">11.4.7.2 Update a Media Entity Stream</a></li>
<li><a href="#DeleteaMediaEntity">11.4.7.3 Delete a Media Entity</a></li>
</ul></li>
<li><a href="#ManagingStreamProperties">11.4.8 Managing Stream Properties</a>
<ul>
<li><a href="#UpdateStreamValues">11.4.8.1 Update Stream Values</a></li>
<li><a href="#DeleteStreamValues">11.4.8.2 Delete Stream Values</a></li>
</ul></li>
<li><a href="#ManagingValuesandPropertiesDirectly">11.4.9 Managing Values and Properties Directly</a>
<ul>
<li><a href="#UpdateaPrimitiveProperty">11.4.9.1 Update a Primitive Property</a></li>
<li><a href="#SetaValuetoNull">11.4.9.2 Set a Value to Null</a></li>
<li><a href="#UpdateaComplexProperty">11.4.9.3 Update a Complex Property</a></li>
<li><a href="#UpdateaCollectionProperty">11.4.9.4 Update a Collection Property</a></li>
</ul></li>
<li><a href="#ManagingMembersofanOrderedCollection">11.4.10 Managing Members of an Ordered Collection</a></li>
<li><a href="#PositionalInserts">11.4.11 Positional Inserts</a></li>
<li><a href="#UpdateaCollectionofEntities">11.4.12 Update a Collection of Entities</a>
<ul>
<li><a href="#ErrorHandlingwhenUpdatingaCollectionofEntities">11.4.12.1 Error Handling when Updating a Collection of Entities</a></li>
</ul></li>
<li><a href="#ReplaceaCollectionofEntities">11.4.13 Replace a Collection of Entities</a>
<ul>
<li><a href="#ErrorHandlingwhenReplacingaCollectionofEntities">11.4.13.1 Error Handling when Replacing a Collection of Entities</a></li>
</ul></li>
<li><a href="#UpdateMembersofaCollection">11.4.14 Update Members of a Collection</a></li>
<li><a href="#DeleteMembersofaCollection">11.4.15 Delete Members of a Collection</a></li>
</ul></li>
<li><a href="#Operations">11.5 Operations</a>
<ul>
<li><a href="#BindinganOperationtoaResource">11.5.1 Binding an Operation to a Resource</a></li>
<li><a href="#ApplyinganOperationtoMembersofaCollection">11.5.2 Applying an Operation to Members of a Collection</a></li>
<li><a href="#AdvertisingAvailableOperationswithinaPayload">11.5.3 Advertising Available Operations within a Payload</a></li>
<li><a href="#Functions">11.5.4 Functions</a>
<ul>
<li><a href="#InvokingaFunction">11.5.4.1 Invoking a Function</a>
<ul>
<li><a href="#InlineParameterSyntax">11.5.4.1.1 Inline Parameter Syntax</a></li>
</ul></li>
<li><a href="#Functionoverloadresolution">11.5.4.2 Function overload resolution</a></li>
</ul></li>
<li><a href="#Actions">11.5.5 Actions</a>
<ul>
<li><a href="#InvokinganAction">11.5.5.1 Invoking an Action</a></li>
<li><a href="#ActionOverloadResolution">11.5.5.2 Action Overload Resolution</a></li>
</ul></li>
</ul></li>
<li><a href="#AsynchronousRequests">11.6 Asynchronous Requests</a></li>
<li><a href="#BatchRequests">11.7 Batch Requests</a>
<ul>
<li><a href="#BatchRequestHeaders">11.7.1 Batch Request Headers</a></li>
<li><a href="#RequestDependencies">11.7.2 Request Dependencies</a></li>
<li><a href="#IdentifyingIndividualRequests">11.7.3 Identifying Individual Requests</a></li>
<li><a href="#ReferencingReturnedEntities">11.7.4 Referencing Returned Entities</a></li>
<li><a href="#ReferencingtheETagofanEntity">11.7.5 Referencing the ETag of an Entity</a></li>
<li><a href="#ReferencingValuesfromResponseBodies">11.7.6 Referencing Values from Response Bodies</a></li>
<li><a href="#MultipartBatchFormat">11.7.7 Multipart Batch Format</a>
<ul>
<li><a href="#MultipartBatchRequestBody">11.7.7.1 Multipart Batch Request Body</a></li>
<li><a href="#ReferencingNewEntities">11.7.7.2 Referencing New Entities</a></li>
<li><a href="#ReferencinganETag">11.7.7.3 Referencing an ETag</a></li>
<li><a href="#ReferencingResponseBodyValues">11.7.7.4 Referencing Response Body Values</a></li>
<li><a href="#ProcessingaMultipartBatchRequest">11.7.7.5 Processing a Multipart Batch Request</a></li>
<li><a href="#MultipartBatchResponse">11.7.7.6 Multipart Batch Response</a></li>
<li><a href="#AsynchronousBatchRequests">11.7.7.7 Asynchronous Batch Requests</a></li>
</ul></li>
</ul></li>
</ul></li>
<li><a href="#Conformance">12 Conformance</a>
<ul>
<li><a href="#OData40ServiceConformanceLevels">12.1 OData 4.0 Service Conformance Levels</a>
<ul>
<li><a href="#OData40MinimalConformanceLevel">12.1.1 OData 4.0 Minimal Conformance Level</a></li>
<li><a href="#OData40IntermediateConformanceLevel">12.1.2 OData 4.0 Intermediate Conformance Level</a></li>
<li><a href="#OData40AdvancedConformanceLevel">12.1.3 OData 4.0 Advanced Conformance Level</a></li>
</ul></li>
<li><a href="#OData401ServiceConformanceLevels">12.2 OData 4.01 Service Conformance Levels</a>
<ul>
<li><a href="#OData401MinimalConformanceLevel">12.2.1 OData 4.01 Minimal Conformance Level</a></li>
<li><a href="#OData401IntermediateConformanceLevel">12.2.2 OData 4.01 Intermediate Conformance Level</a></li>
<li><a href="#OData401AdvancedConformanceLevel">12.2.3 OData 4.01 Advanced Conformance Level</a></li>
</ul></li>
<li><a href="#InteroperableODataClients">12.3 Interoperable OData Clients</a></li>
</ul></li>
<li><a href="#References">A References</a>
<ul>
<li><a href="#NormativeReferences">A.1 Normative References</a></li>
<li><a href="#InformativeReferences">A.2 Informative References</a></li>
</ul></li>
<li><a href="#SafetySecurityandPrivacyConsiderations">B Safety, Security and Privacy Considerations</a>
<ul>
<li><a href="#Authentication">B.1 Authentication</a></li>
</ul></li>
<li><a href="#Acknowledgments">C Acknowledgments</a>
<ul>
<li><a href="#SpecialThanks">C.1 Special Thanks</a></li>
<li><a href="#Participants">C.2 Participants</a></li>
</ul></li>
<li><a href="#RevisionHistory">D Revision History</a></li>
<li><a href="#Notices">E Notices</a></li>
</ul>
</div>
</details>
<hr />
<details open><summary>
<h1 id="1-introduction"><a name="Introduction" href="#Introduction">1 Introduction</a></h1>
</summary>
<p>The Open Data Protocol (OData) enables the creation of REST-based data services which allow resources, identified using Uniform Resource Locators (URLs) and defined in a data model, to be published and edited by Web clients using simple HTTP messages. This specification defines the core semantics and the behavioral aspects of the protocol.</p>
<p>The <a href="#ODataURL">OData-URL</a> specification defines a set of rules for constructing URLs to identify the data and metadata exposed by an OData service as well as a set of reserved URL query options.</p>
<p>The <a href="#ODataCSDL">OData-CSDLJSON</a> specification defines a JSON representation of the entity data model exposed by an OData service.</p>
<p>The <a href="#ODataCSDL">OData-CSDLXML</a> specification defines an XML representation of the entity data model exposed by an OData service.</p>
<p>The <a href="#ODataJSON">OData-JSON</a> document specifies the JSON format of the resource representations that are exchanged using OData.</p>
<details open><summary>
<h2 id="11-changes-from-earlier-versions"><a name="ChangesfromEarlierVersions" href="#ChangesfromEarlierVersions">1.1 Changes from Earlier Versions</a></h2>
</summary>
<table>
<thead>
<tr class="header">
<th>Section</th>
<th>Feature / Change</th>
<th>Issue</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><a href="#Preferencecontinueonerrorodatacontinueonerror">Section 8.2.8.3</a></td>
<td>Responses that include errors MUST include the Preference-Applied header <code>with continue-on-error</code> set to <code>true</code></td>
<td><a href="https://github.com/oasis-tcs/odata-specs/issues/1965">1965</a></td>
</tr>
<tr class="even">
<td><a href="#CollectionofEntities">Section 10.2</a></td>
<td>Context URLs use parentheses-style keys without percent-encoding</td>
<td><a href="https://github.com/oasis-tcs/odata-specs/issues/368">368</a></td>
</tr>
<tr class="odd">
<td><a href="#DataModification">Section 11.4</a></td>
<td>Response code <code>204 No Content</code> after successful data modification if requested response could not be constructed</td>
<td><a href="https://github.com/oasis-tcs/odata-specs/issues/443">443</a></td>
</tr>
<tr class="even">
<td><a href="#CreateanEntity">Section 11.4.2</a></td>
<td>Services can validate non-insertable property values in insert payloads</td>
<td><a href="https://github.com/oasis-tcs/odata-specs/issues/356">356</a></td>
</tr>
<tr class="odd">
<td><a href="#UpdateanEntity">Section 11.4.3</a></td>
<td>Services can validate non-updatable property values in update payloads</td>
<td><a href="https://github.com/oasis-tcs/odata-specs/issues/356">356</a></td>
</tr>
<tr class="even">
<td><a href="#UpsertanEntity">Section 11.4.4</a></td>
<td>Upserts to single-valued non-containment navigation properties</td>
<td><a href="https://github.com/oasis-tcs/odata-specs/issues/455">455</a></td>
</tr>
<tr class="odd">
<td><a href="#UpdateaComplexProperty">Section 11.4.9.3</a></td>
<td>Setting a complex property to a different type</td>
<td><a href="https://github.com/oasis-tcs/odata-specs/issues/534">534</a></td>
</tr>
<tr class="even">
<td><a href="#ReplaceaCollectionofEntities">Section 11.4.13</a></td>
<td>Semantics of <code>continue-on-error</code> when replacing a collection of entities</td>
<td><a href="https://github.com/oasis-tcs/odata-specs/issues/358">358</a></td>
</tr>
<tr class="odd">
<td><a href="#Conformance">Section 12</a></td>
<td>Allow <code>400 Bad Request</code> in addition to <code>501 Not Implemented</code> for unsupported functionality</td>
<td><a href="https://github.com/oasis-tcs/odata-specs/issues/391">391</a></td>
</tr>
<tr class="even">
<td><a href="#InteroperableODataClients">Section 12.3</a></td>
<td>Encoding of plus character in URLs</td>
<td><a href="https://github.com/oasis-tcs/odata-specs/issues/485">485</a></td>
</tr>
</tbody>
</table>
</details>
<details open><summary>
<h2 id="12-glossary"><a name="Glossary" href="#Glossary">1.2 Glossary</a></h2>
</summary>
<details open><summary>
<h3 id="121-definitions-of-terms"><a name="DefinitionsofTerms" href="#DefinitionsofTerms">1.2.1 Definitions of Terms</a></h3>
</summary>
</details>
<details open><summary>
<h3 id="122-acronyms-and-abbreviations"><a name="AcronymsandAbbreviations" href="#AcronymsandAbbreviations">1.2.2 Acronyms and Abbreviations</a></h3>
</summary>
<!-- TODO -->

</details>
<details open><summary>
<h3 id="123-document-conventions"><a name="DocumentConventions" href="#DocumentConventions">1.2.3 Document Conventions</a></h3>
</summary>
<p>Keywords defined by this specification use <code>this  monospaced  font</code>.</p>
<p>Some sections of this specification are illustrated with non-normative examples.</p>
<div class="example">
<p>Example 1: text describing an example uses this paragraph style</p>
<pre><code>Non-normative examples use this paragraph style.</code></pre>
</div>
<p>All examples in this document are non-normative and informative only.</p>
<p>All other text is normative unless otherwise labeled.</p>
<!--
Here is a customized command line which will generate HTML from the markdown file (named `odata-v4.02-csd02-part1-protocol.md`). Line breaks are added for readability only:

```
pandoc -f gfm+tex_math_dollars+fenced_divs+smart
       -t html
       -o odata-v4.02-csd02-part1-protocol.html
       -c styles/markdown-styles-v1.7.3b.css
       -c styles/odata.css
       -s
       --mathjax
       --eol=lf
       --wrap=none
       --metadata pagetitle="OData Version 4.02. Part 1: Protocol"
       odata-v4.02-csd02-part1-protocol.md
```

This uses pandoc 3.1.13 from https://github.com/jgm/pandoc/releases/tag/3.1.13.
-->

</details>
</details>
</details>
<hr />
<details open><summary>
<h1 id="2-overview"><a name="Overview" href="#Overview">2 Overview</a></h1>
</summary>
<p>The OData Protocol is an application-level protocol for interacting with data via RESTful interfaces. The protocol supports the description of data models and the editing and querying of data according to those models. It provides facilities for:</p>
<ul>
<li>Metadata: a machine-readable description of the data model exposed by a particular service.</li>
<li>Data: sets of data entities and the relationships between them.</li>
<li>Querying: requesting that the service perform a set of filtering and other transformations to its data, then return the results.</li>
<li>Editing: creating, updating, and deleting data.</li>
<li>Operations: invoking custom logic</li>
<li>Vocabularies: attaching custom semantics</li>
</ul>
<p>The OData Protocol is different from other REST-based web service approaches in that it provides a uniform way to describe both the data and the data model. This improves semantic interoperability between systems and allows an ecosystem to emerge.</p>
<p>Towards that end, the OData Protocol follows these design principles:</p>
<ul>
<li>Prefer mechanisms that work on a variety of data sources. In particular, do not assume a relational data model.</li>
<li>Extensibility is important. Services should be able to support extended functionality without breaking clients unaware of those extensions.</li>
<li>Follow REST principles.</li>
<li>OData should build incrementally. A very basic, compliant service should be easy to build, with additional work necessary only to support additional capabilities.</li>
<li>Keep it simple. Address the common cases and provide extensibility where necessary.</li>
</ul>
</details>
<hr />
<details open><summary>
<h1 id="3-data-model"><a name="DataModel" href="#DataModel">3 Data Model</a></h1>
</summary>
<p>This section provides a high-level description of the <em>Entity Data Model (EDM)</em>: the abstract data model that is used to describe the data exposed by an OData service. An <a href="#MetadataDocumentRequest">OData Metadata Document</a> is a representation of a service‚Äôs data model exposed for client consumption.</p>
<p>The central concepts in the EDM are entities, relationships, entity sets, actions, and functions.</p>
<p><em>Entities</em> are instances of entity types (e.g. <code>Customer</code>, <code>Employee</code>, etc.).</p>
<p><em>Entity types</em> are named structured types with a key. They define the named properties and relationships of an entity. Entity types may derive by single inheritance from other entity types.</p>
<p>The <em>key</em> of an entity type is formed from a subset of the primitive properties (e.g. <code>CustomerId</code>, <code>OrderId</code>, <code>LineId</code>, etc.) of the entity type.</p>
<p><em>Complex types</em> are keyless named structured types consisting of a set of properties. These are value types whose instances cannot be referenced outside of their containing entity. Complex types are commonly used as property values in an entity or as parameters to operations.</p>
<p>Properties declared as part of a structured type‚Äôs definition are called <em>declared properties</em>. Instances of structured types may contain additional undeclared <em>dynamic properties</em>. A dynamic property cannot have the same name as a declared property. Entity or complex types which allow clients to persist additional undeclared properties are called <em>open types</em>.</p>
<p>Relationships from one entity to another are represented as <em>navigation properties.</em> Navigation properties are generally defined as part of an entity type, but can also appear on entity instances as undeclared <em>dynamic navigation properties</em>. Each relationship has a cardinality.</p>
<p><em>Enumeration types</em> are named primitive types whose values are named constants with underlying integer values.</p>
<p><em>Type definitions</em> are named primitive types with fixed facet values such as maximum length or precision. Type definitions can be used in place of primitive typed properties, for example, within property definitions.</p>
<p><em>Entity sets</em> are named collections of entities (e.g. <code>Customers</code> is an entity set containing <code>Customer</code> entities). An entity‚Äôs key uniquely identifies the entity within an entity set. If multiple entity sets use the same entity type, the same combination of key values can appear in more than one entity set and identifies different entities, one per entity set where this key combination appears. Each of these entities has a different <a href="#EntityIdsandEntityReferences">entity-id</a>. Entity sets provide entry points into the data model.</p>
<p><em>Operations</em> allow the execution of custom logic on parts of a data model. <a href="#Functions"><em>Functions</em></a> are operations that do not have side effects and may support further composition, for example, with additional filter operations, functions or an action. <a href="#Actions"><em>Actions</em></a> are operations that allow side effects, such as data modification, and cannot be further composed in order to avoid non-deterministic behavior. Actions and functions are either <em>bound</em> to a type, enabling them to be called as members of an instance of that type, or unbound, in which case they are called as static operations. <em>Action imports</em> and <em>function imports</em> enable unbound actions and functions to be called from the service root.</p>
<p><em>Singletons</em> are named entities which can be accessed as direct children of the entity container. A singleton may also be a member of an entity set.</p>
<p>An OData <em>resource</em> is anything in the model that can be addressed (an entity set, entity, property, or operation).</p>
<p>Refer to <a href="#ODataCSDL">OData-CSDLJSON</a> or <a href="#ODataCSDL">OData-CSDLXML</a> for more information on the OData entity data model.</p>
<details open><summary>
<h2 id="31-annotations"><a name="Annotations" href="#Annotations">3.1 Annotations</a></h2>
</summary>
<p>Model and instance elements can be decorated with <em>Annotations</em>.</p>
<p>Annotations can be used to specify an individual fact about an element, such as whether it is read-only, or to define a common concept, such as a person or a movie.</p>
<p>Applied <em>annotations</em> consist of a <em>term</em> (the namespace-qualified name of the annotation being applied), a <em>target</em> (the model or instance element to which the term is applied), and a <em>value</em>. The value may be a static value, or an expression that may contain a path to one or more properties of an annotated entity.</p>
<p>Annotation terms are defined in metadata and have a name and a type.</p>
<p>A set of related terms in a common namespace comprises a <em>Vocabulary</em>.</p>
</details>
</details>
<hr />
<details open><summary>
<h1 id="4-service-model"><a name="ServiceModel" href="#ServiceModel">4 Service Model</a></h1>
</summary>
<p>OData services are defined using a common data model. The service advertises its concrete data model in a machine-readable form, allowing generic clients to interact with the service in a well-defined way.</p>
<p>An OData service exposes two well-defined resources that describe its data model; a service document and a metadata document.</p>
<p>The <a href="#ServiceDocumentRequest"><em>service document</em></a> lists entity sets, functions, and singletons that can be retrieved. Clients can use the service document to navigate the model in a hypermedia-driven fashion.</p>
<p>The <a href="#MetadataDocumentRequest"><em>metadata document</em></a> describes the types, sets, functions and actions understood by the OData service. Clients can use the metadata document to understand how to query and interact with entities in the service.</p>
<p>In addition to these two ‚Äúfixed‚Äù resources, an OData service consists of dynamic resources. The URLs for many of these resources can be computed from the information in the metadata document.</p>
<p>See <a href="#RequestingData">Requesting Data</a> and <a href="#DataModification">Data Modification</a> for details.</p>
<details open><summary>
<h2 id="41-entity-ids-and-entity-references"><a name="EntityIdsandEntityReferences" href="#EntityIdsandEntityReferences">4.1 Entity-Ids and Entity References</a></h2>
</summary>
<p>Whereas entities within an entity set are uniquely identified by their key values, entities are also uniquely identified by a durable, opaque, globally unique <em>entity-id</em>. The entity-id MUST be an IRI as defined in <a href="#rfc3987">RFC3987</a> and MAY be expressed in payloads, headers, and URLs as a relative reference as appropriate. While the client MUST be prepared to accept any IRI, services MUST use valid URIs in this version of the specification since there is currently no lossless representation of an IRI in the <a href="#HeaderODataEntityId"><code>EntityId</code></a> header.</p>
<p>Services are strongly encouraged to use the canonical URL for an entity as defined in <a href="#ODataURL">OData-URL</a> as its entity-id, but clients cannot assume the entity-id can be used to locate the entity unless the <a href="https://github.com/oasis-tcs/odata-vocabularies/blob/main/vocabularies/Org.OData.Core.V1.md#DereferenceableIDs"><code>Core.DereferenceableIDs</code></a> term is applied to the entity container, nor can the client assume any semantics from the structure of the entity-id. The canonical resource <code>$entity</code> provides a general mechanism for <a href="#ResolvinganEntityId">resolving an entity-id</a> into an entity representation.</p>
<p>Services that use the standard URL conventions for entity-ids annotate their entity container with the term <a href="https://github.com/oasis-tcs/odata-vocabularies/blob/main/vocabularies/Org.OData.Core.V1.md#ConventionalIDs"><code>Core.ConventionalIDs</code></a>, see <a href="#ODataVocCore">OData-VocCore</a>.</p>
<p><em>Entity references</em> refer to an entity using the entity‚Äôs entity-id.</p>
</details>
<details open><summary>
<h2 id="42-read-urls-and-edit-urls"><a name="ReadURLsandEditURLs" href="#ReadURLsandEditURLs">4.2 Read URLs and Edit URLs</a></h2>
</summary>
<p>The read URL of an entity is the URL that can be used to read the entity.</p>
<p>The edit URL of an entity is the URL that can be used to update or delete the entity.</p>
<p>The edit URL of a property is the edit URL of the entity with appended segment(s) containing the path to the property.</p>
<p>Services are strongly encouraged to use the canonical URL for an entity as defined in <a href="#ODataURL">OData-URL</a> for both the read URL and the edit URL of an entity, with a cast segment to the type of the entity appended to the canonical URL if the type of the entity is derived from the declared type of the entity set. However, clients cannot assume this convention and must use the links specified in the payload according to the appropriate format as the two URLs may be different from one another, or one or both of them may differ from convention.</p>
</details>
<details open><summary>
<h2 id="43-transient-entities"><a name="TransientEntities" href="#TransientEntities">4.3 Transient Entities</a></h2>
</summary>
<p>Transient entities are instances of an entity type that are dynamically generated on request and only exist within a response payload. They do not possess an update URL and consequently cannot be updated. A transient entity may have a read URL, which generates a new transient entity using the same algorithm, and they may have an entity id if a repeated occurrence in a response needs to be replaced with an entity reference.</p>
</details>
<details open><summary>
<h2 id="44-default-namespaces"><a name="DefaultNamespaces" href="#DefaultNamespaces">4.4 Default Namespaces</a></h2>
</summary>
<p>References to actions, functions, and types within a URL typically requires prefixing the name of the action, function, or type with the namespace or alias in which it is defined. This namespace qualification enables differentiating between similarly named elements across schema, or between properties and bound functions, actions, or types with the same name.</p>
<p>Services MAY define one or more default namespaces through the <a href="https://github.com/oasis-tcs/odata-vocabularies/blob/main/vocabularies/Org.OData.Core.V1.md#DefaultNamespace"><code>Core.DefaultNamespace</code></a> term defined in <a href="#ODataVocCore">OData-VocCore</a>. Functions, actions and types in a default namespace can be referenced in URLs with or without namespace or alias qualification.</p>
<p>Service designers should ensure uniqueness of schema children across all default namespaces, and should avoid naming bound functions, actions, or derived types with the same name as a structural or navigation property of the type.</p>
<p>In the case where ambiguity does exist, an unqualified segment appended to a structured value is always first compared to the list of properties defined on the structured type. If no defined property with a name matching the unqualified segment exists, or the preceding segment represents a collection or a scalar value, it is next compared to the names of any bound functions or actions, or derived type names, defined within any default namespace. If it still does not match, and the preceding segment represents a structured value, it is interpreted as a dynamic property.</p>
<p>Services MAY disallow dynamic properties on structured values whose names conflict with a bound action, function, or derived type defined within in a default namespace.</p>
<p>The behavior if name conflicts occur across children of default namespaces is undefined. Generic clients are encouraged to always qualify action, function, and type names in order to avoid any possible ambiguity.</p>
</details>
</details>
<hr />
<details open><summary>
<h1 id="5-versioning"><a name="Versioning" href="#Versioning">5 Versioning</a></h1>
</summary>
<p>Versioning enables clients and services to evolve independently. OData defines semantics for both protocol and data model versioning.</p>
<details open><summary>
<h2 id="51-protocol-versioning"><a name="ProtocolVersioning" href="#ProtocolVersioning">5.1 Protocol Versioning</a></h2>
</summary>
<p>OData requests and responses are versioned according to the <a href="#HeaderODataVersion"><code>OData-Version</code></a> header.</p>
<p>OData clients include the <a href="#HeaderODataMaxVersion"><code>OData-MaxVersion</code></a> header in requests in order to specify the maximum acceptable response version. Services respond with the maximum supported version that is less than or equal to the requested <code>OData-MaxVersion</code>, using decimal comparison. The syntax of the <code>OData-Version</code> and <code>OData-MaxVersion</code> header fields is defined in <a href="#ODataABNF">OData-ABNF</a>.</p>
<p>Services SHOULD advertise supported versions of OData through the <a href="https://github.com/oasis-tcs/odata-vocabularies/blob/main/vocabularies/Org.OData.Core.V1.md#ODataVersions"><code>Core.ODataVersions</code></a> term, defined in <a href="#ODataVocCore">OData-VocCore</a>.</p>
<p>This version of the specification defines OData version values <code>4.0</code> and <code>4.01</code>. Content that applies only to one version or another is explicitly called out in the text.</p>
</details>
<details open><summary>
<h2 id="52-model-versioning"><a name="ModelVersioning" href="#ModelVersioning">5.2 Model Versioning</a></h2>
</summary>
<p>The <a href="#DataModel">Data Model</a> exposed by an OData Service defines a contract between the OData service and its clients. Services are allowed to extend their model only to the degree that it does not break existing clients. Breaking changes, such as removing properties, changing the type of existing properties, adding or removing key properties, or reordering action or function parameters, require that a new service version is provided at a different service root URL for the new model, or that the service version its metadata using the <a href="https://github.com/oasis-tcs/odata-vocabularies/blob/main/vocabularies/Org.OData.Core.V1.md#SchemaVersion"><code>Core.SchemaVersion</code></a> annotation, defined in <a href="#ODataVocCore">OData-VocCore</a>.</p>
<p>Services that version their metadata MUST support version-specific requests according to the <a href="#SystemQueryOptionschemaversion"><code>$schemaversion</code></a> system query option. The following Data Model additions are considered safe and do not require services to version their entry point or schema.</p>
<ul>
<li>Adding a property that is nullable or has a default value; if it has the same name as an existing dynamic property, it must have the same type (or base type) as the existing dynamic property</li>
<li>Adding a navigation property that is nullable or collection-valued; if it has the same name as an existing dynamic navigation property, it must have the same type (or base type) as the existing dynamic navigation property</li>
<li>Adding a new entity type to the model</li>
<li>Adding a new complex type to the model</li>
<li>Adding a new entity set</li>
<li>Adding a new singleton</li>
<li>Adding an action, a function, an action import, or function import</li>
<li>Adding an action parameter that is nullable after existing parameters</li>
<li>Adding an action or function parameter that is annotated with <a href="https://github.com/oasis-tcs/odata-vocabularies/blob/main/vocabularies/Org.OData.Core.V1.md#OptionalParameter"><code>Core.OptionalParameter</code></a> after existing parameters</li>
<li>Adding a type definition or enumeration</li>
<li>Adding a new term</li>
<li>Adding any annotation to a model element that does not need to be understood by the client in order to correctly interact with the service</li>
</ul>
<p>Clients SHOULD be prepared for services to make such incremental changes to their model. In particular, clients SHOULD be prepared to receive properties and derived types not previously defined by the service.</p>
<p>Services SHOULD NOT change their data model depending on the authenticated user. If the data model is user or user-group dependent, all changes MUST be <em>safe changes</em> as defined in this section when comparing the full model to the model visible to users with restricted authorizations.</p>
</details>
</details>
<hr />
<details open><summary>
<h1 id="6-extensibility"><a name="Extensibility" href="#Extensibility">6 Extensibility</a></h1>
</summary>
<p>The OData protocol supports both user- and version-driven extensibility through a combination of versioning, convention, and explicit extension points.</p>
<details open><summary>
<h2 id="61-query-option-extensibility"><a name="QueryOptionExtensibility" href="#QueryOptionExtensibility">6.1 Query Option Extensibility</a></h2>
</summary>
<p>Query options within the request URL can control how a particular request is processed by the service.</p>
<p>OData-defined system query options are optionally prefixed with ‚Äú<code>$</code>‚Äù. Services may support additional custom query options not defined in the OData specification, but they MUST NOT begin with the ‚Äú<code>$</code>‚Äù or ‚Äú<code>@</code>‚Äù character and MUST NOT conflict with any OData-defined system query options defined in the OData version supported by the service.</p>
<p>OData services SHOULD NOT require any query options to be specified in a request. Services SHOULD fail any request that contains query options that they do not understand and MUST fail any request that contains unsupported OData query options defined in the version of this specification supported by the service.</p>
<p>In many cases OData services return URLs to identify resources that are later requested by clients. Where possible, interoperability is enhanced by providing all identifying information in the path portion of the URL. However, clients should be prepared for such URLs to include custom query options and propagate any such custom query options in future requests to the identified resource.</p>
</details>
<details open><summary>
<h2 id="62-payload-extensibility"><a name="PayloadExtensibility" href="#PayloadExtensibility">6.2 Payload Extensibility</a></h2>
</summary>
<p>OData supports extensibility in the payload, according to the specific format.</p>
<p>Regardless of the format, additional content MUST NOT be present if it needs to be understood by the receiver in order to correctly interpret the payload according to the specified <a href="#HeaderODataVersion"><code>OData-Version</code></a> header. Thus, clients and services MUST be prepared to handle or safely ignore any content not specifically defined in the version of the payload specified by the <code>OData-Version</code> header.</p>
</details>
<details open><summary>
<h2 id="63-actionfunction-extensibility"><a name="ActionFunctionExtensibility" href="#ActionFunctionExtensibility">6.3 Action/Function Extensibility</a></h2>
</summary>
<p><a href="#Actions">Actions</a> and <a href="#Functions">Functions</a> extend the set of operations that can be performed on or with a service or resource. Actions can have side-effects. For example, Actions can be used to modify data or to invoke custom operations. Functions MUST NOT have side-effects. Functions can be invoked from a URL that addresses a resource or within an expression to a <a href="#SystemQueryOptionfilter"><code>$filter</code></a> or <a href="#SystemQueryOptionorderby"><code>$orderby</code></a> system query option.</p>
<p>Fully qualified action and function names include a namespace or alias prefix. The <code>Edm</code>, <code>odata</code> and <code>geo</code> namespaces are reserved for the use of this specification.</p>
<p>An OData service MUST fail any request that contains actions or functions that it does not understand.</p>
</details>
<details open><summary>
<h2 id="64-vocabulary-extensibility"><a name="VocabularyExtensibility" href="#VocabularyExtensibility">6.4 Vocabulary Extensibility</a></h2>
</summary>
<p>The set of <a href="#Annotations">annotations</a> defined within a schema comprise a <em>vocabulary</em>. Shared vocabularies provide a powerful extensibility point for OData.</p>
<p>Metadata annotations can be used to define additional characteristics or capabilities of a metadata element, such as a service, entity type, property, function, action or parameter. For example, a metadata annotation could define ranges of valid values for a particular property.</p>
<p>Instance annotations can be used to define additional information associated with a particular result, entity, property, or error; for example whether a property is read-only for a particular instance.</p>
<p>Where annotations apply across all instances of a type, services are encouraged to specify the annotation in metadata rather than repeating in each instance of the payload. Where the same annotation is defined at both the metadata and instance level, the instance-level annotation overrides the one specified at the metadata level.</p>
<p>A service MUST NOT require the client to understand custom annotations in order to accurately interpret a response.</p>
<p>OData defines a <code>Core</code> vocabulary with a set of basic terms describing behavioral aspects along with terms that can be used in defining other vocabularies; see <a href="#ODataVocCore">OData-VocCore</a>.</p>
</details>
<details open><summary>
<h2 id="65-header-field-extensibility"><a name="HeaderFieldExtensibility" href="#HeaderFieldExtensibility">6.5 Header Field Extensibility</a></h2>
</summary>
<p>OData defines semantics around certain HTTP request and response headers. Services that support a version of OData conform to the processing requirements for the headers defined by this specification for that version.</p>
<p>Individual services may define custom headers. These headers MUST NOT begin with <code>OData</code>. Custom headers SHOULD be optional when making requests to the service. A service MUST NOT require the client to understand custom headers to accurately interpret the response.</p>
</details>
<details open><summary>
<h2 id="66-format-extensibility"><a name="FormatExtensibility" href="#FormatExtensibility">6.6 Format Extensibility</a></h2>
</summary>
<p>An OData service MUST support <a href="#ODataJSON">OData-JSON</a> and MAY support additional formats for both request and response bodies.</p>
</details>
</details>
<hr />
<details open><summary>
<h1 id="7-formats"><a name="Formats" href="#Formats">7 Formats</a></h1>
</summary>
<p>The client MAY request a particular response format through the <a href="#HeaderAccept"><code>Accept</code></a> header, as defined in <a href="#rfc9110">RFC9110</a>, or through the system query option <a href="#SystemQueryOptionformat"><code>$format</code></a>.</p>
<p>In the case that both the <code>Accept</code> header and the <code>$format</code> system query option are specified on a request, the value specified in the <code>$format</code> query option MUST be used.</p>
<p>If the service does not support the requested format, it replies with a <a href="#ResponseCode406NotAcceptable"><code>406 Not Acceptable</code></a> error response.</p>
<p>Services SHOULD advertise their supported formats in the metadata document by annotating their entity container with the term <a href="https://github.com/oasis-tcs/odata-vocabularies/blob/main/vocabularies/Org.OData.Capabilities.V1.md#SupportedFormats"><code>Capabilities.SupportedFormats</code></a>, as defined in <a href="#ODataVocCap">OData-VocCap</a>, listing all available formats and combinations of supported format parameters.</p>
<p>The media types for the JSON and XML representation of the metadata document are described in section ‚Äú<a href="#MetadataDocumentRequest">Metadata Document Request</a>‚Äù.</p>
<p>The format specification <a href="#ODataJSON">OData-JSON</a> describes the media type and the format parameters for non-metadata requests and responses.</p>
<p>For non-metadata requests, if neither the <code>Accept</code> header nor the <code>$format</code> query option are specified, the service MAY respond to requests in any format.</p>
<p>Client libraries MUST retain the order of objects within an array in JSON responses, and elements in document order for XML responses, including CSDL documents.</p>
</details>
<hr />
<details open><summary>
<h1 id="8-header-fields"><a name="HeaderFields" href="#HeaderFields">8 Header Fields</a></h1>
</summary>
<p>OData defines semantics around the following request and response headers. Additional headers may be specified, but have no unique semantics defined in OData.</p>
<details open><summary>
<h2 id="81-common-headers"><a name="CommonHeaders" href="#CommonHeaders">8.1 Common Headers</a></h2>
</summary>
<p>The following headers are common between OData requests and responses.</p>
<details open><summary>
<h3 id="811-header-content-type"><a name="HeaderContentType" href="#HeaderContentType">8.1.1 Header <code>Content-Type</code></a></h3>
</summary>
<p>The format of a non-empty individual request or response body, alone or within a batch, MUST be specified in the <code>Content-Type</code> header of a request or response. The exception to this is if the body represents the media stream of a <a href="#RequestingtheMediaStreamofaMediaEntityusingvalue">media entity</a> or <a href="#ManagingStreamProperties">stream property</a>, in which case the <code>Content-Type</code> header SHOULD be present.</p>
<p>The specified format MAY include format parameters. Clients MUST be prepared for the service to return custom format parameters not defined in OData and SHOULD NOT expect that such format parameters can be ignored. Custom format parameters MUST NOT start with <code>odata</code> and services MUST NOT require generic OData consumers to understand custom format parameters in order to correctly interpret the payload.</p>
<p>See <a href="#ODataJSON">OData-JSON</a> for format-specific details about format parameters within the <code>Content-Type</code> header.</p>
</details>
<details open><summary>
<h3 id="812-header-content-encoding"><a name="HeaderContentEncoding" href="#HeaderContentEncoding">8.1.2 Header <code>Content-Encoding</code></a></h3>
</summary>
<p>As defined in <a href="#rfc9110">RFC9110</a>, the <code>Content-Encoding</code> header field is used as a modifier to the media-type (as indicated in the <code>Content-Type</code> header). When present, its value indicates what additional content codings have been applied to the entity-body. A service MAY specify a list of acceptable content codings using an annotation with term <a href="https://github.com/oasis-tcs/odata-vocabularies/blob/main/vocabularies/Org.OData.Capabilities.V1.md#AcceptableEncodings"><code>Capabilities.AcceptableEncodings</code></a>, see <a href="#ODataVocCap">OData-VocCap</a>.</p>
<p>If the <code>Content-Encoding</code> header is specified on an individual request or response within a batch, then it specifies the encoding for that individual request or response. Individual requests or responses that don‚Äôt include the <code>Content-Encoding</code> header inherit the encoding of the overall batch request or response.</p>
</details>
<details open><summary>
<h3 id="813-header-content-language"><a name="HeaderContentLanguage" href="#HeaderContentLanguage">8.1.3 Header <code>Content-Language</code></a></h3>
</summary>
<p>As defined in <a href="#rfc9110">RFC9110</a>, a request or response can include a <code>Content-Language</code> header to indicate the natural language of the intended audience for the enclosed message body. OData does not add any additional requirements over HTTP for including <code>Content-Language</code>. OData services can annotate model elements whose content depends on the content language with the term <a href="https://github.com/oasis-tcs/odata-vocabularies/blob/main/vocabularies/Org.OData.Core.V1.md#IsLanguageDependent"><code>Core.IsLanguageDependent</code></a>, see <a href="#ODataVocCore">OData-VocCore</a>.</p>
<p>If the <code>Content-Language</code> header is specified on an individual request or response within a batch, then it specifies the language for that individual request or response. Individual requests or responses that don‚Äôt include the <code>Content-Language</code> header inherit the language of the overall batch request or response.</p>
</details>
<details open><summary>
<h3 id="814-header-content-length"><a name="HeaderContentLength" href="#HeaderContentLength">8.1.4 Header <code>Content-Length</code></a></h3>
</summary>
<p>As defined in <a href="#rfc9110">RFC9110</a>, a request or response SHOULD include a <code>Content-Length</code> header when the message‚Äôs length can be determined prior to being transferred. OData does not add any additional requirements over HTTP for writing <code>Content-Length</code>.</p>
<p>If the <code>Content-Length</code> header is specified on an individual request or response within a batch, then it specifies the length for that individual request or response.</p>
</details>
<details open><summary>
<h3 id="815-header-odata-version"><a name="HeaderODataVersion" href="#HeaderODataVersion">8.1.5 Header <code>OData-Version</code></a></h3>
</summary>
<p>OData clients SHOULD use the <code>OData-Version</code> header on a request to specify the version of the protocol used to generate the request payload.</p>
<p>If present on a request, the service MUST interpret the request payload according to the rules defined in the specified version of the protocol or fail the request with a <code>4xx</code> response code.</p>
<p>If not specified in a request, the service MUST assume the request payload is generated using the minimum of the <a href="#HeaderODataMaxVersion"><code>OData-MaxVersion</code></a>, if specified, and the maximum version of the protocol that the service understands.</p>
<p>OData services MUST include the <code>OData-Version</code> header on a response to specify the version of the protocol used to generate the response payload. The client MUST interpret the response payload according to the rules defined in the specified version of the protocol. Request and response payloads are independent and may have different <code>OData-Version</code> headers according to the above rules.</p>
<p>For more details, see <a href="#Versioning">Versioning</a>.</p>
<p>If the <code>OData-Version</code> header is specified on an individual request or response within a batch, then it specifies the OData version for that individual request or response. Individual requests or responses that don‚Äôt include the <code>OData-Version</code> header inherit the OData version of the overall batch request or response. This OData version does not typically vary within a batch.</p>
</details>
</details>
<details open><summary>
<h2 id="82-request-headers"><a name="RequestHeaders" href="#RequestHeaders">8.2 Request Headers</a></h2>
</summary>
<p>In addition to the <a href="#CommonHeaders">Common Headers</a>, the client may specify any combination of the following request headers.</p>
<details open><summary>
<h3 id="821-header-accept"><a name="HeaderAccept" href="#HeaderAccept">8.2.1 Header <code>Accept</code></a></h3>
</summary>
<p>As defined in <a href="#rfc9110">RFC9110</a>, the client MAY specify the set of accepted <a href="#Formats">formats</a> with the <code>Accept</code> Header.</p>
<p>Services MUST reject formats that specify unknown or unsupported format parameters.</p>
<p>If a media type specified in the <code>Accept</code> header includes a <code>charset</code> format parameter and the request also contains an <a href="#HeaderAcceptCharset"><code>Accept-Charset</code></a> header, then the <code>Accept-Charset</code> header MUST be used.</p>
<p>If the media type specified in the <code>Accept</code> header does not include a <code>charset</code> format parameter, then the <a href="#HeaderContentType"><code>Content-Type</code></a> header of the response MUST NOT contain a <code>charset</code> format parameter.</p>
<p>The service SHOULD NOT add any format parameters to the <code>Content-Type</code> header not specified in the <code>Accept</code> header.</p>
<p>If the <code>Accept</code> header is specified on an individual request within a batch, then it specifies the acceptable formats for that individual request. Requests within a batch that don‚Äôt include the <code>Accept</code> header inherit the acceptable formats of the overall batch request.</p>
</details>
<details open><summary>
<h3 id="822-header-accept-charset"><a name="HeaderAcceptCharset" href="#HeaderAcceptCharset">8.2.2 Header <code>Accept-Charset</code></a></h3>
</summary>
<p>As defined in <a href="#rfc9110">RFC9110</a>, the client MAY specify the set of accepted character sets with the <code>Accept-Charset</code> header.</p>
<p>If the <code>Accept-Charset</code> header is specified on an individual request within a batch, then it specifies the acceptable character sets for that individual request. Requests within a batch that don‚Äôt include the <code>Accept-Charset</code> header inherit the acceptable character sets of the overall batch request.</p>
</details>
<details open><summary>
<h3 id="823-header-accept-language"><a name="HeaderAcceptLanguage" href="#HeaderAcceptLanguage">8.2.3 Header <code>Accept-Language</code></a></h3>
</summary>
<p>As defined in <a href="#rfc9110">RFC9110</a>, the client MAY specify the set of accepted natural languages with the <code>Accept-Language</code> header.</p>
<p>If the <code>Accept-Language</code> header is specified on an individual request within a batch, then it specifies the acceptable languages for that individual request. Requests within a batch that don‚Äôt include the <code>Accept-Language</code> header inherit the acceptable languages of the overall batch request.</p>
</details>
<details open><summary>
<h3 id="824-header-if-match"><a name="HeaderIfMatch" href="#HeaderIfMatch">8.2.4 Header <code>If-Match</code></a></h3>
</summary>
<p>As defined in <a href="#rfc9110">RFC9110</a>, a client MAY include an <code>If-Match</code> header in a request to <code>GET</code>, <code>POST</code>, <code>PUT</code>, <code>PATCH</code> or <code>DELETE</code>. The value of the <code>If-Match</code> request header MUST be an ETag value previously retrieved for the resource, or <code>*</code> to match any value.</p>
<p>If an operation on an existing resource requires an ETag, (see term <a href="https://github.com/oasis-tcs/odata-vocabularies/blob/main/vocabularies/Org.OData.Core.V1.md#OptimisticConcurrency"><code>Core.OptimisticConcurrency</code></a> in <a href="#ODataVocCore">OData-VocCore</a> and property <code>OptimisticConcurrencyControl</code> of type <a href="https://github.com/oasis-tcs/odata-vocabularies/blob/main/vocabularies/Org.OData.Capabilities.V1.md#NavigationPropertyRestriction"><code>Capabilities.NavigationPropertyRestriction</code></a> in <a href="#ODataVocCap">OData-VocCap</a>) and the client does not specify an <code>If-Match</code> request header in a <a href="#DataModification">Data Modification Request</a> or in an <a href="#Actions">Action Request</a> invoking an action bound to the resource, the service responds with a <code>428 Precondition Required</code> and MUST ensure that no observable change occurs as a result of the request.</p>
<p>If present, the request MUST only be processed if the specified ETag value matches the current ETag value of the target resource. Services sending <a href="#HeaderETag"><code>ETag</code></a> headers with weak ETags that only depend on the representation-independent entity state MUST use the weak comparison function because it is sufficient to prevent accidental overwrites. This is a deviation from <a href="#rfc9110">RFC9110</a>.</p>
<p>If the value does not match the current ETag value of the resource for a <a href="#DataModification">Data Modification Request</a> or <a href="#Actions">Action Request</a>, the service MUST respond with <a href="#ResponseCode412PreconditionFailed"><code>412 Precondition Failed</code></a> and MUST ensure that no observable change occurs as a result of the request. In the case of an <a href="#UpsertanEntity">upsert</a>, if the addressed entity does not exist the provided ETag value is considered not to match.</p>
<p>An <code>If-Match</code> header with a value of <code>*</code> in a <code>PUT</code> or <code>PATCH</code> request results in an <a href="#UpsertanEntity">upsert request</a> being processed as an update and not an insert.</p>
<p>The <code>If-Match</code> header MUST NOT be specified on a batch request, but MAY be specified on individual requests within the batch.</p>
</details>
<details open><summary>
<h3 id="825-header-if-none-match"><a name="HeaderIfNoneMatch" href="#HeaderIfNoneMatch">8.2.5 Header <code>If-None-Match</code></a></h3>
</summary>
<p>As defined in <a href="#rfc9110">RFC9110</a>, a client MAY include an <code>If-None-Match</code> header in a request to <code>GET</code>, <code>POST</code>, <code>PUT</code>, <code>PATCH</code> or <code>DELETE</code>. The value of the <code>If-None-Match</code> request header MUST be an ETag value previously retrieved for the resource, or <code>*</code>.</p>
<p>If present, the request MUST only be processed if the specified ETag value does not match the current ETag value of the resource, using the weak comparison function (see <a href="#rfc9110">RFC9110</a>). If the value matches the current ETag value of the resource, then for a <code>GET</code> request, the service SHOULD respond with <a href="#ResponseCode304NotModified"><code>304 Not Modified</code></a>, and for a <a href="#DataModification">Data Modification Request</a> or <a href="#Actions">Action Request</a>, the service MUST respond with <a href="#ResponseCode412PreconditionFailed"><code>412 Precondition Failed</code></a> and MUST ensure that no observable change occurs as a result of the request.</p>
<p>An <code>If-None-Match</code> header with a value of <code>*</code> in a <code>PUT</code> or <code>PATCH</code> request results in an <a href="#UpsertanEntity">upsert request</a> being processed as an <a href="#CreateanEntity">insert</a> and not an <a href="#UpdateanEntity">update</a>.</p>
<p>The <code>If-None-Match</code> header MUST NOT be specified on a batch request, but MAY be specified on individual requests within the batch.</p>
</details>
<details open><summary>
<h3 id="826-header-isolation-odata-isolation"><a name="HeaderIsolationODataIsolation" href="#HeaderIsolationODataIsolation">8.2.6 Header <code>Isolation</code> (<code>OData-Isolation</code>)</a></h3>
</summary>
<p>The <code>Isolation</code> header specifies the isolation of the current request from external changes. The only supported value for this header is <code>snapshot</code>.</p>
<p>If the service doesn‚Äôt support <code>Isolation:snapshot</code> and this header was specified on the request, the service MUST NOT process the request and MUST respond with <a href="#ResponseCode412PreconditionFailed"><code>412 Precondition Failed</code></a>.</p>
<p><em>Snapshot isolation</em> guarantees that all data returned for a request, including multiple requests within a <a href="#BatchRequests">batch</a> or results retrieved across multiple <a href="#ServerDrivenPaging">pages</a>, will be consistent as of a single point in time. Only data modifications made within the request (for example, by a data modification request within the same batch) are visible. The effect is as if the request generates a ‚Äúsnapshot‚Äù of the committed data as it existed at the start of the request.</p>
<p>The<code> Isolation</code> header may be specified on a single or batch request. If it is specified on a batch then the value is applied to all statements within the batch.</p>
<p>Next links returned within a snapshot return results within the same snapshot as the initial request; the client is not required to repeat the header on each individual page request.</p>
<p>The <code>Isolation</code> header has no effect on links other than the next link. Navigation links, read links, and edit links return the current version of the data.</p>
<p>A service returns <a href="#ResponseCode410Gone"><code>410 Gone</code></a> or <a href="#ResponseCode404NotFound"><code>404 Not Found</code></a> if a consumer tries to follow a next link referring to a snapshot that is no longer available.</p>
<p>The syntax of the <code>Isolation</code> header is defined in <a href="#ODataABNF">OData-ABNF</a>.</p>
<p>A service MAY specify the support for <code>Isolation:snapshot</code> using an annotation with term <a href="https://github.com/oasis-tcs/odata-vocabularies/blob/main/vocabularies/Org.OData.Capabilities.V1.md#IsolationSupported"><code>Capabilities.IsolationSupported</code></a>, see <a href="#ODataVocCap">OData-VocCap</a>.</p>
<p>Note: The <code>Isolation</code> header was named <code>OData-Isolation</code> in OData version 4.0. Services that support the<code> Isolation</code> header SHOULD also support <code>OData-Isolation</code> for OData 4.0 clients and clients SHOULD use <code>OData-Isolation</code> for compatibility with OData 4.0 services. If both <code>Isolation</code> and <code>OData-Isolation</code> headers are specified in the same request, the value of the <code>Isolation</code> header SHOULD be used.</p>
</details>
<details open><summary>
<h3 id="827-header-odata-maxversion"><a name="HeaderODataMaxVersion" href="#HeaderODataMaxVersion">8.2.7 Header <code>OData-MaxVersion</code></a></h3>
</summary>
<p>Clients SHOULD specify an <code>OData-MaxVersion</code> request header.</p>
<p>If specified, the service MUST generate a response with the greatest supported <a href="#HeaderODataVersion"><code>OData-Version</code></a> less than or equal to the specified <code>OData-MaxVersion</code>.</p>
<p>If <code>OData-MaxVersion</code> is not specified, then the service SHOULD return responses with the same OData version over time and interpret the request as having an <code>OData-MaxVersion</code> equal to the maximum OData version supported by the service at its initial publication.</p>
<p>If the <code>OData-MaxVersion</code> header is specified on an individual request within a batch, then it specifies the maximum OData version for that individual request. Individual requests that don‚Äôt include the <code>OData-MaxVersion</code> header inherit the maximum OData version of the overall batch request or response. The maximum OData version does not typically vary within a batch.</p>
<p>For more details, see <a href="#Versioning">Versioning</a>.</p>
</details>
<details open><summary>
<h3 id="828-header-prefer"><a name="HeaderPrefer" href="#HeaderPrefer">8.2.8 Header <code>Prefer</code></a></h3>
</summary>
<p>The <code>Prefer</code> header, as defined in <a href="#rfc7240">RFC7240</a>, allows clients to request certain behavior from the service. The service MUST ignore preference values that are either not supported or not known by the service.</p>
<p>The value of the <code>Prefer</code> header is a comma-separated list of <em>preferences</em>. The following subsections describe preferences whose meaning in OData is defined by this specification.</p>
<p>In response to a request containing a <code>Prefer</code> header, the service MAY return the <a href="#HeaderPreferenceApplied"><code>Preference-Applied</code></a> and <a href="#HeaderVary"><code>Vary</code></a> headers.</p>
<details open><summary>
<h4 id="8281-preference-allow-entityreferences-odataallow-entityreferences"><a name="Preferenceallowentityreferencesodataallowentityreferences" href="#Preferenceallowentityreferencesodataallowentityreferences">8.2.8.1 Preference <code>allow-entityreferences</code> (<code>odata.allow-entityreferences</code>)</a></h4>
</summary>
<p>The <code>allow-entityreferences</code> preference indicates that the service is allowed to return entity references in place of entities that have previously been returned, with at least the properties requested, in the same response (for example, when serializing the expanded results of many-to-many relationships). The service MUST NOT return entity references in place of requested entities if <code>allow-entityreferences</code> has not been specified in the request, unless explicitly defined by other rules in this document. The syntax of the <code>allow-entityreferences</code> preference is defined in <a href="#ODataABNF">OData-ABNF</a>.</p>
<p>In the case the service applies the <code>allow-entityreferences</code> preference it MUST include a <a href="#HeaderPreferenceApplied"><code>Preference-Applied</code></a> response header containing the <code>allow-entityreferences</code> preference to indicate that entity references MAY be returned in place of entities that have previously been returned.</p>
<p>If the <code>allow-entityreferences</code> preference is specified on an individual request within a batch, then it specifies the preference for that individual request. Individual requests within a batch that don‚Äôt include the <code>allow-entityreferences</code> preference inherit the preference of the overall batch request.</p>
<p>Note: The <code>allow-entityreferences</code> preference was named <code>odata.allow-entityreferences</code> in OData version 4.0. Services that support the<code> allow-entityreferences</code> preference SHOULD also support <code>odata.allow-entityreferences</code> for OData 4.0 clients and clients SHOULD use <code>odata.allow-entityreferences</code> for compatibility with OData 4.0 services.</p>
</details>
<details open><summary>
<h4 id="8282-preference-callback-odatacallback"><a name="Preferencecallbackodatacallback" href="#Preferencecallbackodatacallback">8.2.8.2 Preference <code>callback</code> (<code>odata.callback</code>)</a></h4>
</summary>
<p>For scenarios in which links returned by the service are used by the client to poll for additional information, the client can specify the <code>callback</code> preference to request that the service notify the client when data is available.</p>
<p>The <code>callback</code> preference can be specified:</p>
<ul>
<li>when requesting asynchronous processing of a request with the <a href="#Preferencerespondasync"><code>respond-async</code></a> preference, or</li>
<li>on a <code>GET</code> request to a <a href="#DeltaLinks">delta link</a>.</li>
</ul>
<p>The <code>callback</code> preference MUST include the parameter <code>url</code> whose value is the URL of a callback endpoint to be invoked by the OData service when data is available. The syntax of the <code>callback</code> preference is defined in <a href="#ODataABNF">OData-ABNF</a>.</p>
<p>For HTTP based callbacks, the OData service executes an HTTP <code>GET</code> request against the specified URL.</p>
<p>Services that support <code>callback</code> SHOULD support notifying the client through HTTP. Services can advertise callback support using the <a href="https://github.com/oasis-tcs/odata-vocabularies/blob/main/vocabularies/Org.OData.Capabilities.V1.md#CallbackSupported"><code>Capabilities.CallbackSupported</code></a> annotation term defined in <a href="#ODataVocCap">OData-VocCap</a>.</p>
<p>If the service applies the <code>callback</code> preference it MUST include the <code>callback</code> preference in the <a href="#HeaderPreferenceApplied"><code>Preference-Applied</code></a> response header.</p>
<p>When the <code>callback</code> preference is applied to asynchronous requests, the OData service invokes the callback endpoint once it has finished processing the request. The status monitor resource, returned in the <a href="#HeaderLocation"><code>Location</code></a> header of the previously returned <a href="#ResponseCode202Accepted"><code>202 Accepted</code></a> response, can then be used to retrieve the results of the asynchronously executed request.</p>
<p>When the <code>callback</code> preference is specified on a <code>GET</code> request to a delta link and there are no changes available, the OData service returns a <a href="#ResponseCode202Accepted"><code>202 Accepted</code></a> response with a <a href="#HeaderLocation"><code>Location</code></a> header specifying the delta link to be used to check for future updates. The OData service then invokes the specified callback endpoint once new changes become available.</p>
<p>Combining <a href="#Preferencerespondasync"><code>respond-async</code></a>, <code>callback</code> and <a href="#Preferencetrackchangesodatatrackchanges"><code>track-changes</code></a> preferences on a <code>GET</code> request to a delta-link might influence the response in a couple of ways.</p>
<ul>
<li>If the service processes the request synchronously, and no updates are available, then the response is the same as if the respond-async hadn‚Äôt been specified and results in a response as described above.</li>
<li>If the service processes the request asynchronously, then it responds with a <a href="#ResponseCode202Accepted"><code>202 Accepted</code></a> response specifying the URL to the status monitor resource as it would have with any other asynchronous request. Once the service has finished processing the asynchronous request to the delta link resource, if changes are available it invokes the specified callback endpoint. If no changes are available, the service SHOULD wait to notify the client until changes are available. Once notified, the client uses the status monitor resource from the Location header of the previously returned <a href="#ResponseCode202Accepted"><code>202 Accepted</code></a> response to retrieve the results. In case no updates were available after processing the initial request, the result will contain no updates and the client can use the delta-link contained in the result to retrieve the updates that have since become available.</li>
</ul>
<p>If the consumer specifies the same URL as callback endpoint in multiple requests, the service MAY collate them into a single notification once additional data is available for any of the requests. However, the consumer MUST be prepared to deal with receiving up to as many notifications as it requested.</p>
<div class="example">
<p>Example 2: using a HTTP callback endpoint to receive notification</p>
<pre><code>Prefer: callback; url=&quot;http://myserver/notfication/token/12345&quot;</code></pre>
</div>
<p>If the <code>callback</code> preference is specified on an individual request within a batch, then it specifies the callback to be used for tracking changes to that individual request. If the <code>callback</code> preference is specified on a batch, then it specifies the callback to be used for async responses to the batch.</p>
<p>Note: The <code>callback</code> preference was named <code>odata.callback</code> in OData version 4.0. Services that support the<code> callback</code> preference SHOULD also support <code>odata.callback</code> for OData 4.0 clients and clients SHOULD use <code>odata.callback</code> for compatibility with OData 4.0 services. If both <code>callback</code> and <code>odata.callback</code> preferences are specified in the same request, the value of the <code>callback</code> preference SHOULD be used.</p>
</details>
<details open><summary>
<h4 id="8283-preference-continue-on-error-odatacontinue-on-error"><a name="Preferencecontinueonerrorodatacontinueonerror" href="#Preferencecontinueonerrorodatacontinueonerror">8.2.8.3 Preference <code>continue-on-error</code> (<code>odata.continue-on-error</code>)</a></h4>
</summary>
<p>The <code>continue-on-error</code> preference on a <a href="#BatchRequests">batch request</a> is used to request whether, upon encountering a request within the batch that returns an error, the service return the error for that request and continue processing additional requests within the batch (if specified with an implicit or explicit value of <code>true</code>), or rather stop further processing (if specified with an explicit value of <code>false</code>). The syntax of the <code>continue-on-error</code> preference is defined in <a href="#ODataABNF">OData-ABNF</a>.</p>
<p>The <code>continue-on-error</code> preference can also be used on a <a href="#UpdateaCollectionofEntities">delta update</a>, <a href="#UpdateMembersofaCollection">set-based update</a>, or <a href="#DeleteMembersofaCollection">set-based delete</a> to request that the service continue attempting to process changes after receiving an error.</p>
<p>If the service encounters any errors processing the request and returns a successful response code, then it MUST include a <a href="#HeaderPreferenceApplied"><code>Preference-Applied</code></a> response header containing the <code>continue-on-error</code> preference with an explicit value of <code>true</code>.</p>
<p>A service MAY specify support for the <code>continue-on-error</code> preference using an annotation with term <a href="https://github.com/oasis-tcs/odata-vocabularies/blob/main/vocabularies/Org.OData.Capabilities.V1.md#BatchContinueOnErrorSupported"><code>Capabilities.BatchContinueOnErrorSupported</code></a>, see <a href="#ODataVocCap">OData-VocCap</a>.</p>
<p>The <code>continue-on-error</code> preference SHOULD NOT be applied to individual requests within a batch.</p>
<p>Note: The <code>continue-on-error</code> preference was named <code>odata.continue-on-error</code> in OData version 4.0. Services that support the<code> continue-on-error</code> preference SHOULD also support <code>odata.continue-on-error</code> for OData 4.0 clients and clients SHOULD use <code>odata.continue-on-error</code> for compatibility with OData 4.0 services.</p>
</details>
<details open><summary>
<h4 id="8284-preference-include-annotations-odatainclude-annotations"><a name="Preferenceincludeannotationsodataincludeannotations" href="#Preferenceincludeannotationsodataincludeannotations">8.2.8.4 Preference <code>include-annotations</code> (<code>odata.include-annotations</code>)</a></h4>
</summary>
<p>The <code>include-annotations</code> preference in a request for <a href="#RequestingData">data</a> or <a href="#MetadataDocumentRequest">metadata</a> is used to specify the set of annotations the client requests to be included, where applicable, in the response.</p>
<p>The value of the <code>include-annotations</code> preference is a comma-separated list of namespace-qualified term names or term name patterns to include or exclude, with <code>*</code> as a wildcard for name segments. Term names and term name patterns can optionally be followed by a hash (<code>#</code>) character and an annotation qualifier. The full syntax of the <code>include-annotations</code> preference is defined in <a href="#ODataABNF">OData-ABNF</a>.</p>
<p>The most specific identifier always takes precedence, with an explicit name taking precedence over a name pattern, and a longer pattern taking precedence over a shorter pattern. If the same identifier value is requested to both be excluded and included the behavior is undefined; the service MAY return or omit the specified vocabulary but MUST NOT raise an exception.</p>
<div class="example">
<p>Example 3: a <code>Prefer</code> header requesting all annotations within a metadata document to be returned</p>
<pre><code>Prefer: include-annotations=&quot;*&quot;</code></pre>
</div>
<div class="example">
<p>Example 4: a <code>Prefer</code> header requesting that no annotations are returned</p>
<pre><code>Prefer: include-annotations=&quot;-*&quot;</code></pre>
</div>
<div class="example">
<p>Example 5: a <code>Prefer</code> header requesting that all annotations defined under the <code>display</code> namespace (recursively) be returned</p>
<pre><code>Prefer: include-annotations=&quot;display.*&quot;</code></pre>
</div>
<div class="example">
<p>Example 6: a <code>Prefer</code> header requesting that the annotation with the term name <code>subject</code> within the <code>display</code> namespace be returned</p>
<pre><code>Prefer: include-annotations=&quot;display.subject&quot;</code></pre>
</div>
<div class="example">
<p>Example 7: a <code>Prefer</code> header requesting that all annotations defined under the <code>display</code> namespace (recursively) with the qualifier <code>tablet</code> be returned</p>
<pre><code>Prefer: include-annotations=&quot;display.*#tablet&quot;</code></pre>
</div>
<p>The <code>include-annotations</code> preference is only a hint to the service. The service MAY ignore the preference and is free to decide whether or not to return annotations not specified in the <code>include-annotations</code> preference.</p>
<p>In the case that the client has specified the <code>include-annotations</code> preference in the request, the service SHOULD include a <a href="#HeaderPreferenceApplied"><code>Preference-Applied</code></a> response header containing the <code>include-annotations</code> preference to specify the annotations actually included, where applicable, in the response. This value may differ from the annotations requested in the <a href="#HeaderPrefer"><code>Prefer</code></a> header of the request.</p>
<p>If the <code>include-annotations</code> preference is specified on an individual request within a batch, then it specifies the preference for that individual request. Individual requests within a batch that don‚Äôt include the <code>include-annotations</code> preference inherit the preference of the overall batch request.</p>
<p>Note: The <code>include-annotations</code> preference was named <code>odata.include-annotations</code> in OData version 4.0. Services that support the <code>include-annotations</code> preference SHOULD also support <code>odata.include-annotations</code> for OData 4.0 clients and clients SHOULD use <code>odata.include-annotations</code> for compatibility with OData 4.0 services. If both <code>include-annotations</code> and <code>odata.include-annotations</code> preferences are specified in the same request, the value of the <code>include-annotations</code> preference SHOULD be used.</p>
</details>
<details open><summary>
<h4 id="8285-preference-maxpagesize-odatamaxpagesize"><a name="Preferencemaxpagesizeodatamaxpagesize" href="#Preferencemaxpagesizeodatamaxpagesize">8.2.8.5 Preference <code>maxpagesize</code> (<code>odata.maxpagesize</code>)</a></h4>
</summary>
<p>The <code>maxpagesize</code> preference is used to request that each collection within the response contain no more than the number of items specified as the positive integer value of this preference. The syntax of the <code>maxpagesize</code> preference is defined in <a href="#ODataABNF">OData-ABNF</a>.</p>
<div class="example">
<p>Example 8: a request for customers and their orders would result in a response containing one collection with customer entities and for every customer a separate collection with order entities. The client could specify <code>maxpagesize=50</code> in order to request that each page of results contain a maximum of 50 customers, each with a maximum of 50 orders.</p>
</div>
<p>If a collection within the result contains more than the specified <code>maxpagesize</code>, the collection SHOULD be <a href="#ServerDrivenPaging">a partial set of the results</a> with a <a href="#ServerDrivenPaging">next link</a> to the next page of results. The client MAY specify a different value for this preference with every request following a next link.</p>
<p>In the example given above, the result page should include a next link for the customer collection, if there are more than 50 customers, and additional next links for all returned orders collections with more than 50 entities.</p>
<p>If the client has specified the <code>maxpagesize</code> preference in the request, and the service limits the number of items in collections within the response through <a href="#ServerDrivenPaging">server-driven paging</a>, the service MAY include a <a href="#HeaderPreferenceApplied"><code>Preference-Applied</code></a> response header containing the <code>maxpagesize</code> preference and the maximum page size applied. This value may differ from the value requested by the client.</p>
<p>The <code>maxpagesize</code> preference SHOULD NOT be applied to a batch request, but MAY be applied to individual requests within a batch.</p>
<p>Note: The <code>maxpagesize</code> preference was named <code>odata.maxpagesize</code> in OData version 4.0. Services that support the<code> maxpagesize</code> preference SHOULD also support <code>odata.maxpagesize</code> for OData 4.0 clients and clients SHOULD use <code>odata.maxpagesize</code> for compatibility with OData 4.0 services. If both <code>maxpagesize</code> and <code>odata.maxpagesize</code> preferences are specified in the same request, the value of the <code>maxpagesize</code> preference SHOULD be used.</p>
</details>
<details open><summary>
<h4 id="8286-preference-omit-values"><a name="Preferenceomitvalues" href="#Preferenceomitvalues">8.2.8.6 Preference <code>omit-values</code></a></h4>
</summary>
<p>The <code>omit-values</code> preference specifies values that MAY be omitted from a response payload. Valid values are <code>nulls</code> or <code>defaults</code>.</p>
<p>If <code>nulls</code> is specified, then the service MAY omit properties containing null values from the response, in which case it MUST specify the <code>Preference-Applied</code> response header with <code>omit-values=nulls</code>.</p>
<p>If <code>defaults</code> is specified, then the service MAY omit properties containing default values from the response, including nulls for properties that have no other defined default value. Nulls MUST be included for properties that have a non-null default value defined. If the service omits default values, it MUST specify the <code>Preference-Applied</code> response header with <code>omit-values=defaults</code>.</p>
<p>Properties with instance annotations are not affected by this preference and MUST be included in the payload if they would be included without this preference. Clients MUST NOT try to reconstruct a null or default value for properties for which an instance annotation is present and no property value is present, for example if the property is omitted due to permissions and has been replaced with the instance annotation <code>Core.Permissions</code> and a value of <code>None</code>, see <a href="#ODataVocCore">OData-VocCore</a>.</p>
<p>Properties with null or default values MUST be included in delta payloads, if modified.</p>
<p>The response to a <code>POST</code> operation MUST include any properties not set to their default value, and the response to a <code>PUT</code> or <code>PATCH</code> operation MUST include any properties whose values were changed as part of the operation.</p>
<p>The <code>omit-values</code> preference does not affect a request payload.</p>
</details>
<details open><summary>
<h4 id="8287-preference-returnrepresentation-and-returnminimal"><a name="Preferencereturnrepresentationandreturnminimal" href="#Preferencereturnrepresentationandreturnminimal">8.2.8.7 Preference <code>return=representation</code> and <code>return=minimal</code></a></h4>
</summary>
<p>The <code>return=representation</code> and <code>return=minimal</code> preferences are defined in <a href="#rfc7240">RFC7240</a>.</p>
<p>In OData, <code>return=representation</code> or <code>return=minimal</code> is defined for use with a <code>POST</code>, <code>PUT</code>, or <code>PATCH</code> <a href="#DataModification">Data Modification Request</a>, or with an <a href="#Actions">Action Request</a>. Specifying a preference of <code>return=representation</code> or <code>return=minimal</code> in a <code>GET</code> or <code>DELETE</code> request does not have any effect.</p>
<p>A preference of <code>return=representation</code> or <code>return=minimal</code> is allowed on an individual <a href="#DataModification">Data Modification Request</a> or <a href="#Actions">Action Request</a> within a batch, subject to the same restrictions, but SHOULD return a <code>4xx</code> client error if specified on the batch request itself.</p>
<p>A preference of <code>return=minimal</code> requests that the service invoke the request but does not return content in the response. The service MAY apply this preference by returning <a href="#ResponseCode204NoContent"><code>204 No Content</code></a> in which case it MAY include a <a href="#HeaderPreferenceApplied"><code>Preference-Applied</code></a> response header containing the <code>return=minimal</code> preference.</p>
<p>A preference of <code>return=representation</code> requests that the service invokes the request and returns the modified resource. The service MAY apply this preference by returning the representation of the successfully modified resource in the body of the response, formatted according to the rules specified for the requested <a href="#Formats">format</a>. In this case the service MAY include a <a href="#HeaderPreferenceApplied"><code>Preference-Applied</code></a> response header containing the <code>return=representation</code> preference.</p>
<p>The <code>return</code> preference SHOULD NOT be applied to a batch request, but MAY be applied to individual requests within a batch.</p>
</details>
<details open><summary>
<h4 id="8288-preference-respond-async"><a name="Preferencerespondasync" href="#Preferencerespondasync">8.2.8.8 Preference <code>respond-async</code></a></h4>
</summary>
<p>The <code>respond-async</code> preference, as defined in <a href="#rfc7240">RFC7240</a>, allows clients to request that the service process the request asynchronously.</p>
<p>If the client has specified<code> respond-async</code> in the request, the service MAY process the request asynchronously and return a <a href="#ResponseCode202Accepted"><code>202 Accepted</code></a> response.</p>
<p>The <code>respond-async</code> preference MAY be used for batch requests, in which case it applies to the batch request as a whole and not to individual requests within the batch request.</p>
<p>In the case that the service applies the <code>respond-async</code> preference it MUST include a <a href="#HeaderPreferenceApplied"><code>Preference-Applied</code></a> response header containing the <code>respond-async</code> preference.</p>
<p>A service MAY specify the support for the <code>respond-async</code> preference using an annotation with term <a href="https://github.com/oasis-tcs/odata-vocabularies/blob/main/vocabularies/Org.OData.Capabilities.V1.md#AsynchronousRequestsSupported"><code>Capabilities.AsynchronousRequestsSupported</code></a>, see <a href="#ODataVocCap">OData-VocCap</a>.</p>
<div class="example">
<p>Example 9: a service receiving the following header might choose to respond</p>
<ul>
<li>asynchronously if the synchronous processing of the request will take longer than 10 seconds</li>
<li>synchronously after 5 seconds</li>
<li>asynchronously (ignoring the <a href="#Preferencewait"><code>wait</code></a> preference)</li>
<li>synchronously after 15 seconds (ignoring <code>respond-async</code> preference and the <a href="#Preferencewait"><code>wait</code></a> preference)</li>
</ul>
<pre><code>Prefer: respond-async, wait=10</code></pre>
</div>
</details>
<details open><summary>
<h4 id="8289-preference-track-changes-odatatrack-changes"><a name="Preferencetrackchangesodatatrackchanges" href="#Preferencetrackchangesodatatrackchanges">8.2.8.9 Preference <code>track-changes</code> (<code>odata.track-changes</code>)</a></h4>
</summary>
<p>The <code>track-changes</code> preference is used to request that the service return a <a href="#DeltaLinks">delta link</a> that can subsequently be used to obtain <a href="#RequestingChanges">changes</a> (deltas) to this result. The syntax of the <code>track-changes</code> preference is defined in <a href="#ODataABNF">OData-ABNF</a>.</p>
<p>For <a href="#ServerDrivenPaging">paged results</a>, the preference MUST be specified on the initial request. Services MUST ignore the <a href="#Preferencetrackchangesodatatrackchanges"><code>track-changes</code></a> preference if applied to the next link.</p>
<p>The delta link MUST only be returned on the final page of results in place of the next link.</p>
<p>The service includes a <a href="#HeaderPreferenceApplied"><code>Preference-Applied</code></a> response header in the first page of the response containing the <code>track-changes</code> preference to signal that changes are being tracked.</p>
<p>A service MAY specify the support for the <code>track-changes</code> preference using an annotation with term <a href="https://github.com/oasis-tcs/odata-vocabularies/blob/main/vocabularies/Org.OData.Capabilities.V1.md#ChangeTracking"><code>Capabilities.ChangeTracking</code></a>, see <a href="#ODataVocCap">OData-VocCap</a>.</p>
<p>The <code>track-changes</code> preference SHOULD NOT be applied to a batch request, but MAY be applied to individual requests within a batch.</p>
<p>Note: The <code>track-changes</code> preference was named <code>odata.track-changes</code> in OData version 4.0. Services that support the<code> track-changes</code> preference SHOULD also support <code>odata.track-changes</code> for OData 4.0 clients and clients SHOULD use <code>odata.track-changes</code> for compatibility with OData 4.0 services.</p>
</details>
<details open><summary>
<h4 id="82810-preference-wait"><a name="Preferencewait" href="#Preferencewait">8.2.8.10 Preference <code>wait</code></a></h4>
</summary>
<p>The <code>wait</code> preference, as defined in <a href="#rfc7240">RFC7240</a>, is used to establish an upper bound on the length of time, in seconds, the client is prepared to wait for the service to process the request synchronously once it has been received.</p>
<p>If the <a href="#Preferencerespondasync"><code>respond-async</code></a> preference is also specified, the client requests that the service respond asynchronously after the specified length of time.</p>
<p>If the <code>respond-async</code> preference has not been specified, the service MAY interpret the <code>wait</code> as a request to timeout after the specified period of time.</p>
<p>If the <code>wait</code> preference is specified on an individual request within a batch, then it specifies the maximum amount of time to wait for that individual request. If the <code>wait</code> preference is specified on a batch, then it specifies the maximum time to wait for the entire batch.</p>
</details>
</details>
</details>
<details open><summary>
<h2 id="83-response-headers"><a name="ResponseHeaders" href="#ResponseHeaders">8.3 Response Headers</a></h2>
</summary>
<p>In addition to the <a href="#CommonHeaders">Common Headers</a>, the following response headers have defined meaning in OData.</p>
<details open><summary>
<h3 id="831-header-asyncresult"><a name="HeaderAsyncResult" href="#HeaderAsyncResult">8.3.1 Header <code>AsyncResult</code></a></h3>
</summary>
<p>A 4.01 service MUST include the <code>AsyncResult</code> header in <a href="#ResponseCode200OK"><code>200 OK</code></a> responses from a status monitor resource in order to indicate the final <a href="#CommonResponseStatusCodes">HTTP Response Status Code</a> of an <a href="#AsynchronousRequests">asynchronously executed request</a>. The header value is the three-digit HTTP response code, see <a href="#ODataABNF">OData-ABNF</a>.</p>
<p>The <code>AsyncResult</code> header SHOULD NOT be applied to individual responses within a batch.</p>
</details>
<details open><summary>
<h3 id="832-header-etag"><a name="HeaderETag" href="#HeaderETag">8.3.2 Header <code>ETag</code></a></h3>
</summary>
<p>A response MAY include an <code>ETag</code> header, see <a href="#rfc9110">RFC9110</a>. Services MUST include this header if they require an ETag to be specified when modifying the resource.</p>
<p>Services MUST support specifying the value returned in the <code>ETag</code> header in an <a href="#HeaderIfNoneMatch"><code>If-None-Match</code></a> header of a subsequent <a href="#RequestingData">Data Request</a> for the resource. Clients MUST specify the value returned in the <code>ETag</code> header, or star (<code>*</code>), in an <a href="#HeaderIfMatch"><code>If-Match</code></a> header of a subsequent <a href="#DataModification">Data Modification Request</a> or <a href="#Actions">Action Request</a> in order to apply <a href="#UseofETagsforAvoidingUpdateConflicts">optimistic concurrency control</a> in updating, deleting, or invoking an action bound to the resource.</p>
<p>As OData allows multiple formats for representing the same structured information, services SHOULD use weak ETags that only depend on the representation-independent entity state. A strong ETag MUST change whenever the representation of an entity changes, so it has to depend on the <a href="#HeaderContentType"><code>Content-Type</code></a>, the <a href="#HeaderContentEncoding"><code>Content-Encoding</code></a>, and potentially other characteristics of the response.</p>
<p>An <code>ETag</code> header MAY also be returned on a <a href="#MetadataDocumentRequest">metadata document request</a> or <a href="#ServiceDocumentRequest">service document request</a> to allow the client subsequently to make a conditional request for the metadata or service document. Clients can also compare the value of the <code>ETag</code> header returned from a metadata document request to the metadata ETag returned in a response in order to verify the version of the metadata used to generate that response.</p>
<p>The <code>ETag</code> header SHOULD NOT be included for the overall batch response, but MAY be included in individual responses within a batch.</p>
</details>
<details open><summary>
<h3 id="833-header-location"><a name="HeaderLocation" href="#HeaderLocation">8.3.3 Header <code>Location</code></a></h3>
</summary>
<p>The <code>Location</code> header MUST be returned in the response from a <a href="#CreateanEntity">Create Entity</a> or <a href="#CreateaMediaEntity">Create Media Entity</a> request to specify the edit URL, or for read-only entities the read URL, of the created entity, and in responses returning <a href="#ResponseCode202Accepted"><code>202 Accepted</code></a> to specify the URL that the client can use to request the status of an asynchronous request.</p>
<p>The <code>Location</code> header SHOULD NOT be included for the overall batch response, but MAY be included in individual responses within a batch.</p>
</details>
<details open><summary>
<h3 id="834-header-odata-entityid"><a name="HeaderODataEntityId" href="#HeaderODataEntityId">8.3.4 Header <code>OData-EntityId</code></a></h3>
</summary>
<p>A response to a <a href="#CreateanEntity">create</a> or <a href="#UpsertanEntity">upsert</a> operation that returns <a href="#ResponseCode204NoContent"><code>204 No Content</code></a> MUST include an <code>OData-EntityId</code> response header. The value of the header is the <a href="#EntityIdsandEntityReferences">entity-id</a> of the entity that was acted on by the request. The syntax of the <code>OData-EntityId</code> header is defined in <a href="#ODataABNF">OData-ABNF</a>.</p>
<p>The <code>OData-EntityID</code> header SHOULD NOT be included for the overall batch response, but MAY be included in individual responses within a batch.</p>
</details>
<details open><summary>
<h3 id="835-header-odata-error"><a name="HeaderODataError" href="#HeaderODataError">8.3.5 Header <code>OData-Error</code></a></h3>
</summary>
<p>A response with an <a href="#InStreamErrors">in-stream error</a> MAY include an <code>OData-Error</code> trailing header if the transport protocol supports trailing headers (e.g. HTTP/1.1 with chunked transfer encoding, or HTTP/2).</p>
<p>The value of this trailing header is a standard OData error response according to the OData response format, encoded suitably for transport in a header, see e.g. <a href="#ODataJSON">OData-JSON</a>.</p>
</details>
<details open><summary>
<h3 id="836-header-preference-applied"><a name="HeaderPreferenceApplied" href="#HeaderPreferenceApplied">8.3.6 Header <code>Preference-Applied</code></a></h3>
</summary>
<p>In a response to a request that specifies a <a href="#HeaderPrefer"><code>Prefer</code></a> header, a service MAY include a <code>Preference-Applied</code> header, as defined in <a href="#rfc7240">RFC7240</a>, specifying how individual preferences within the request were handled.</p>
<p>The value of the <code>Preference-Applied</code> header is a comma-separated list of preferences applied in the response. For more information on the individual preferences, see the <a href="#HeaderPrefer"><code>Prefer</code></a> header.</p>
<p>If the <code>Preference-Applied</code> header is specified on an individual response within a batch, then it specifies the preferences applied to that individual response. If the <code>Preference-Applied</code> header is specified on a batch response, then it specifies the preferences applied to the overall batch.</p>
</details>
<details open><summary>
<h3 id="837-header-retry-after"><a name="HeaderRetryAfter" href="#HeaderRetryAfter">8.3.7 Header <code>Retry-After</code></a></h3>
</summary>
<p>A service MAY include a <code>Retry-After</code> header, as defined in <a href="#rfc9110">RFC9110</a>), in <a href="#ResponseCode202Accepted"><code>202 Accepted</code></a> and in <a href="#ResponseCode3xxRedirection"><code>3xx Redirect</code></a> responses</p>
<p>The <code>Retry-After</code> header specifies the duration of time, in seconds, that the client is asked to wait before retrying the request or issuing a request to the resource returned as the value of the <a href="#HeaderLocation"><code>Location</code></a> header.</p>
</details>
<details open><summary>
<h3 id="838-header-vary"><a name="HeaderVary" href="#HeaderVary">8.3.8 Header <code>Vary</code></a></h3>
</summary>
<p>If a response varies depending on the <a href="#HeaderODataVersion"><code>OData-Version</code></a> of the response, the service MUST include a <code>Vary</code> header listing the <a href="#HeaderODataMaxVersion"><code>OData-MaxVersion</code></a> request header field to allow correct caching of the response.</p>
<p>If a response varies depending on the applied preferences (<a href="#Preferenceallowentityreferencesodataallowentityreferences"><code>allow-entityreferences</code></a>, <a href="#Preferenceincludeannotationsodataincludeannotations"><code>include-annotations</code></a>, <a href="#Preferenceomitvalues"><code>omit-values</code></a>, <a href="#Preferencereturnrepresentationandreturnminimal"><code>return</code></a>), the service MUST include a <code>Vary</code> header listing the <a href="#HeaderPrefer"><code>Prefer</code></a> request header field to allow correct caching of the response.</p>
<p>Alternatively, the server MAY include a <code>Vary</code> header with the special value <code>*</code> as defined by <a href="#rfc9110">RFC9110</a>, Section 8.2.1. Note that this will make it impossible for a proxy to cache the response, see <a href="#rfc7240">RFC7240</a>.</p>
</details>
</details>
</details>
<hr />
<details open><summary>
<h1 id="9-common-response-status-codes"><a name="CommonResponseStatusCodes" href="#CommonResponseStatusCodes">9 Common Response Status Codes</a></h1>
</summary>
<p>An OData service MAY respond to any request using any valid HTTP status code appropriate for the request. A service SHOULD be as specific as possible in its choice of HTTP status codes.</p>
<p>The following represent the most common success response codes. In some cases, a service MAY respond with a more specific success code.</p>
<details open><summary>
<h2 id="91-success-responses"><a name="SuccessResponses" href="#SuccessResponses">9.1 Success Responses</a></h2>
</summary>
<p>The following response codes represent successful requests.</p>
<details open><summary>
<h3 id="911-response-code-200-ok"><a name="ResponseCode200OK" href="#ResponseCode200OK">9.1.1 Response Code <code>200 OK</code></a></h3>
</summary>
<p>A request that does not create a resource returns <code>200 OK</code> if it is completed successfully and the value of the resource is not <code>null</code>. In this case, the response body MUST contain the value of the resource specified in the request URL.</p>
</details>
<details open><summary>
<h3 id="912-response-code-201-created"><a name="ResponseCode201Created" href="#ResponseCode201Created">9.1.2 Response Code <code>201 Created</code></a></h3>
</summary>
<p>A <a href="#CreateanEntity">Create Entity</a>, <a href="#CreateaMediaEntity">Create Media Entity</a>, or <a href="#InvokinganAction">Invoke Action</a> request that successfully creates a resource returns <code>201 Created</code>. In this case, the response body MUST contain the resource created.</p>
</details>
<details open><summary>
<h3 id="913-response-code-202-accepted"><a name="ResponseCode202Accepted" href="#ResponseCode202Accepted">9.1.3 Response Code <code>202 Accepted</code></a></h3>
</summary>
<p><code>202 Accepted</code> indicates that the <a href="#DataServiceRequests">Data Service Request</a> has been accepted and has not yet completed executing asynchronously. The asynchronous handling of requests is defined in the sections on <a href="#AsynchronousRequests">Asynchronous Requests</a> and <a href="#AsynchronousBatchRequests">Asynchronous Batch Requests</a>.</p>
</details>
<details open><summary>
<h3 id="914-response-code-204-no-content"><a name="ResponseCode204NoContent" href="#ResponseCode204NoContent">9.1.4 Response Code <code>204 No Content</code></a></h3>
</summary>
<p>A request returns <code>204 No Content</code> if the requested resource has the <code>null</code> value, or if the service applies a <a href="#Preferencereturnrepresentationandreturnminimal"><code>return=minimal</code></a> preference. In this case, the response body MUST be empty.</p>
<p>As defined in <a href="#rfc9110">RFC9110</a>, a <a href="#DataModification">Data Modification Request</a> that responds with <code>204 No Content</code> MAY include an <a href="#HeaderETag"><code>ETag</code></a> header with a value reflecting the result of the data modification if and only if the client can reasonably ‚Äúknow‚Äù the new representation of the resource without actually receiving it. For a <code>PUT</code> request this means that the response body of a corresponding <code>200 OK</code> or <code>201 Created</code> response would have been identical to the request body, i.e. no server-side modification of values sent in the request body, no server-calculated values etc. For a <code>PATCH</code> request this means that the response body of a corresponding <code>200 OK</code> or <code>201 Created</code> response would have consisted of all values sent in the request body, plus (for values not sent in the request body) server-side values corresponding to the <code>ETag</code> value sent in the <code>If-Match</code> header of the <code>PATCH</code> request, i.e. the previous values ‚Äúknown‚Äù to the client.</p>
</details>
<details open><summary>
<h3 id="915-response-code-3xx-redirection"><a name="ResponseCode3xxRedirection" href="#ResponseCode3xxRedirection">9.1.5 Response Code <code>3xx Redirection</code></a></h3>
</summary>
<p>As per <a href="#rfc9110">RFC9110</a>, a <code>3xx Redirection</code> indicates that further action needs to be taken by the client in order to fulfill the request. In this case, the response SHOULD include a <a href="#HeaderLocation"><code>Location</code></a> header, as appropriate, with the URL from which the result can be obtained; it MAY include a <a href="#HeaderRetryAfter"><code>Retry-After</code></a> header.</p>
</details>
<details open><summary>
<h3 id="916-response-code-304-not-modified"><a name="ResponseCode304NotModified" href="#ResponseCode304NotModified">9.1.6 Response Code <code>304 Not Modified</code></a></h3>
</summary>
<p>As per <a href="#rfc9110">RFC9110</a>, a <code>304 Not Modified</code> is returned when the client performs a <code>GET</code> request containing an <a href="#HeaderIfNoneMatch"><code>If-None-Match</code></a> header and the content has not changed. In this case the response SHOULD NOT include other headers in order to prevent inconsistencies between cached entity-bodies and updated headers.</p>
<p>The service MUST ensure that no observable change has occurred to the state of the service as a result of any request that returns a <code>304 Not Modified</code>.</p>
</details>
</details>
<details open><summary>
<h2 id="92-client-error-responses"><a name="ClientErrorResponses" href="#ClientErrorResponses">9.2 Client Error Responses</a></h2>
</summary>
<p>Error codes in the <code>4xx</code> range indicate a client error, such as a malformed request.</p>
<p>The service MUST ensure that no observable change has occurred to the state of the service as a result of any request that returns an error status code.</p>
<p>In the case that a response body is defined for the error code, the body of the error is as defined for the appropriate <a href="#Formats">format</a>.</p>
<details open><summary>
<h3 id="921-response-code-404-not-found"><a name="ResponseCode404NotFound" href="#ResponseCode404NotFound">9.2.1 Response Code <code>404 Not Found</code></a></h3>
</summary>
<p><code>404 Not Found</code> indicates that the resource specified by the request URL does not exist. The response body MAY provide additional information.</p>
</details>
<details open><summary>
<h3 id="922-response-code-405-method-not-allowed"><a name="ResponseCode405MethodNotAllowed" href="#ResponseCode405MethodNotAllowed">9.2.2 Response Code <code>405 Method Not Allowed</code></a></h3>
</summary>
<p><code>405 Method Not Allowed</code> indicates that the resource specified by the request URL does not support the request method. In this case the response MUST include an <code>Allow</code> header containing a list of valid request methods for the requested resource as defined in <a href="#rfc9110">RFC9110</a>.</p>
</details>
<details open><summary>
<h3 id="923-response-code-406-not-acceptable"><a name="ResponseCode406NotAcceptable" href="#ResponseCode406NotAcceptable">9.2.3 Response Code <code>406 Not Acceptable</code></a></h3>
</summary>
<p><code>406 Not Acceptable</code> indicates that the resource specified by the request URL does not have a current representation that would be acceptable for the client according to the request headers <a href="#HeaderAccept"><code>Accept</code></a>, <a href="#HeaderAcceptCharset"><code>Accept-Charset</code></a>, and <a href="#HeaderAcceptLanguage"><code>Accept-Language</code></a>, and that the service is unwilling to supply a default representation.</p>
</details>
<details open><summary>
<h3 id="924-response-code-410-gone"><a name="ResponseCode410Gone" href="#ResponseCode410Gone">9.2.4 Response Code <code>410 Gone</code></a></h3>
</summary>
<p><code>410 Gone</code> indicates that the requested resource is no longer available. This can happen if a client has waited too long to follow a <a href="#DeltaLinks">delta link</a> or a <a href="#AsynchronousRequests">status-monitor-resource</a> link, or a next link on a collection that was requested with <a href="#HeaderIsolationODataIsolation">snapshot isolation</a>.</p>
</details>
<details open><summary>
<h3 id="925-response-code-412-precondition-failed"><a name="ResponseCode412PreconditionFailed" href="#ResponseCode412PreconditionFailed">9.2.5 Response Code <code>412 Precondition Failed</code></a></h3>
</summary>
<p>As defined in <a href="#rfc9110">RFC9110</a>, <code>412 Precondition Failed</code> indicates that the client has performed a conditional request and the resource fails the condition. The service MUST ensure that no observable change occurs as a result of the request.</p>
</details>
<details open><summary>
<h3 id="926-response-code-424-failed-dependency"><a name="ResponseCode424FailedDependency" href="#ResponseCode424FailedDependency">9.2.6 Response Code <code>424 Failed Dependency</code></a></h3>
</summary>
<p><code>424 Failed Dependency</code> indicates that a request was not performed due to a failed dependency; for example, a request within a batch that depended upon a request that failed.</p>
</details>
</details>
<details open><summary>
<h2 id="93-server-error-responses"><a name="ServerErrorResponses" href="#ServerErrorResponses">9.3 Server Error Responses</a></h2>
</summary>
<p>As defined in <a href="#rfc9110">RFC9110</a>, error codes in the <code>5xx</code> range indicate service errors.</p>
<details open><summary>
<h3 id="931-response-code-501-not-implemented"><a name="ResponseCode501NotImplemented" href="#ResponseCode501NotImplemented">9.3.1 Response Code <code>501 Not Implemented</code></a></h3>
</summary>
<p>If the client requests functionality not implemented by the OData Service, the service MAY respond with <code>501 Not Implemented</code> and include a response body describing the functionality not implemented.</p>
</details>
</details>
<details open><summary>
<h2 id="94-error-response-body"><a name="ErrorResponseBody" href="#ErrorResponseBody">9.4 Error Response Body</a></h2>
</summary>
<p>An error response body can be the result of a failure of OData processing or of the underlying infrastructure. An OData-specific error response (which can be recognized by the presence of the <a href="#HeaderODataVersion"><code>OData-Version</code></a> header) is format-specific and consists at least of the following information:</p>
<ul>
<li><code>code</code>: required non-null, non-empty, language-independent string. Its value is a service-defined error code. This code serves as a sub-status for the HTTP error code specified in the response.</li>
<li><code>message</code>: required non-null, non-empty, language-dependent, human-readable string describing the error. The <a href="#HeaderContentLanguage"><code>Content-Language</code></a> header MUST contain the language code from <a href="#rfc5646">RFC5646</a> corresponding to the language in which the value for message is written.</li>
<li><code>target</code>: optional nullable, potentially empty string indicating the target of the error, for example, the name of the property in error.</li>
<li><code>details</code>: optional, potentially empty collection of instances of structured types with <code>code</code>, <code>message</code>, and <code>target</code> following the rules above.</li>
<li><code>innererror</code>: optional instance of structured type with service-defined content.</li>
</ul>
<p>Service implementations SHOULD carefully consider which information to include in production environments to guard against potential security concerns around information disclosure.</p>
</details>
<details open><summary>
<h2 id="95-in-stream-errors"><a name="InStreamErrors" href="#InStreamErrors">9.5 In-Stream Errors</a></h2>
</summary>
<p>In the case that the service encounters an error after sending a success status to the client, the service MUST leave the response malformed according to its <a href="#HeaderContentType"><code>Content-Type</code></a> or abort the response by causing an error on transport protocol level. Clients MUST treat the entire response as being in error.</p>
<p>Services MAY include the header <a href="#HeaderODataError"><code>OData-Error</code></a> as a trailing header if supported by the transport protocol (e.g. HTTP/1.1 with chunked transfer encoding, or HTTP/2).</p>
</details>
</details>
<hr />
<details open><summary>
<h1 id="10-context-url"><a name="ContextURL" href="#ContextURL">10 Context URL</a></h1>
</summary>
<p>The <em>context URL</em> describes the content of the payload. It consists of the canonical <a href="#MetadataDocumentRequest">metadata document URL</a> and a fragment identifying the relevant portion of the metadata document. The context URL makes response payloads ‚Äúself-contained‚Äù, allowing a recipient to retrieve metadata, resolve references, and construct canonical links omitted from response payloads in certain optimized formats.</p>
<p>Request payloads generally do not require context URLs as the type of the payload can generally be determined from the request URL.</p>
<p>For details on how the context URL is used to describe a payload, see the relevant sections in the particular format.</p>
<p>The following subsections describe how the context URL is constructed for each category of payload by providing a <em>context URL template</em>. The context URL template uses the following terms:</p>
<ul>
<li><code>{context-url}</code> is the canonical resource path to the <code>$metadata</code> document,</li>
<li><code>{entity-set}</code> is the name of an entity set or path to a containment navigation property,</li>
<li><code>{entity}</code> is the canonical URL for an entity,</li>
<li><code>{singleton}</code> is the canonical URL for a singleton entity,</li>
<li><code>{select-list}</code> is an optional parenthesized comma-separated list of selected properties, instance annotations, functions, and actions,</li>
<li><code>{property-path}</code> is the path to a structural property of the entity,</li>
<li><code>{type-name}</code> is a qualified type name,</li>
<li><code>{/type-name}</code> is an optional type-cast segment containing the qualified name of a derived or implemented type prefixed with a forward slash.</li>
</ul>
<p>The full grammar for the context URL is defined in <a href="#ODataABNF">OData-ABNF</a>. Note that the syntax of the context URL is independent of whatever URL conventions the service uses for addressing individual entities.</p>
<details open><summary>
<h2 id="101-service-document"><a name="ServiceDocument" href="#ServiceDocument">10.1 Service Document</a></h2>
</summary>
<p>Context URL template:</p>
<pre><code>{context-url}</code></pre>
<p>The context URL of the service document is the metadata document URL of the service.</p>
<div class="example">
<p>Example 10: resource URL and corresponding context URL</p>
<pre><code>http://host/service/
http://host/service/$metadata</code></pre>
</div>
</details>
<details open><summary>
<h2 id="102-collection-of-entities"><a name="CollectionofEntities" href="#CollectionofEntities">10.2 Collection of Entities</a></h2>
</summary>
<p>Context URL template:</p>
<pre><code>{context-url}#{entity-set}
{context-url}#Collection({type-name})</code></pre>
<p>If all entities in the collection are members of one entity set, its name is the context URL fragment.</p>
<div class="example">
<p>Example 11: resource URL and corresponding context URL</p>
<pre><code>http://host/service/Customers
http://host/service/$metadata#Customers</code></pre>
</div>
<p>If the entities are contained, then <code>entity-set</code> is the top-level entity set or singleton followed by the canonical path to the containment navigation property of the containing entity. Key values in that path are represented in canonical form (parentheses-style) without percent-encoding.</p>
<div class="example">
<p>Example 12: resource URL and corresponding context URL for contained entities</p>
<pre><code>http://host/service/Orders(4711)/Items
http://host/service/$metadata#Orders(4711)/Items</code></pre>
</div>
<p>If the entities in the response are not bound to a single entity set, such as from a function or action with no entity set path, a function import or action import with no specified entity set, or a navigation property with no navigation property binding, the context URL fragment specifies the type of the returned entity collection.</p>
</details>
<details open><summary>
<h2 id="103-entity"><a name="Entity" href="#Entity">10.3 Entity</a></h2>
</summary>
<p>Context URL template:</p>
<pre><code>{context-url}#{entity-set}/$entity
{context-url}#{type-name}</code></pre>
<p>If a response or response part is a single entity of the declared type of an entity set, the context URL fragment is the entity set‚Äôs name with <code>/$entity</code> appended.</p>
<div class="example">
<p>Example 13: resource URL and corresponding context URL</p>
<pre><code>http://host/service/Customers(1)
http://host/service/$metadata#Customers/$entity</code></pre>
</div>
<p>If the entity is contained, then <code>entity-set</code> is the top-level entity set or singleton followed by the path to the containment navigation property of the containing entity.</p>
<div class="example">
<p>Example 14: resource URL and corresponding context URL for contained entity</p>
<pre><code>http://host/service/Orders(4711)/Items(1)
http://host/service/$metadata#Orders(4711)/Items/$entity</code></pre>
</div>
<p>If the entity is not bound to an entity set, such as an entity returned from a function or action with no entity set path, a function import or action import with no specified entity set, or a navigation property with no navigation property binding, the context URL fragment specifies the type of the returned entity.</p>
</details>
<details open><summary>
<h2 id="104-singleton"><a name="Singleton" href="#Singleton">10.4 Singleton</a></h2>
</summary>
<p>Context URL template:</p>
<pre><code>{context-url}#{singleton}</code></pre>
<p>If a response or response part is a singleton, its name is the context URL fragment.</p>
<div class="example">
<p>Example 15: resource URL and corresponding context URL</p>
<pre><code>http://host/service/MainSupplier
http://host/service/$metadata#MainSupplier</code></pre>
</div>
</details>
<details open><summary>
<h2 id="105-collection-of-derived-entities"><a name="CollectionofDerivedEntities" href="#CollectionofDerivedEntities">10.5 Collection of Derived Entities</a></h2>
</summary>
<p>Context URL template:</p>
<pre><code>{context-url}#{entity-set}{/type-name}</code></pre>
<p>If an entity set consists exclusively of derived entities, a type-cast segment is added to the context URL.</p>
<div class="example">
<p>Example 16: resource URL and corresponding context URL</p>
<pre><code>http://host/service/Customers/Model.VipCustomer
http://host/service/$metadata#Customers/Model.VipCustomer</code></pre>
</div>
</details>
<details open><summary>
<h2 id="106-derived-entity"><a name="DerivedEntity" href="#DerivedEntity">10.6 Derived Entity</a></h2>
</summary>
<p>Context URL template:</p>
<pre><code>{context-url}#{entity-set}{/type-name}/$entity</code></pre>
<p>If a response or response part is a single entity of a type derived from the declared type of an entity set, a type-cast segment is appended to the entity set name.</p>
<div class="example">
<p>Example 17: resource URL and corresponding context URL</p>
<pre><code>http://host/service/Customers(2)/Model.VipCustomer
http://host/service/$metadata#Customers/Model.VipCustomer/$entity</code></pre>
</div>
</details>
<details open><summary>
<h2 id="107-collection-of-projected-entities"><a name="CollectionofProjectedEntities" href="#CollectionofProjectedEntities">10.7 Collection of Projected Entities</a></h2>
</summary>
<p>Context URL templates:</p>
<pre><code>{context-url}#{entity-set}{/type-name}{select-list}
{context-url}#Collection({type-name}){select-list}</code></pre>
<p>If a result contains only a subset of properties, the parenthesized comma-separated list of the selected defined or dynamic properties, instance annotations, navigation properties, functions, and actions is appended to the context URL representing the <a href="#CollectionofEntities">collection of entities</a>.</p>
<p>Regardless of how contained structural properties are represented in the request URL (as paths or as select options) they are represented in the context URL using path syntax, as defined in OData 4.0.</p>
<p>The shortcut <code>*</code> represents the list of all structural properties. Properties defined on types derived from the declared type of the entity set (or type specified in the type-cast segment if specified) are prefixed with the qualified name of the derived type as defined in <a href="#ODataABNF">OData-ABNF</a>.</p>
<p>The list also contains explicitly selected or expanded instance annotations. It is possible to select or expand only instance annotations, in which case only those selected or expanded annotations appear in the result. Note that annotations specified only in the <a href="#Preferenceincludeannotationsodataincludeannotations"><code>include-annotations</code></a> preference do not appear in the context URL and do not affect the selected/expanded properties.</p>
<p>Operations in the context URL are represented using the namespace- or alias-qualified name. Function names suffixed with parentheses represent a specific overload, while function names without parentheses represent all overloads of the function.</p>
<p>OData 4.01 responses MAY use the shortcut pattern <code>{namespace}.*</code> to represent the list of all bound actions or functions available for entities in the collection, see system query option <a href="#SystemQueryOptionselect"><code>$select</code></a>.</p>
<div class="example">
<p>Example 18: resource URL and corresponding context URL</p>
<pre><code>http://host/service/Customers?$select=Address,Orders,Model.VipCustomer/PreferredContact
http://host/service/$metadata#Customers(Address,Orders,Model.VipCustomer/PreferredContact)</code></pre>
</div>
</details>
<details open><summary>
<h2 id="108-projected-entity"><a name="ProjectedEntity" href="#ProjectedEntity">10.8 Projected Entity</a></h2>
</summary>
<p>Context URL templates:</p>
<pre><code>{context-url}#{entity-set}{/type-name}{select-list}/$entity
{context-url}#{singleton}{select-list}
{context-url}#{type-name}{select-list}</code></pre>
<p>If a single entity contains a subset of properties, the parenthesized comma-separated list of the selected defined or dynamic properties, instance annotations, navigation properties, functions, and actions is appended to the <code>{entity-set}</code> after an optional type-cast segment and prior to appending <code>/$entity</code>. If the response is not a subset of a single entity set, the <code>{select-list}</code> is instead appended to the <code>{type-name}</code> of the returned entity.</p>
<p>Regardless of how contained structural properties are represented in the request URL (as paths or as select options) they are represented in the context URL using path syntax, as defined in OData 4.0.</p>
<p>The shortcut <code>*</code> represents the list of all structural properties. Properties defined on types derived from the type of the entity set (or type specified in the type-cast segment if specified) are prefixed with the qualified name of the derived type as defined in <a href="#ODataABNF">OData-ABNF</a>. Note that expanded properties are automatically included in the response.</p>
<p>The list also contains explicitly selected or expanded instance annotations. It is possible to select or expand only instance annotations, in which case only those selected or expanded annotations appear in the result. Note that annotations specified only in the <a href="#Preferenceincludeannotationsodataincludeannotations"><code>include-annotations</code></a> preference do not appear in the context URL and do not affect the selected/expanded properties.</p>
<p>Operations in the context URL are represented using the namespace- or alias-qualified name. Function names suffixed with parentheses represent a specific overload, while function names without parentheses represent all overloads of the function.</p>
<p>OData 4.01 responses MAY use the shortcut pattern <code>{namespace}.*</code> to represent the list of all bound actions or functions available for the returned entity, see system query option <a href="#SystemQueryOptionselect"><code>$select</code></a>.</p>
<div class="example">
<p>Example 19: resource URL and corresponding context URL</p>
<pre><code>http://host/service/Customers(1)?$select=Name,Rating
http://host/service/$metadata#Customers(Name,Rating)/$entity</code></pre>
</div>
</details>
<details open><summary>
<h2 id="109-collection-of-expanded-entities"><a name="CollectionofExpandedEntities" href="#CollectionofExpandedEntities">10.9 Collection of Expanded Entities</a></h2>
</summary>
<p>Context URL template:</p>
<pre><code>{context-url}#{entity-set}{/type-name}{select-list}
{context-url}#Collection({type-name}){select-list}</code></pre>
<p>For a 4.01 response, if a navigation property is explicitly expanded, then in addition to any non-suffixed names of any selected properties, navigation properties, functions or actions, the comma-separated list of properties MUST include the name of the expanded property, suffixed with the parenthesized comma-separated list of any properties of the expanded navigation property that are selected or expanded. If the expanded navigation property does not contain a nested <code>$select</code> or <code>$expand</code>, then the expanded property is suffixed with empty parentheses. If the expansion is recursive for nested children, a plus sign (<code>+</code>) is infixed between the navigation property name and the opening parenthesis.</p>
<p>For a 4.0 response, the expanded navigation property suffixed with parentheses is omitted from the select-list if it does not contain a nested <code>$select</code> or <code>$expand</code>, but MUST still be present, without a suffix, if it is explicitly selected.</p>
<p>The context URL has no shortcut for representing the list of all navigation properties; <code>$expand=*</code> is treated as if all navigation properties were explicitly expanded.</p>
<p>If the context URL includes only expanded navigation properties (i.e., only navigation properties suffixed with parentheses), then all structural properties are implicitly selected (same as if there were no properties listed in the select-list).</p>
<p>Navigation properties with expanded references are not represented in the context URL.</p>
<div class="example">
<p>Example 20: resource URL and corresponding context URL ‚Äî select and expand</p>
<pre><code>http://host/service/Customers?$select=Name&amp;$expand=Address/Country
http://host/service/$metadata#Customers(Name,Address/Country())</code></pre>
</div>
<div class="example">
<p>Example 21: resource URL and corresponding context URL ‚Äî expand <code>$ref</code></p>
<pre><code>http://host/service/Customers?$expand=Orders/$ref
http://host/service/$metadata#Customers</code></pre>
</div>
<div class="example">
<p>Example 22: resource URL and corresponding context URL ‚Äî expand with <code>$levels</code></p>
<pre><code>http://host/service/Employees/Sales.Manager?$select=DirectReports
        &amp;$expand=DirectReports($select=FirstName,LastName;$levels=4)
http://host/service/$metadata
        #Employees/Sales.Manager(DirectReports,DirectReports+(FirstName,LastName))</code></pre>
</div>
</details>
<details open><summary>
<h2 id="1010-expanded-entity"><a name="ExpandedEntity" href="#ExpandedEntity">10.10 Expanded Entity</a></h2>
</summary>
<p>Context URL template:</p>
<pre><code>{context-url}#{entity-set}{/type-name}{select-list}/$entity
{context-url}#{singleton}{select-list}
{context-url}#{type-name}{select-list}</code></pre>
<p>For a 4.01 response, if a navigation property is explicitly expanded, then in addition to the non-suffixed names of any selected properties, navigation properties, functions or actions, the comma-separated list of properties MUST include the name of the expanded property, suffixed with the parenthesized comma-separated list of any properties of the expanded navigation property that are selected or expanded. If the expanded navigation property does not contain a nested <code>$select</code> or <code>$expand</code>, then the expanded property is suffixed with empty parentheses. If the expansion is recursive for nested children, a plus sign (<code>+</code>) is infixed between the navigation property name and the opening parenthesis.</p>
<p>For a 4.0 response, the expanded navigation property suffixed with parentheses is omitted from the select-list if it does not contain a nested <code>$select</code> or <code>$expand</code>, but MUST still be present, without a suffix, if it is explicitly selected.</p>
<p>If the context URL includes only expanded navigation properties (i.e., only navigation properties suffixed with parentheses), then all structural properties are implicitly selected (same as if there were no properties listed in the select-list).</p>
<p>Navigation properties with expanded references are not represented in the context URL.</p>
<div class="example">
<p>Example 23: resource URL and corresponding context URL</p>
<pre><code>http://host/service/Employees(1)/Sales.Manager?
        $expand=DirectReports($select=FirstName,LastName;$levels=4)
http://host/service/$metadata
        #Employees/Sales.Manager(DirectReports+(FirstName,LastName))/$entity</code></pre>
</div>
</details>
<details open><summary>
<h2 id="1011-collection-of-entity-references"><a name="CollectionofEntityReferences" href="#CollectionofEntityReferences">10.11 Collection of Entity References</a></h2>
</summary>
<p>Context URL template:</p>
<pre><code>{context-url}#Collection($ref)</code></pre>
<p>If a response is a collection of entity references, the context URL does not contain the type of the referenced entities.</p>
<div class="example">
<p>Example 24: resource URL and corresponding context URL for a collection of entity references</p>
<pre><code>http://host/service/Customers(&#39;ALFKI&#39;)/Orders/$ref
http://host/service/$metadata#Collection($ref)</code></pre>
</div>
</details>
<details open><summary>
<h2 id="1012-entity-reference"><a name="EntityReference" href="#EntityReference">10.12 Entity Reference</a></h2>
</summary>
<p>Context URL template:</p>
<pre><code>{context-url}#$ref</code></pre>
<p>If a response is a single entity reference, <code>$ref</code> is the context URL fragment.</p>
<div class="example">
<p>Example 25: resource URL and corresponding context URL for a single entity reference</p>
<pre><code>http://host/service/Orders(10643)/Customer/$ref
http://host/service/$metadata#$ref</code></pre>
</div>
</details>
<details open><summary>
<h2 id="1013-property-value"><a name="PropertyValue" href="#PropertyValue">10.13 Property Value</a></h2>
</summary>
<p>Context URL templates:</p>
<pre><code>{context-url}#{entity}/{property-path}{select-list}
{context-url}#{type-name}{select-list}</code></pre>
<p>If a response represents an <a href="#RequestingIndividualProperties">individual property</a> of an entity with a canonical URL, the context URL specifies the canonical URL of the entity and the path to the structural property of that entity. The path MUST include cast segments for properties defined on types derived from the expected type of the previous segment.</p>
<p>If the property value does not contain explicitly or implicitly selected navigation properties or operations, OData 4.01 responses MAY use the less specific second template.</p>
<div class="example">
<p>Example 26: resource URL and corresponding context URL</p>
<pre><code>http://host/service/Customers(1)/Addresses
http://host/service/$metadata#Customers(1)/Addresses</code></pre>
</div>
</details>
<details open><summary>
<h2 id="1014-collection-of-complex-or-primitive-types"><a name="CollectionofComplexorPrimitiveTypes" href="#CollectionofComplexorPrimitiveTypes">10.14 Collection of Complex or Primitive Types</a></h2>
</summary>
<p>Context URL template:</p>
<pre><code>{context-url}#Collection({type-name}){select-list}</code></pre>
<p>If a response is a collection of complex types or primitive types that do not represent an individual property of an entity with a canonical URL, the context URL specifies the fully qualified type of the collection.</p>
<div class="example">
<p>Example 27: resource URL and corresponding context URL</p>
<pre><code>http://host/service/TopFiveHobbies()
http://host/service/$metadata#Collection(Edm.String)</code></pre>
</div>
</details>
<details open><summary>
<h2 id="1015-complex-or-primitive-type"><a name="ComplexorPrimitiveType" href="#ComplexorPrimitiveType">10.15 Complex or Primitive Type</a></h2>
</summary>
<p>Context URL template:</p>
<pre><code>{context-url}#{type-name}{select-list}</code></pre>
<p>If a response is a complex type or primitive type that does not represent an individual property of an entity with a canonical URL, the context URL specifies the fully qualified type of the result.</p>
<div class="example">
<p>Example 28: resource URL and corresponding context URL</p>
<pre><code>http://host/service/MostPopularName()
http://host/service/$metadata#Edm.String</code></pre>
</div>
</details>
<details open><summary>
<h2 id="1016-operation-result"><a name="OperationResult" href="#OperationResult">10.16 Operation Result</a></h2>
</summary>
<p>Context URL templates:</p>
<pre><code>{context-url}#{entity-set}{/type-name}{select-list}
{context-url}#{entity-set}{/type-name}{select-list}/$entity
{context-url}#{entity}/{property-path}{select-list}
{context-url}#Collection({type-name}){select-list}
{context-url}#{type-name}{select-list}</code></pre>
<p>If the response from an action or function is a collection of entities or a single entity that is a member of an entity set, the context URL identifies the entity set. If the response from an action or function is a property of a single entity, the context URL identifies the entity and property. Otherwise, the context URL identifies the type returned by the operation. The context URL will correspond to one of the former examples.</p>
<div class="example">
<p>Example 29: resource URL and corresponding context URL</p>
<pre><code>http://host/service/TopFiveCustomers()
http://host/service/$metadata#Customers</code></pre>
</div>
</details>
<details open><summary>
<h2 id="1017-delta-payload-response"><a name="DeltaPayloadResponse" href="#DeltaPayloadResponse">10.17 Delta Payload Response</a></h2>
</summary>
<p>Context URL template:</p>
<pre><code>{context-url}#{entity-set}{/type-name}{select-list}/$delta
{context-url}#{entity}{select-list}/$delta
{context-url}#{entity}/{property-path}{select-list}/$delta
#$delta</code></pre>
<p>The context URL of a <a href="#RequestingChanges">delta response</a> is the context URL of the response to the defining query, followed by <code>/$delta</code>. This includes singletons, single-valued navigation properties, and collection-valued navigation properties.</p>
<p>If the entities are contained, then <code>{entity-set}</code> is the top-level entity set followed by the path to the containment navigation property of the containing entity.</p>
<div class="example">
<p>Example 30: resource URL and corresponding context URL</p>
<pre><code>http://host/service/Customers?$deltatoken=1234
http://host/service/$metadata#Customers/$delta</code></pre>
</div>
<p>The context URL of an update request body for a collection of entities is simply the fragment <code>#$delta</code>.</p>
</details>
<details open><summary>
<h2 id="1018-item-in-a-delta-payload-response"><a name="IteminaDeltaPayloadResponse" href="#IteminaDeltaPayloadResponse">10.18 Item in a Delta Payload Response</a></h2>
</summary>
<p>Context URL templates:</p>
<pre><code>{context-url}#{entity-set}/$deletedEntity
{context-url}#{entity-set}/$link
{context-url}#{entity-set}/$deletedLink</code></pre>
<p>In addition to new or changed entities which have the canonical context URL for an entity, a delta response can contain deleted entities, new links, and deleted links. They are identified by the corresponding context URL fragment. <code>{entity-set}</code> corresponds to the set of the deleted entity, or source entity for an added or deleted link.</p>
</details>
<details open><summary>
<h2 id="1019-all-response"><a name="allResponse" href="#allResponse">10.19 <code>$all</code> Response</a></h2>
</summary>
<p>Context URL template:</p>
<pre><code>{context-url}#Collection(Edm.EntityType)</code></pre>
<p>Responses to requests to the virtual collection <code>$all</code> (see <a href="#ODataURL">OData-URL</a>) use the built-in abstract entity type. Each single entity in such a response has its individual context URL that identifies the entity set or singleton.</p>
</details>
<details open><summary>
<h2 id="1020-crossjoin-response"><a name="crossjoinResponse" href="#crossjoinResponse">10.20 <code>$crossjoin</code> Response</a></h2>
</summary>
<p>Context URL template:</p>
<pre><code>{context-url}#Collection(Edm.ComplexType)</code></pre>
<p>Responses to requests to the virtual collections <code>$crossjoin(‚Ä¶)</code> (see <a href="#ODataURL">OData-URL</a>) use the built-in abstract complex type. Single instances in these responses do not have a context URL.</p>
</details>
</details>
<hr />
<details open><summary>
<h1 id="11-data-service-requests"><a name="DataServiceRequests" href="#DataServiceRequests">11 Data Service Requests</a></h1>
</summary>
<p>This chapter describes the semantics of the HTTP verbs <code>GET</code>, <code>POST</code>, <code>PATCH</code>, <code>PUT</code>, and <code>DELETE</code> for OData resources.</p>
<p><code>GET</code> requests:</p>
<ul>
<li><a href="#MetadataRequests">Metadata Requests</a> and subsections</li>
<li><a href="#RequestingData">Requesting Data</a> and subsections</li>
<li><a href="#RequestingChanges">Requesting Changes</a> and subsections</li>
<li><a href="#Functions">Functions</a> and subsections</li>
</ul>
<p><code>POST</code> requests:</p>
<ul>
<li><a href="#CreateanEntity">Create an Entity</a> and subsections</li>
<li><a href="#CreateaMediaEntity">Create a Media Entity</a></li>
<li><a href="#PositionalInserts">Positional Inserts</a></li>
<li><a href="#Actions">Actions</a> and subsections</li>
<li><a href="#BatchRequests">Batch Requests</a> and subsections</li>
</ul>
<p><code>PATCH</code> and <code>PUT</code> requests:</p>
<ul>
<li><a href="#UpdateanEntity">Update an Entity</a> and subsections</li>
<li><a href="#UpsertanEntity">Upsert an Entity</a></li>
<li><a href="#ModifyingRelationshipsbetweenEntities">Modifying Relationships between Entities</a> and subsections</li>
<li><a href="#UpdateaMediaEntityStream">Update a Media Entity Stream</a></li>
<li><a href="#UpdateStreamValues">Update Stream Values</a></li>
<li><a href="#UpdateaPrimitiveProperty">Update a Primitive Property</a></li>
<li><a href="#UpdateaComplexProperty">Update a Complex Property</a></li>
<li><a href="#UpdateaCollectionProperty">Update a Collection Property</a></li>
<li><a href="#ManagingMembersofanOrderedCollection">Managing Members of an Ordered Collection</a></li>
<li><a href="#UpdateaCollectionofEntities">Update a Collection of Entities</a></li>
<li><a href="#UpdateMembersofaCollection">Update Members of a Collection</a></li>
</ul>
<p><code>DELETE</code> requests:</p>
<ul>
<li><a href="#DeleteanEntity">Delete an Entity</a></li>
<li><a href="#DeleteaMediaEntity">Delete a Media Entity</a></li>
<li><a href="#DeleteStreamValues">Delete Stream Values</a></li>
<li><a href="#SetaValuetoNull">Set a Value to Null</a></li>
<li><a href="#DeleteMembersofaCollection">Delete Members of a Collection</a></li>
</ul>
<details open><summary>
<h2 id="111-metadata-requests"><a name="MetadataRequests" href="#MetadataRequests">11.1 Metadata Requests</a></h2>
</summary>
<p>An OData service is a self-describing service that exposes metadata defining the entity sets, singletons, relationships, entity types, and operations.</p>
<details open><summary>
<h3 id="1111-service-document-request"><a name="ServiceDocumentRequest" href="#ServiceDocumentRequest">11.1.1 Service Document Request</a></h3>
</summary>
<p>Service documents enable simple hypermedia-driven clients to enumerate and explore the resources offered by the data service.</p>
<p>OData services MUST support returning a service document from the root URL of the service (the <em>service root</em>).</p>
<p>The format of the service document is dependent upon the format selected.</p>
</details>
<details open><summary>
<h3 id="1112-metadata-document-request"><a name="MetadataDocumentRequest" href="#MetadataDocumentRequest">11.1.2 Metadata Document Request</a></h3>
</summary>
<p>An OData <em>metadata document</em> is a representation of the <a href="#DataModel">data model</a> that describes the data and operations exposed by an OData service.</p>
<p><a href="#ODataCSDL">OData-CSDLJSON</a> describes a JSON representation for OData metadata documents and provides a JSON schema to validate their contents. The media type of the JSON representation of an OData metadata document is <code>application/json</code>.</p>
<p><a href="#ODataCSDL">OData-CSDLXML</a> describes an XML representation for OData metadata documents and provides an XML schema to validate their contents. The media type of the XML representation of an OData metadata document is <code>application/xml</code>.</p>
<p>OData services can expose a metadata document that describes the data model exposed by the service. The <em>metadata document URL</em> MUST be the root URL of the service with <code>$metadata</code> appended. To retrieve this document the client issues a <code>GET</code> request to the metadata document URL.</p>
<p>If a request for metadata does not specify a format preference (via <a href="#HeaderAccept"><code>Accept</code></a> header or <a href="#SystemQueryOptionformat"><code>$format</code></a>) then the XML representation MUST be returned.</p>
</details>
</details>
<details open><summary>
<h2 id="112-requesting-data"><a name="RequestingData" href="#RequestingData">11.2 Requesting Data</a></h2>
</summary>
<p>OData services support requests for data via HTTP <code>GET</code> requests.</p>
<p>The path of the URL specifies the target of the request (for example; the collection of entities, entity, navigation property, structural property, or operation). Additional query operators, such as filter, sort, page, and projection operations are specified through query options.</p>
<p>This section describes the types of data requests defined by OData. For complete details on the syntax for building requests, see <a href="#ODataURL">OData-URL</a>.</p>
<p>OData services are hypermedia driven services that return URLs to the client. If a client subsequently requests the advertised resource and the URL has expired, then the service SHOULD respond with <a href="#ResponseCode410Gone"><code>410 Gone</code></a>. If this is not feasible, the service MUST respond with <a href="#ResponseCode404NotFound"><code>404 Not Found</code></a>.</p>
<p>The format of the returned data is dependent upon the request and the format specified by the client, either in the <a href="#HeaderAccept"><code>Accept</code></a> header or using the <a href="#SystemQueryOptionformat"><code>$format</code></a> query option. If the client specifies neither an <a href="#HeaderAccept"><code>Accept</code></a> header nor the <a href="#SystemQueryOptionformat"><code>$format</code></a> query option, the service is allowed to return the response in any format.</p>
<details open><summary>
<h3 id="1121-system-query-options"><a name="SystemQueryOptions" href="#SystemQueryOptions">11.2.1 System Query Options</a></h3>
</summary>
<p>OData defines a number of system query options that allow refining the request. System query options are prefixed with the dollar (<code>$</code>) character, which is optional in OData 4.01. 4.01 services MUST support case-insensitive system query option names specified with or without the <code>$</code> prefix. Clients that want to work with 4.0 services MUST use lower case names and specify the <code>$</code> prefix.</p>
<p>The result of the request MUST be as if the system query options were evaluated in the following order.</p>
<ul>
<li><a href="#SystemQueryOptionschemaversion"><code>$schemaversion</code></a> MUST be evaluated first, because it may influence any further processing.</li>
</ul>
<p>Prior to applying any <a href="#ServerDrivenPaging">server-driven paging</a>:</p>
<ul>
<li><code>$apply</code> ‚Äî defined in <a href="#ODataAggregation">OData-Aggregation</a></li>
<li><a href="#SystemQueryOptioncompute"><code>$compute</code></a></li>
<li><a href="#SystemQueryOptionsearch"><code>$search</code></a></li>
<li><a href="#SystemQueryOptionfilter"><code>$filter</code></a></li>
<li><a href="#SystemQueryOptioncount"><code>$count</code></a></li>
<li><a href="#SystemQueryOptionorderby"><code>$orderby</code></a></li>
<li><a href="#SystemQueryOptionskip"><code>$skip</code></a></li>
<li><a href="#SystemQueryOptiontop"><code>$top</code></a></li>
</ul>
<p>After applying any <a href="#ServerDrivenPaging">server-driven paging</a>:</p>
<ul>
<li><a href="#SystemQueryOptionexpand"><code>$expand</code></a></li>
<li><a href="#SystemQueryOptionselect"><code>$select</code></a></li>
<li><a href="#SystemQueryOptionformat"><code>$format</code></a></li>
</ul>
</details>
<details open><summary>
<h3 id="1122-requesting-individual-entities"><a name="RequestingIndividualEntities" href="#RequestingIndividualEntities">11.2.2 Requesting Individual Entities</a></h3>
</summary>
<p>To retrieve an individual entity, the client makes a <code>GET</code> request to a URL that identifies the entity, e.g. its read URL.</p>
<p>The read URL can be obtained from a response payload containing that instance, for example as a <code>readLink</code> or <code>editLink</code> in an <a href="#ODataJSON">OData-JSON</a> payload. In addition, services MAY support conventions for constructing a read URL using the entity‚Äôs key value(s), as described in <a href="#ODataURL">OData-URL</a>.</p>
<p>The set of structural or navigation properties to return may be specified through <a href="#SystemQueryOptionselect"><code>$select</code></a> or <a href="#SystemQueryOptionexpand"><code>$expand</code></a> system query options.</p>
<p>Clients MUST be prepared to receive additional properties in an entity or complex type instance that are not advertised in metadata, even for types not marked as open.</p>
<p>Properties that are not available are not returned. If their unavailability is due to permissions, the <a href="https://github.com/oasis-tcs/odata-vocabularies/blob/main/vocabularies/Org.OData.Core.V1.md#Permissions"><code>Core.Permissions</code></a> annotation, defined in <a href="#ODataVocCore">OData-VocCore</a> MUST be returned for the property with a value of <code>None</code>. If the <a href="#Preferenceomitvalues"><code>omit-values</code></a> preference is applied, <code>Core.Permissions</code> or another specific annotation that explains the reason MUST be returned for every unavailable property.</p>
<p>If no entity exists with the specified request URL, the service responds with <a href="#ResponseCode404NotFound"><code>404 Not Found</code></a>.</p>
</details>
<details open><summary>
<h3 id="1123-requesting-the-media-stream-of-a-media-entity-using-value"><a name="RequestingtheMediaStreamofaMediaEntityusingvalue" href="#RequestingtheMediaStreamofaMediaEntityusingvalue">11.2.3 Requesting the Media Stream of a Media Entity using <code>$value</code></a></h3>
</summary>
<p>A <em>media entity</em> is an entity that represents an out-of-band stream, such as a photograph.</p>
<p>Use a media entity if the out-of-band stream is the main topic of interest and the media entity is just structured additional information attached to the stream. Use a normal entity with one or more <a href="#ManagingStreamProperties">stream properties</a> if the structured data of the entity is the main topic of interest and the stream data is just additional information attached to the structured data.</p>
<p>To address the media stream represented by a media entity, clients append <code>/$value</code> to the resource path of the media entity URL. The media type of the response is the media type of the stream, subject to content type negotiation based on the <a href="#HeaderAccept"><code>Accept</code></a> header of the request. The response body is the octet-stream that represents the raw value of the media stream with that media type. Alternatively, services MAY redirect from this canonical URL to the source URL of the media stream.</p>
<p>Appending <code>/$value</code> to an entity that is not a media entity returns <code>400 Bad Request</code>.</p>
<p>Attempting to retrieve the media stream from a single-valued navigation property referencing a media entity whose value is null returns <a href="#ResponseCode404NotFound"><code>404 Not Found</code></a>.</p>
</details>
<details open><summary>
<h3 id="1124-requesting-individual-properties"><a name="RequestingIndividualProperties" href="#RequestingIndividualProperties">11.2.4 Requesting Individual Properties</a></h3>
</summary>
<p>To retrieve an individual property, the client issues a <code>GET</code> request to the property URL. The property URL is the entity read URL with <code>/</code> and the property name appended.</p>
<p>For complex typed properties, the path can be further extended with the name of an individual property of the complex type.</p>
<p>See <a href="#ODataURL">OData-URL</a> for details.</p>
<p>If the property is single-valued and has the <code>null</code> value, the service responds with <a href="#ResponseCode204NoContent"><code>204 No Content</code></a>.</p>
<p>If the property is not available, for example due to permissions, the service responds with <a href="#ResponseCode404NotFound"><code>404 Not Found</code></a>.</p>
<div class="example">
<p>Example 31:</p>
<pre><code>GET http://host/service/Products(1)/Name</code></pre>
</div>
<details open><summary>
<h4 id="11241-requesting-stream-properties"><a name="RequestingStreamProperties" href="#RequestingStreamProperties">11.2.4.1 Requesting Stream Properties</a></h4>
</summary>
<p>If the property being requested has type <code>Edm.Stream</code> (see <a href="#ODataURL">OData-URL, section 9</a>), the media type of the response is the media type of the stream, subject to content type negotiation based on the <a href="#HeaderAccept"><code>Accept</code></a> header of the request. The response body is the octet-stream that represents the raw value of the stream property with that media type.</p>
<p>Note this response format disregards any <a href="#SystemQueryOptionformat"><code>$format</code></a> system query option.</p>
</details>
<details open><summary>
<h4 id="11242-requesting-a-raw-value-using-value"><a name="RequestingaRawValueusingvalue" href="#RequestingaRawValueusingvalue">11.2.4.2 Requesting a Raw Value using <code>$value</code></a></h4>
</summary>
<p>To retrieve the raw value of a primitive property or operation result, the client sends a <code>GET</code> request to the raw value URL. See the <a href="#ODataURL">OData-URL</a> document for details.</p>
<p>The <code>Content-Type</code> of the response is determined using the <code>Accept</code> header and the <a href="#SystemQueryOptionformat"><code>$format</code></a> system query option.</p>
<p>The default format for <code>Edm.Binary</code> is the format specified by the <a href="https://github.com/oasis-tcs/odata-vocabularies/blob/main/vocabularies/Org.OData.Core.V1.md#MediaType"><code>Core.MediaType</code></a> annotation (see <a href="#ODataVocCore">OData-VocCore</a>) if this annotation is present. If not annotated, the format cannot be predicted by the client.</p>
<p>The default format for <code>Edm.Geo</code> types is <code>text/plain</code> using the WKT (well-known text) format, see rules <code>fullCollectionLiteral</code>, <code>fullLineStringLiteral</code>, <code>fullMultiPointLiteral</code>, <code>fullMultiLineStringLiteral</code>, <code>fullMultiPolygonLiteral</code>, <code>fullPointLiteral</code>, and <code>fullPolygonLiteral</code> in <a href="#ODataABNF">OData-ABNF</a>.</p>
<p>The default format for single primitive values except <code>Edm.Binary</code> and the <code>Edm.Geo</code> types is <code>text/plain</code>. Responses of type <code>Edm.String</code> can use the <code>charset</code> format parameter to specify the character set used for representing the string value. Responses for the other primitive types follow the rules <code>booleanValue</code>, <code>byteValue</code>, <code>dateValue</code>, <code>dateTimeOffsetValue</code>, <code>decimalValue</code>, <code>doubleValue</code>, <code>durationValue</code>, <code>enumValue</code>, <code>guidValue</code>, <code>int16Value</code>, <code>int32Value</code>, <code>int64Value</code>, <code>sbyteValue</code>, <code>singleValue</code>, and <code>timeOfDayValue</code> in <a href="#ODataABNF">OData-ABNF</a>.</p>
<p>A raw value request for a property or operation result of type <code>Edm.Stream</code> returns <code>400 Bad Request</code>.</p>
<p>A raw value request for a property or operation result that is <code>null</code> results in a <a href="#ResponseCode204NoContent"><code>204 No Content</code></a> response.</p>
<p>If the property or operation result is not available, for example due to permissions, the service responds with <a href="#ResponseCode404NotFound"><code>404 Not Found</code></a>.</p>
<div class="example">
<p>Example 32:</p>
<pre><code>GET http://host/service/Products(1)/Name/$value</code></pre>
</div>
</details>
</details>
<details open><summary>
<h3 id="1125-specifying-properties-to-return"><a name="SpecifyingPropertiestoReturn" href="#SpecifyingPropertiestoReturn">11.2.5 Specifying Properties to Return</a></h3>
</summary>
<p>The <a href="#SystemQueryOptionselect"><code>$select</code></a> and <a href="#SystemQueryOptionexpand"><code>$expand</code></a> system query options enable the client to specify the set of structural properties and navigation properties to include in a response. The service MAY include additional properties not specified in <a href="#SystemQueryOptionselect"><code>$select</code></a> and <a href="#SystemQueryOptionexpand"><code>$expand</code></a>, including properties not defined in <a href="#MetadataDocumentRequest">the metadata document</a>.</p>
<details open><summary>
<h4 id="11251-system-query-option-select"><a name="SystemQueryOptionselect" href="#SystemQueryOptionselect">11.2.5.1 System Query Option <code>$select</code></a></h4>
</summary>
<p>The <code>$select</code> system query option requests that the service return only the properties, dynamic properties, <a href="#Actions">actions</a> and <a href="#Functions">functions</a> explicitly requested by the client. The service returns the specified content, if available, along with any available <a href="#SystemQueryOptionexpand">expanded</a> navigation or stream properties, and MAY return additional information.</p>
<p>The value of the <code>$select</code> query option is a comma-separated list of paths that end with properties, non-entity-valued instance annotations, qualified action names, or qualified function names, as well as of the star operator (<code>*</code>), or the star operator prefixed with the namespace or alias of the schema in order to specify all operations defined in the schema. Only aliases defined in the metadata document of the service can be used in URLs.</p>
<div class="example">
<p>Example 33: request only the <code>Rating</code> and <code>ReleaseDate</code> for the matching Products</p>
<pre><code>GET http://host/service/Products?$select=Rating,ReleaseDate</code></pre>
</div>
<p>It is also possible to request all structural properties, including any dynamic properties, using the star operator. The star operator SHOULD NOT introduce navigation properties, actions or functions not otherwise requested.</p>
<div class="example">
<p>Example 34:</p>
<pre><code>GET http://host/service/Products?$select=*</code></pre>
</div>
<p>Properties of related entities can be specified by including the <code>$select</code> query option within the <code>$expand</code>.</p>
<div class="example">
<p>Example 35:</p>
<pre><code>GET http://host/service/Products?$expand=Category($select=Name)</code></pre>
</div>
<p>The properties specified in <code>$select</code> are represented in addition to any expanded navigation or stream properties. If a navigation property is specified in <code>$select</code>, then the corresponding navigation link is represented in the response. If the navigation property also appears in an <a href="#SystemQueryOptionexpand"><code>$expand</code></a> query option, then it is additionally represented as inline content.</p>
<div class="example">
<p>Example 36: for each category, return the <code>CategoryName</code> and the <code>Products</code> navigation link</p>
<pre><code>GET http://host/service/Categories?$select=CategoryName,Products</code></pre>
</div>
<p>It is also possible to request all actions or functions available for each returned entity.</p>
<div class="example">
<p>Example 37:</p>
<pre><code>GET http://host/service/Products?$select=DemoService.*</code></pre>
</div>
<p>Query options can be applied to a selected property by appending a semicolon-separated list of query options, enclosed in parentheses, to the property. Allowed system query options are <a href="#SystemQueryOptionselect"><code>$select</code></a> and <a href="#SystemQueryOptioncompute"><code>$compute</code></a> for complex properties, plus <a href="#SystemQueryOptionfilter"><code>$filter</code></a>, <a href="#SystemQueryOptionsearch"><code>$search</code></a>, <a href="#SystemQueryOptioncount"><code>$count</code></a>, <a href="#SystemQueryOptionorderby"><code>$orderby</code></a>, <a href="#SystemQueryOptionskip"><code>$skip</code></a>, and <a href="#SystemQueryOptiontop"><code>$top</code></a> for collection-valued properties. A property MUST NOT have select options specified in more than one place in a request and MUST NOT have both select options and expand options specified.</p>
<p>If the <code>$select</code> query option is not specified, [the service returns the full set of properties or a default set of properties. The default set of properties MUST include all key properties. Services may change the default set of properties returned. This includes returning new properties by default and omitting properties previously returned by default. Clients that rely on specific properties in the response MUST use <code>$select</code> with the required properties or with <code>*</code>.</p>
<p>If the service returns less than the full set of properties, either because the client specified a select or because the service returned a subset of properties in the absence of a select, the <a href="#ContextURL">context URL</a> MUST reflect the set of selected properties and projected <a href="#SystemQueryOptionexpand">expanded</a> navigation properties.</p>
</details>
<details open><summary>
<h4 id="11252-system-query-option-expand"><a name="SystemQueryOptionexpand" href="#SystemQueryOptionexpand">11.2.5.2 System Query Option <code>$expand</code></a></h4>
</summary>
<p>The <code>$expand</code> system query option indicates the related entities and stream values that MUST be represented inline. The service MUST return the specified content, and MAY choose to return additional information.</p>
<p>The value of <code>$expand</code> is a comma-separated list of expand items. Each expand item is evaluated relative to the retrieved resource being expanded.</p>
<p>For a full description of the syntax used when building requests, see <a href="#ODataURL">OData-URL</a>, section 5.1.3.</p>
<div class="example">
<p>Example 38: for each customer entity within the Customers entity set the value of all related Orders will be represented inline</p>
<pre><code>GET http://host/service.svc/Customers?$expand=Orders</code></pre>
</div>
<div class="example">
<p>Example 39: for each customer entity within the Customers entity set the references to the related Orders will be represented inline</p>
<pre><code>GET http://host/service.svc/Customers?$expand=Orders/$ref</code></pre>
</div>
<div class="example">
<p>Example 40: for each customer entity within the Customers entity set the media stream representing the customer photo will be represented inline</p>
<pre><code>GET http://host/service.svc/Customers?$expand=Photo</code></pre>
</div>
<details open><summary>
<h5 id="112521-expand-options"><a name="ExpandOptions" href="#ExpandOptions">11.2.5.2.1 Expand Options</a></h5>
</summary>
<p>The set of expanded entities can be further refined through the application of expand options, expressed as a semicolon-separated list of system query options, enclosed in parentheses, see <a href="#ODataURL">OData-URL</a>.</p>
<p>Allowed system query options are <a href="#SystemQueryOptioncompute"><code>$compute</code></a>, <a href="#SystemQueryOptionselect"><code>$select</code></a>, <code>$expand</code>, and <a href="#ExpandOptionlevels"><code>$levels</code></a> for all navigation properties, plus <a href="#SystemQueryOptionfilter"><code>$filter</code></a>, <a href="#SystemQueryOptionorderby"><code>$orderby</code></a>, <a href="#SystemQueryOptionskip"><code>$skip</code></a>, <a href="#SystemQueryOptiontop"><code>$top</code></a>, <a href="#SystemQueryOptioncount"><code>$count</code></a>, and <a href="#SystemQueryOptionsearch"><code>$search</code></a> for collection-valued navigation properties.</p>
<div class="example">
<p>Example 41: for each customer entity within the <code>Customers</code> entity set, the value of those related <code>Orders</code> whose <code>Amount</code> is greater than 100 will be represented inline</p>
<pre><code>GET http://host/service.svc/Customers?$expand=Orders($filter=Amount gt 100)</code></pre>
</div>
<div class="example">
<p>Example 42: for each order within the <code>Orders</code> entity set, the following will be represented inline:</p>
<ul>
<li>The <code>Items</code> related to the <code>Orders</code> identified by the resource path section of the URL and the products related to each order item.</li>
<li>The <code>Customer</code> related to each order returned.</li>
</ul>
<pre><code>GET http://host/service.svc/Orders?$expand=Items($expand=Product),Customer</code></pre>
</div>
<div class="example">
<p>Example 43: for each customer entity in the Customers entity set, the value of all related InHouseStaff will be represented inline if the entity is of type VipCustomer or a subtype of that. For entities that are not of type <code>VipCustomer</code>, or any of its subtypes, that entity may be returned with no inline representation for the expanded navigation property <code>InHouseStaff</code> (the service can always send more than requested)</p>
<pre><code>GET http://host/service.svc/Customers?$expand=SampleModel.VipCustomer/InHouseStaff</code></pre>
</div>
<details open><summary>
<h6 id="1125211-expand-option-levels"><a name="ExpandOptionlevels" href="#ExpandOptionlevels">11.2.5.2.1.1 Expand Option <code>$levels</code></a></h6>
</summary>
<p>The <code>$levels</code> expand option can be used to specify the number of levels of recursion for a hierarchy in which the related entity type is the same as, or can be cast to, the source entity type. A <code>$levels</code> option with a value of 1 specifies a single expand with no recursion. All provided expand options except <code>$levels</code> are applied at each level of the hierarchy.</p>
<p>Services MAY support the symbolic value <code>max</code> in addition to numeric values. In that case they MUST solve circular dependencies by injecting an entity reference somewhere in the circular dependency.</p>
<p>Clients using <code>$levels=max</code> MUST be prepared to handle entity references in cases were a circular reference would occur otherwise.</p>
<p>4.01 services that support <code>max</code> SHOULD do so in a case-insensitive manner. Clients that want to work with 4.0 services MUST use lower case.</p>
<div class="example">
<p>Example 44: return each employee from the Employees entity set and, for each employee that is a manager, return all direct reports, recursively to four levels</p>
<pre><code>GET http://host/service/Employees?$expand=Model.Manager/DirectReports($levels=4)</code></pre>
</div>
</details>
</details>
</details>
<details open><summary>
<h4 id="11253-system-query-option-compute"><a name="SystemQueryOptioncompute" href="#SystemQueryOptioncompute">11.2.5.3 System Query Option <code>$compute</code></a></h4>
</summary>
<p>The <code>$compute</code> system query option allows clients to define computed properties that can be used in a <a href="#SystemQueryOptionselect"><code>$select</code></a> or within a <a href="#SystemQueryOptionfilter"><code>$filter</code></a> or <a href="#SystemQueryOptionorderby"><code>$orderby</code></a> expression.</p>
<p>Computed properties SHOULD be included as dynamic properties in the result and MUST be included if <code>$select</code> is specified with the computed property name, or star (<code>*</code>).</p>
<div class="example">
<p>Example 45: compute total price for order items (line breaks only for readability)</p>
<pre><code>GET http://host/service/Customers
   ?$filter=Orders/any(o:o/TotalPrice gt 100)
   &amp;$expand=Orders($compute=Price mult Qty as TotalPrice
                  ;$select=Name,Price,Qty,TotalPrice)</code></pre>
</div>
</details>
</details>
<details open><summary>
<h3 id="1126-querying-collections"><a name="QueryingCollections" href="#QueryingCollections">11.2.6 Querying Collections</a></h3>
</summary>
<p>OData services support querying collections of entities, complex type instances, and primitive values.</p>
<p>The target collection is specified through a URL, and query operations such as filter, sort, paging, and projection are specified as <a href="#SystemQueryOptions"><em>system query options</em></a> optionally prefixed with a dollar (<code>$</code>) character. 4.01 Services MUST support case-insensitive system query option names specified with or without the <code>$</code> prefix. Clients that want to work with 4.0 services MUST use lower case names and specify the <code>$</code> prefix.</p>
<p>The same system query option MUST NOT be specified more than once for any resource.</p>
<p>An OData service MAY support some or all of the system query options defined. If a data service does not support a system query option, it MUST fail any request that contains the unsupported option and SHOULD return <a href="#ResponseCode501NotImplemented"><code>501 Not Implemented</code></a>.</p>
<details open><summary>
<h4 id="11261-system-query-option-filter"><a name="SystemQueryOptionfilter" href="#SystemQueryOptionfilter">11.2.6.1 System Query Option <code>$filter</code></a></h4>
</summary>
<p>The <code>$filter</code> system query option restricts the set of items returned.</p>
<div class="example">
<p>Example 46: return all Products whose <code>Price</code> is less than $10.00</p>
<pre><code>GET http://host/service/Products?$filter=Price lt 10.00</code></pre>
</div>
<p>The <a href="#SystemQueryOptioncount"><code>$count</code></a> segment may be used within a <code>$filter</code> expression to limit the items returned based on the exact count of related entities or items within a collection-valued property.</p>
<div class="example">
<p>Example 47: return all Categories with less than 10 products</p>
<pre><code>GET http://host/service/Categories?$filter=Products/$count lt 10</code></pre>
</div>
<p>The value of the <code>$filter</code> option is a Boolean expression as defined in <a href="#ODataABNF">OData-ABNF</a>.</p>
<details open><summary>
<h5 id="112611-built-in-filter-operations"><a name="BuiltinFilterOperations" href="#BuiltinFilterOperations">11.2.6.1.1 Built-in Filter Operations</a></h5>
</summary>
<p>OData supports a set of built-in filter operations, as described in this section.</p>
<p>4.01 services MUST support case-insensitive operation names. Clients that want to work with 4.0 services MUST use lower case operation names.</p>
<p>For a full description of the syntax used when building requests, see <a href="#ODataURL">OData-URL</a>.</p>
<table>
<tr><th>Operator</th><th>Description</th><th>Example</th></tr>
<tr><td colspan="3"><strong>Comparison Operators</strong></td></tr>
<tr><td><code>eq</code></td><td>Equal                </td><td><pre><code>Address/City eq 'Redmond'</code></pre></td></tr>
<tr><td><code>ne</code></td><td>Not equal            </td><td><pre><code>Address/City ne 'London'</code></pre></td></tr>
<tr><td><code>gt</code></td><td>Greater than         </td><td><pre><code>Price gt 20</code></pre></td></tr>
<tr><td><code>ge</code></td><td>Greater than or equal</td><td><pre><code>Price ge 10</code></pre></td></tr>
<tr><td><code>lt</code></td><td>Less than            </td><td><pre><code>Price lt 20</code></pre></td></tr>
<tr><td><code>le</code></td><td>Less than or equal   </td><td><pre><code>Price le 100</code></pre></td></tr>
<tr><td><code>has</code></td><td>Has flags           </td><td><pre><code>Style has Sales.Color'Yellow'</code></pre></td></tr>
<tr><td><code>in</code></td><td>Is a member of       </td><td><pre><code>Address/City in ('Redmond', 'London')</code></pre></td></tr>
<tr><td colspan="3"><strong>Logical Operators</strong></td></tr>
<tr><td><code>and</code></td><td>Logical and         </td><td><pre><code>Price le 200 and Price gt 3.5</code></pre></td></tr>
<tr><td><code>or</code></td><td>Logical or           </td><td><pre><code>Price le 3.5 or Price gt 200</code></pre></td></tr>
<tr><td><code>not</code></td><td>Logical negation    </td><td><pre><code>not endswith(Description,'milk')</code></pre></td></tr>
<tr><td colspan="3"><strong>Arithmetic Operators</strong></td></tr>
<tr><td><code>add</code></td><td>Addition            </td><td><pre><code>Price add 5 gt 10</code></pre></td></tr>
<tr><td><code>sub</code></td><td>Subtraction         </td><td><pre><code>Price sub 5 gt 10</code></pre></td></tr>
<tr><td><code>mul</code></td><td>Multiplication      </td><td><pre><code>Price mul 2 gt 2000</code></pre></td></tr>
<tr><td><code>div</code></td><td>Division            </td><td><pre><code>Price div 2 gt 4</code></pre></td></tr>
<tr><td><code>divby</code></td><td>Decimal Division  </td><td><pre><code>Price divby 2 gt 3.5</code></pre></td></tr>
<tr><td><code>mod</code></td><td>Modulo              </td><td><pre><code>Price mod 2 eq 0</code></pre></td></tr>
<tr><td colspan="3"><strong>Grouping Operators</strong></td></tr>
<tr><td><code>( )</code></td><td>Precedence grouping </td><td><pre><code>(Price sub 5) gt 10</code></pre></td></tr>
</table>

</details>
<details open><summary>
<h5 id="112612-built-in-query-functions"><a name="BuiltinQueryFunctions" href="#BuiltinQueryFunctions">11.2.6.1.2 Built-in Query Functions</a></h5>
</summary>
<p>OData supports a set of built-in functions that can be used within <code>$filter</code> operations. The following table lists the available functions.</p>
<p>4.01 services MUST support case-insensitive built-in function names. Clients that want to work with 4.0 services MUST use lower case names.</p>
<p>For a full description of the syntax used when building requests, see <a href="#ODataURL">OData-URL</a>.</p>
<p>OData does not define an ISNULL or COALESCE operator. Instead, there is a <code>null</code> literal that can be used in comparisons.</p>
<table>
<tr><th>Function</th><th>Example</th></tr>
<tr><td colspan="2"><strong>String and Collection Functions</strong></td></tr>
<tr><td><code>concat</code></td><td><pre><code>concat(concat(City,', '), Country) eq 'Berlin, Germany'</code></pre></td></tr>
<tr><td><code>contains</code></td><td><pre><code>contains(CompanyName,'freds')</code></pre></td></tr>
<tr><td><code>endswith</code></td><td><pre><code>endswith(CompanyName,'Futterkiste')</code></pre></td></tr>
<tr><td><code>indexof</code></td><td><pre><code>indexof(CompanyName,'lfreds') eq 1</code></pre></td></tr>
<tr><td><code>length</code></td><td><pre><code>length(CompanyName) eq 19</code></pre></td></tr>
<tr><td><code>startswith</code></td><td><pre><code>startswith(CompanyName,‚ÄôAlfr‚Äô)</code></pre></td></tr>
<tr><td><code>substring</code></td><td><pre><code>substring(CompanyName,1) eq 'lfreds Futterkiste'</code></pre></td></tr>
<tr><td colspan="2"><strong>Collection Functions</strong></td></tr>
<tr><td><code>hassubset</code></td><td><pre><code>hassubset([4,1,3],[3,1])</code></pre></td></tr>
<tr><td><code>hassubsequence</code></td><td><pre><code>hassubsequence([4,1,3,1],[1,1])</code></pre></td></tr>
<tr><td colspan="2"><strong>String Functions</strong></td></tr>
<tr><td><code>matchespattern</code></td><td><pre><code>matchespattern(CompanyName,'%5EA.*e$')</code></pre></td></tr>
<tr><td><code>tolower</code></td><td><pre><code>tolower(CompanyName) eq 'alfreds futterkiste'</code></pre></td></tr>
<tr><td><code>toupper</code></td><td><pre><code>toupper(CompanyName) eq 'ALFREDS FUTTERKISTE'</code></pre></td></tr>
<tr><td><code>trim  </code></td><td><pre><code>trim(CompanyName) eq 'Alfreds Futterkiste'</code></pre></td></tr>
<tr><td colspan="2"><strong>Date and Time Functions</strong></td></tr>
<tr><td><code>day</code></td><td><pre><code>day(StartTime) eq 8</code></pre></td></tr>
<tr><td><code>date</code></td><td><pre><code>date(StartTime) ne date(EndTime)</code></pre></td></tr>
<tr><td><code>fractionalseconds</code></td><td><pre><code>second(StartTime) eq 0</code></pre></td></tr>
<tr><td><code>hour</code></td><td><pre><code>hour(StartTime) eq 1</code></pre></td></tr>
<tr><td><code>maxdatetime</code></td><td><pre><code>EndTime eq maxdatetime()</code></pre></td></tr>
<tr><td><code>mindatetime</code></td><td><pre><code>StartTime eq mindatetime()</code></pre></td></tr>
<tr><td><code>minute</code></td><td><pre><code>minute(StartTime) eq 0</code></pre></td></tr>
<tr><td><code>month</code></td><td><pre><code>month(BirthDate) eq 12</code></pre></td></tr>
<tr><td><code>now</code></td><td><pre><code>StartTime ge now()</code></pre></td></tr>
<tr><td><code>second</code></td><td><pre><code>second(StartTime) eq 0</code></pre></td></tr>
<tr><td><code>time</code></td><td><pre><code>time(StartTime) le StartOfDay</code></pre></td></tr>
<tr><td><code>totaloffsetminutes</code></td><td><pre><code>totaloffsetminutes(StartTime) eq 60</code></pre></td></tr>
<tr><td><code>totalseconds</code></td><td><pre><code>totalseconds(duration'PT1M') eq 60</code></pre></td></tr>
<tr><td><code>year</code></td><td><pre><code>year(BirthDate) eq 0</code></pre></td></tr>
<tr><td colspan="2"><strong>Arithmetic Functions</strong></td></tr>
<tr><td><code>ceiling</code></td><td><pre><code>ceiling(Freight) eq 33</code></pre></td></tr>
<tr><td><code>floor</code></td><td><pre><code>floor(Freight) eq 32</code></pre></td></tr>
<tr><td><code>round</code></td><td><pre><code>round(Freight) eq 32</code></pre></td></tr>
<tr><td colspan="2"><strong>Type Functions</strong></td></tr>
<tr><td><code>cast</code></td><td><pre><code>cast(ShipCountry,Edm.String)</code></pre></td></tr>
<tr><td><code>isof</code></td><td><pre><code>isof(NorthwindModel.Order)</code></pre></td></tr>
<tr><td><code>isof</code></td><td><pre><code>isof(ShipCountry,Edm.String)</code></pre></td></tr>
<tr><td colspan="2"><strong>Geo Functions</strong></td></tr>
<tr><td><code>geo.distance</code></td><td><pre><code>geo.distance(CurrentPosition,TargetPosition)</code></pre></td></tr>
<tr><td><code>geo.intersects</code></td><td><pre><code>geo.intersects(Position,TargetArea)</code></pre></td></tr>
<tr><td><code>geo.length</code></td><td><pre><code>geo.length(DirectRoute)</code></pre></td></tr>
<tr><td colspan="2"><strong>Conditional Functions</strong></td></tr>
<tr><td><code>case</code></td><td><pre><code>case(X gt 0:1,X lt 0:-1,true:0)</code></pre></td></tr>
</table>

</details>
<details open><summary>
<h5 id="112613-parameter-aliases"><a name="ParameterAliases" href="#ParameterAliases">11.2.6.1.3 Parameter Aliases</a></h5>
</summary>
<p>Parameter aliases can be used in place of literal values in entity keys, <a href="#InvokingaFunction">function parameters</a>, or within a <a href="#SystemQueryOptioncompute"><code>$compute</code></a>, <a href="#SystemQueryOptionfilter"><code>$filter</code></a> or <a href="#SystemQueryOptionorderby"><code>$orderby</code></a> expression. Parameters aliases are names beginning with an at sign (<code>@</code>).</p>
<p>Actual parameter values are specified as query options in the query part of the request URL. The query option name is the name of the parameter alias, and the query option value is the value to be used for the specified parameter alias.</p>
<div class="example">
<p>Example 48: returns all employees whose Region property matches the string parameter value <code>WA</code></p>
<pre><code>GET http://host/service.svc/Employees?$filter=Region eq @p1&amp;@p1=&#39;WA&#39;</code></pre>
</div>
<p>Parameter aliases allow the same value to be used multiple times in a request and may be used to reference primitive, structured, or collection values.</p>
<p>If a parameter alias is not given a value in the query part of the request URL, the value MUST be assumed to be null. A parameter alias can be used in multiple places within a request URL, but its value MUST NOT be specified more than once.</p>
<p>Parameter alias values used in <code>/$filter</code> path segments are always passed as expressions (because that is the expected type of the parameter).</p>
<p>All other parameter alias values are evaluated in the context of the resource identified by the path segment in which they are assigned and passed as values into the expression. Parameter alias value assignments MAY be nested within <code>$expand</code> and <code>$select</code>, in which case they are evaluated relative to the resource context of the <code>$expand</code> or <code>$select</code>.</p>
<div class="example">
<p>Example 49: returns all employees, expands their manager, and expands all direct reports with the same first name as the manager, using a parameter alias for <code>$this</code> to pass the manager into the filter on the expanded direct reports</p>
<pre><code>GET http://host/service.svc/Employees?$expand=Manager(@m=$this;$expand=DirectReports($filter=@m/FirstName eq FirstName))</code></pre>
</div>
</details>
</details>
<details open><summary>
<h4 id="11262-system-query-option-orderby"><a name="SystemQueryOptionorderby" href="#SystemQueryOptionorderby">11.2.6.2 System Query Option <code>$orderby</code></a></h4>
</summary>
<p>The <code>$orderby</code> System Query option specifies the order in which items are returned from the service.</p>
<p>The value of the <code>$orderby</code> System Query option contains a comma-separated list of expressions whose primitive result values are used to sort the items. A special case of such an expression is a property path terminating on a primitive property. A type cast using the qualified entity type name is required to order by a property defined on a derived type. Only aliases defined in the metadata document of the service can be used in URLs.</p>
<p>The expression can include the suffix <code>asc</code> for ascending or <code>desc</code> for descending, separated from the property name by one or more spaces. If <code>asc</code> or <code>desc</code> is not specified, the service MUST order by the specified property in ascending order. 4.01 services MUST support case-insensitive values for <code>asc</code> and <code>desc</code>. Clients that want to work with 4.0 services MUST use lower case values.</p>
<p>Null values come before non-null values when sorting in ascending order and after non-null values when sorting in descending order.</p>
<p>Items are sorted by the result values of the first expression, and then items with the same value for the first expression are sorted by the result value of the second expression, and so on.</p>
<p>The Boolean value false comes before the value true in ascending order.</p>
<p>Services SHOULD order language-dependent strings according to the <a href="#HeaderContentLanguage"><code>Content-Language</code></a> of the response, and SHOULD annotate string properties with language-dependent order with the term <a href="https://github.com/oasis-tcs/odata-vocabularies/blob/main/vocabularies/Org.OData.Core.V1.md#IsLanguageDependent"><code>Core.IsLanguageDependent</code></a>, see <a href="#ODataVocCore">OData-VocCore</a>.</p>
<p>Values of type <code>Edm.Stream</code> or any of the <code>Geo</code> types cannot be sorted.</p>
<div class="example">
<p>Example 50: return all Products ordered by release date in ascending order, then by rating in descending order</p>
<pre><code>GET http://host/service/Products?$orderby=ReleaseDate asc, Rating desc</code></pre>
</div>
<p>Related entities may be ordered by specifying <code>$orderby</code> within the <code>$expand</code> clause.</p>
<div class="example">
<p>Example 51: return all Categories, and their Products ordered according to release date and in descending order of rating</p>
<pre><code>GET http://host/service/Categories?$expand=Products($orderby=ReleaseDate asc, Rating desc)</code></pre>
</div>
<p><code>$count</code> may be used within a <code>$orderby</code> expression to order the returned items according to the exact count of related entities or items within a collection-valued property.</p>
<div class="example">
<p>Example 52: return all Categories ordered by the number of Products within each category</p>
<pre><code>GET http://host/service/Categories?$orderby=Products/$count</code></pre>
</div>
</details>
<details open><summary>
<h4 id="11263-system-query-option-top"><a name="SystemQueryOptiontop" href="#SystemQueryOptiontop">11.2.6.3 System Query Option <code>$top</code></a></h4>
</summary>
<p>The <code>$top</code> system query option specifies a non-negative integer <span class="math inline">\(n\)</span> that limits the number of items returned from a collection.</p>
<p>Let <span class="math inline">\(A\)</span> be a copy of the result set with a total order that extends any existing order of the result set but is otherwise chosen by the service. If no unique ordering is imposed through an <a href="#SystemQueryOptionorderby"><code>$orderby</code></a> query option, the service MUST choose a stable ordering across requests that include <code>$top</code> or <a href="#SystemQueryOptionskip"><code>$skip</code></a>.</p>
<p>If <span class="math inline">\(A\)</span> contains more than <span class="math inline">\(n\)</span> instances, the result of <span class="math inline">\({\tt \$top}=n\)</span> consists of the first <span class="math inline">\(n\)</span> instances in <span class="math inline">\(A\)</span>. Otherwise, the result equals <span class="math inline">\(A\)</span>. The instances in the result are in the same order as they occur in <span class="math inline">\(A\)</span>.</p>
<div class="example">
<p>Example 53: return only the first five products of the Products entity set</p>
<pre><code>GET http://host/service/Products?$top=5</code></pre>
</div>
</details>
<details open><summary>
<h4 id="11264-system-query-option-skip"><a name="SystemQueryOptionskip" href="#SystemQueryOptionskip">11.2.6.4 System Query Option <code>$skip</code></a></h4>
</summary>
<p>The <code>$skip</code> system query option specifies a non-negative integer <span class="math inline">\(n\)</span> that excludes the first <span class="math inline">\(n\)</span> items of the queried collection from the result.</p>
<p>Let <span class="math inline">\(A\)</span> be a copy of the result set with a total order that extends any existing order of the result set but is otherwise chosen by the service. If no unique ordering is imposed through an <a href="#SystemQueryOptionorderby"><code>$orderby</code></a> query option, the service MUST choose a stable ordering across requests that include <a href="#SystemQueryOptiontop"><code>$top</code></a> or <code>$skip</code>.</p>
<p>If <span class="math inline">\(A\)</span> contains <span class="math inline">\(n\)</span> or fewer instances, the result of <span class="math inline">\({\tt \$skip}=n\)</span> is empty. Otherwise, the first <span class="math inline">\(n\)</span> instances in <span class="math inline">\(A\)</span> are omitted from the result and all remaining instances are kept in the same order as they occur in <span class="math inline">\(A\)</span>.</p>
<div class="example">
<p>Example 54: return products starting with the 6th product of the <code>Products</code> entity set</p>
<pre><code>GET http://host/service/Products?$skip=5</code></pre>
</div>
<p>Where <a href="#SystemQueryOptiontop"><code>$top</code></a> and <code>$skip</code> are used together, <code>$skip</code> MUST be applied before <code>$top</code>, regardless of the order in which they appear in the request.</p>
<div class="example">
<p>Example 55: return the third through seventh products of the <code>Products</code> entity set</p>
<pre><code>GET http://host/service/Products?$top=5&amp;$skip=2</code></pre>
</div>
<p>If no unique ordering is imposed through an <a href="#SystemQueryOptionorderby"><code>$orderby</code></a> query option, the service MUST impose a stable ordering across requests that include <code>$skip</code>.</p>
</details>
<details open><summary>
<h4 id="11265-system-query-option-count"><a name="SystemQueryOptioncount" href="#SystemQueryOptioncount">11.2.6.5 System Query Option <code>$count</code></a></h4>
</summary>
<p>The <code>$count</code> system query option with a value of <code>true</code> specifies that the total count of items within a collection matching the request be returned along with the result.</p>
<div class="example">
<p>Example 56: return, along with the results, the total number of products in the collection</p>
<pre><code>GET http://host/service/Products?$count=true</code></pre>
</div>
<p>The count of related entities can be requested by specifying the <code>$count</code> query option within the <code>$expand</code> clause.</p>
<div class="example">
<p>Example 57:</p>
<pre><code>GET http://host/service/Categories?$expand=Products($count=true)</code></pre>
</div>
<p>A <code>$count</code> query option with a value of <code>false</code> (or not specified) hints that the service SHOULD NOT return a count.</p>
<p>The service returns an HTTP Status code of <code>400 Bad Request</code> if a value other than <code>true</code> or <code>false</code> is specified.</p>
<p>The <code>$count</code> system query option ignores any <a href="#SystemQueryOptiontop"><code>$top</code></a>, <a href="#SystemQueryOptionskip"><code>$skip</code></a>, or <a href="#SystemQueryOptionexpand"><code>$expand</code></a> query options, and returns the total count of results across all pages including only those results matching any specified <a href="#SystemQueryOptionfilter"><code>$filter</code></a> and <a href="#SystemQueryOptionsearch"><code>$search</code></a>. Clients should be aware that the count returned inline may not exactly equal the actual number of items returned, due to latency between calculating the count and enumerating the last value or due to inexact calculations on the service.</p>
<p>How the count is encoded in the response body is dependent upon the selected format.</p>
</details>
<details open><summary>
<h4 id="11266-system-query-option-search"><a name="SystemQueryOptionsearch" href="#SystemQueryOptionsearch">11.2.6.6 System Query Option <code>$search</code></a></h4>
</summary>
<p>The <code>$search</code> system query option restricts the result to include only those items <em>matching</em> the specified search expression. The definition of what it means to match is dependent upon the implementation.</p>
<div class="example">
<p>Example 58: return all Products that match the search term <code>bike</code></p>
<pre><code>GET http://host/service/Products?$search=bike</code></pre>
</div>
<p>The search expression can contain phrases, enclosed in double-quotes.</p>
<div class="example">
<p>Example 59: return all Products that match the phrase <code>mountain bike</code></p>
<pre><code>GET http://host/service/Products?$search=&quot;mountain bike&quot;</code></pre>
</div>
<p>The upper-case keyword <code>NOT</code> restricts the set of entities to those that do not match the specified term.</p>
<div class="example">
<p>Example 60: return all Products that do not match <code>clothing</code></p>
<pre><code>GET http://host/service/Products?$search=NOT clothing</code></pre>
</div>
<p>Multiple terms within a search expression are separated by a space (implicit <code>AND</code>) or the upper-case keyword <code>AND</code>, indicating that all such terms must be matched.</p>
<div class="example">
<p>Example 61: return all Products that match both <code>mountain</code> and <code>bike</code></p>
<pre><code>GET http://host/service/Products?$search=mountain AND bike</code></pre>
</div>
<p>The upper-case keyword <code>OR</code> is used to return entities that satisfy either the immediately preceding or subsequent expression.</p>
<div class="example">
<p>Example 62: return all Products that match <code>mountain</code> or <code>bike</code></p>
<pre><code>GET http://host/service/Products?$search=mountain OR bike</code></pre>
</div>
<p>Parentheses within the search expression group together multiple expressions.</p>
<div class="example">
<p>Example 63: return all Products that match <code>mountain</code> or <code>bike</code> and do not match clothing</p>
<pre><code>GET http://host/service/Products?$search=(mountain OR bike) AND NOT clothing</code></pre>
</div>
<p>The operations within a search expression MUST be evaluated in the following order: grouping operator, <code>NOT</code> operator, <code>AND</code> operator, <code>OR</code> operator</p>
<p>If both <code>$search</code> and <a href="#SystemQueryOptionfilter"><code>$filter</code></a> are specified in the same request, only those items satisfying both criteria are returned.</p>
<p>The value of the <code>$search</code> option is a search expression as defined in <a href="#ODataABNF">OData-ABNF</a>.</p>
</details>
<details open><summary>
<h4 id="11267-server-driven-paging"><a name="ServerDrivenPaging" href="#ServerDrivenPaging">11.2.6.7 Server-Driven Paging</a></h4>
</summary>
<p>Responses that include only a partial set of the items identified by the request URL MUST contain a link that allows retrieving the next partial set of items. This link is called a <em>next link</em>; its representation is format-specific. The final partial set of items MUST NOT contain a next link.</p>
<p>The client can request a maximum page size through the <a href="#Preferencemaxpagesizeodatamaxpagesize"><code>maxpagesize</code></a> preference. The service may apply this requested page size or implement a page size different than, or in the absence of, this preference.</p>
<p>OData clients MUST treat the URL of the next link as opaque, and MUST NOT append system query options to the URL of a next link. Services may not allow a change of format on requests for subsequent pages using the next link. Clients therefore SHOULD request the same format on subsequent page requests using a compatible <code>Accept</code> header. OData services may use the reserved system query option <code>$skiptoken</code> when building next links. Its content is opaque, service-specific, and must only follow the rules for URL query parts.</p>
<p>OData clients MUST NOT use the system query option <code>$skiptoken</code> when constructing requests.</p>
</details>
<details open><summary>
<h4 id="11268-requesting-an-individual-member-of-an-ordered-collection"><a name="RequestinganIndividualMemberofanOrderedCollection" href="#RequestinganIndividualMemberofanOrderedCollection">11.2.6.8 Requesting an Individual Member of an Ordered Collection</a></h4>
</summary>
<p>Individual members of collections of primitive and complex types annotated with the <code>Ordered</code> term (see <a href="#ODataVocCore">OData-VocCore</a>) are addressable by appending a segment containing the zero-based ordinal to the URL of the collection. A negative ordinal indexes from the end of the collection, with -1 representing the last item in the collection.</p>
<p>Entities are stably addressable using their canonical URL and are not accessible using an ordinal index.</p>
<div class="example">
<p>Example 64: the first address in a list of addresses for <code>MainSupplier</code></p>
<pre><code>GET http://host/service/MainSupplier/Addresses/0</code></pre>
</div>
</details>
</details>
<details open><summary>
<h3 id="1127-requesting-related-entities"><a name="RequestingRelatedEntities" href="#RequestingRelatedEntities">11.2.7 Requesting Related Entities</a></h3>
</summary>
<p>To request related entities according to a particular relationship, the client issues a <code>GET</code> request to the source entity‚Äôs request URL, followed by a forward slash and the name of the navigation property representing the relationship.</p>
<p>If the navigation property does not exist on the entity indicated by the request URL, the service returns <a href="#ResponseCode404NotFound"><code>404 Not Found</code></a>.</p>
<p>If the relationship terminates on a collection, the response MUST be the format-specific representation of the collection of related entities. If no entities are related, the response is the format-specific representation of an empty collection.</p>
<p>If the relationship terminates on a single entity, the response MUST be the format-specific representation of the related single entity. If no entity is related, the service returns <a href="#ResponseCode204NoContent"><code>204 No Content</code></a>.</p>
<div class="example">
<p>Example 65: return the supplier of the product with <code>ID=1</code> in the Products entity set</p>
<pre><code>GET http://host/service/Products(1)/Supplier</code></pre>
</div>
</details>
<details open><summary>
<h3 id="1128-requesting-entity-references"><a name="RequestingEntityReferences" href="#RequestingEntityReferences">11.2.8 Requesting Entity References</a></h3>
</summary>
<p>To request <a href="#EntityIdsandEntityReferences">entity references</a> in place of the actual entities, the client issues a <code>GET</code> request with <code>/$ref</code> appended to the resource path.</p>
<p>If the resource path does not identify an entity or a collection of entities, the service returns <a href="#ResponseCode404NotFound"><code>404 Not Found</code></a>.</p>
<p>If the resource path identifies a collection, the response MUST be the format-specific representation of a collection of entity references pointing to the related entities. If no entities are related, the response is the format-specific representation of an empty collection. The response MAY contain an <a href="#HeaderETag"><code>ETag</code></a> header for the collection whose value changes if the collection of references changes, i.e. a reference is added or removed.</p>
<p>If the resource path identifies a single existing entity, the response MUST be the format-specific representation of an entity reference. The response MAY contain an <a href="#HeaderETag"><code>ETag</code></a> header which represents the identity of the referenced entity. If the resource path terminates in a single-valued navigation path, the ETag value changes if the relationship is changed and points to a different OData entity. If the resource path is the canonical path for a single entity, the returned ETag can never change.</p>
<p>If the resource path terminates on a single entity and no such entity exists, the service returns either <a href="#ResponseCode204NoContent"><code>204 No Content</code></a> or <a href="#ResponseCode404NotFound"><code>404 Not Found</code></a>.</p>
<div class="example">
<p>Example 66: collection with an entity reference for each Order related to the Product with <code>ID=0</code></p>
<pre><code>GET http://host/service/Products(0)/Orders/$ref</code></pre>
</div>
</details>
<details open><summary>
<h3 id="1129-resolving-an-entity-id"><a name="ResolvinganEntityId" href="#ResolvinganEntityId">11.2.9 Resolving an Entity-Id</a></h3>
</summary>
<p>To resolve an <a href="#EntityIdsandEntityReferences">entity-id</a>, e.g. obtained in an entity reference, into a representation of the identified entity, the client issues a <code>GET</code> request to the <code>$entity</code> resource located at the URL <code>$entity</code> relative to the service root. The entity-id MUST be specified using the system query option <code>$id</code>.</p>
<div class="example">
<p>Example 67: return the entity representation for a given entity-id</p>
<pre><code>GET http://host/service/$entity?$id=http://host/service/Products(0)</code></pre>
</div>
<p>A type segment following the <code>$entity</code> resource casts the resource to the specified type. If the identified entity is not of the specified type, or a type derived from the specified type, the service returns <a href="#ResponseCode404NotFound"><code>404 Not Found</code></a>.</p>
<p>After applying a type-cast segment to cast to a specific type, the system query options <a href="#SystemQueryOptionselect"><code>$select</code></a> and <a href="#SystemQueryOptionexpand"><code>$expand</code></a> can be specified in <code>GET</code> requests to the <code>$entity</code> resource.</p>
<div class="example">
<p>Example 68: return the entity representation for a given entity-id and specify properties to return</p>
<pre><code>GET http://host/service/$entity/Model.Customer
      ?$id=http://host/service/Customers(&#39;ALFKI&#39;)
      &amp;$select=CompanyName,ContactName
      &amp;$expand=Orders</code></pre>
</div>
</details>
<details open><summary>
<h3 id="11210-requesting-the-number-of-items-in-a-collection"><a name="RequestingtheNumberofItemsinaCollection" href="#RequestingtheNumberofItemsinaCollection">11.2.10 Requesting the Number of Items in a Collection</a></h3>
</summary>
<p>To request only the number of items of a collection of entities or items of a collection-valued property, the client issues a <code>GET</code> request with <code>/$count</code> appended to the resource path of the collection.</p>
<p>On success, the response body MUST contain the exact count of items matching the request after applying any <a href="#SystemQueryOptionfilter"><code>$filter</code></a> or <a href="#SystemQueryOptionsearch"><code>$search</code></a> system query options, formatted as a simple primitive integer value with media type <code>text/plain</code>. Clients SHOULD NOT combine the system query options <a href="#SystemQueryOptiontop"><code>$top</code></a>, <a href="#SystemQueryOptionskip"><code>$skip</code></a>, <a href="#SystemQueryOptionorderby"><code>$orderby</code></a>, <a href="#SystemQueryOptionexpand"><code>$expand</code></a>, and <a href="#SystemQueryOptionformat"><code>$format</code></a> with the path suffix <code>/$count</code>. The result of such a request is undefined.</p>
<div class="example">
<p>Example 69: return the number of products in the Products entity set</p>
<pre><code>GET http://host/service/Products/$count</code></pre>
</div>
<p>With 4.01 services the <code>/$count</code> segment MAY be used in combination with the <code>/$filter</code> path segment to count the items in the filtered collection.</p>
<div class="example">
<p>Example 70: return the number of products whose <code>Price</code> is less than $10.00</p>
<pre><code>GET http://host/service/Products/$filter(@foo)/$count?@foo=Price lt 10.00</code></pre>
</div>
<p>For backwards compatibility, the <code>/$count</code> suffix MAY be used in combination with the <a href="#SystemQueryOptionfilter"><code>$filter</code></a> system query option.</p>
<div class="example">
<p>Example 71: return the number of products whose <code>Price</code> is less than $10.00</p>
<pre><code>GET http://host/service/Products/$count?$filter=Price lt 10.00</code></pre>
</div>
<p>The <a href="#SystemQueryOptionfilter"><code>$filter</code></a> system query option MUST NOT be used in conjunction with a both a <code>/$count</code> path segment and a <code>/$filter</code> path segment.</p>
<p>The <code>/$count</code> suffix can also be used in path expressions within system query options, e.g. <a href="#SystemQueryOptionfilter"><code>$filter</code></a>.</p>
<div class="example">
<p>Example 72: return all customers with more than five interests</p>
<pre><code>GET http://host/service/Customers?$filter=Interests/$count gt 5</code></pre>
</div>
<div class="example">
<p>Example 73: return all categories with more than one product over $5.00</p>
<pre><code>GET http://host/service/Categories?$filter=Products/$filter(Price gt 5.0)/$count gt 1</code></pre>
</div>
</details>
<details open><summary>
<h3 id="11211-system-query-option-format"><a name="SystemQueryOptionformat" href="#SystemQueryOptionformat">11.2.11 System Query Option <code>$format</code></a></h3>
</summary>
<p>The <code>$format</code> system query option specifies the media type of the response.</p>
<p>The <code>$format</code> query option, if present in a request, MUST take precedence over the value(s) specified in the <a href="#HeaderAccept"><code>Accept</code></a> request header.</p>
<p>The value of the <code>$format</code> system query option is a valid internet media type, optionally including parameters.</p>
<p>In addition, format-specific abbreviations may be used, e.g. <code>json</code> for <code>application/json</code>, see <a href="#ODataJSON">OData-JSON</a>, but format parameters MUST NOT be appended to the format abbreviations.</p>
<div class="example">
<p>Example 74: the request</p>
<pre><code>GET http://host/service/Orders?$format=application/json;metadata=full</code></pre>
</div>
<p>is equivalent to a request with an <code>Accept</code> header using the same media type; it requests the set of Order entities represented using the JSON media type including full metadata, as defined in <a href="#ODataJSON">OData-JSON</a>.</p>
<div class="example">
<p>Example 75: the request</p>
<pre><code>GET http://host/service/Orders?$format=json</code></pre>
</div>
<p>is equivalent to a request with the <code>Accept</code> header set to <code>application/json</code>; it requests the set of Order entities represented using the JSON media type with minimal metadata, as defined in <a href="#ODataJSON">OData-JSON</a>.</p>
<p>In <a href="#MetadataDocumentRequest">metadata document requests</a>, the values <code>application/xml</code> and <code>application/json</code>, along with their subtypes and parameterized variants, as well as the format-specific abbreviations <code>xml</code> and <code>json</code>, are reserved for this specification.</p>
</details>
<details open><summary>
<h3 id="11212-system-query-option-schemaversion"><a name="SystemQueryOptionschemaversion" href="#SystemQueryOptionschemaversion">11.2.12 System Query Option <code>$schemaversion</code></a></h3>
</summary>
<p>The <code>$schemaversion</code> system query option MAY be included in any request. For a <a href="#MetadataDocumentRequest">metadata document request</a> the value of the <code>$schemaversion</code> system query option addresses a specific schema version. For all other request types the value specifies the version of the schema against which the request is made. The syntax of the <code>$schemaversion</code> system query option is defined in <a href="#ODataABNF">OData-ABNF</a>.</p>
<p>The value of the <code>$schemaversion</code> system query option MUST be a version of the schema as returned in the <a href="https://github.com/oasis-tcs/odata-vocabularies/blob/main/vocabularies/Org.OData.Core.V1.md#SchemaVersion"><code>Core.SchemaVersion</code></a> annotation, defined in <a href="#ODataVocCore">OData-VocCore</a>, of a previous request to the <a href="#MetadataDocumentRequest">metadata document</a>, or <code>*</code> in order to specify the current version of the metadata.</p>
<p>If specified, the service MUST process the request according to the specified version of the metadata.</p>
<p>Clients can retrieve the current version of the metadata by making a <a href="#MetadataDocumentRequest">metadata document request</a> with a <code>$schemaversion</code> system query option value of <code>*</code>, and SHOULD include the value from the returned <a href="https://github.com/oasis-tcs/odata-vocabularies/blob/main/vocabularies/Org.OData.Core.V1.md#SchemaVersion"><code>Core.SchemaVersion</code></a> annotation in the <code>$schemaversion</code> system query option of subsequent requests.</p>
<p>If the <code>$schemaversion</code> system query option is not specified in a request for the metadata document, the service MUST return a version of the metadata with no breaking changes over time, and the processing of all other requests that omit the <code>$schemaversion</code> system query option MUST be compatible with that ‚Äúunversioned‚Äù schema. For more information on breaking changes, see <a href="#ModelVersioning">Model Versioning</a>.</p>
<p>If the <code>$schemaversion</code> system query option is specified on an individual request within a batch, then it specifies the version of the schema to apply to that individual request. Individual requests within a batch that don‚Äôt include the <code>$schemaversion</code> system query option inherit the schema version of the overall batch request.</p>
<p>If the <code>$schemaversion</code> system query option is specified, but the version of the schema doesn‚Äôt exist, the request is answered with a response code <a href="#ResponseCode404NotFound"><code>404 Not Found</code></a>. The response body SHOULD provide additional information.</p>
</details>
</details>
<details open><summary>
<h2 id="113-requesting-changes"><a name="RequestingChanges" href="#RequestingChanges">11.3 Requesting Changes</a></h2>
</summary>
<p>Services advertise their change-tracking capabilities by annotating entity sets with the <a href="https://github.com/oasis-tcs/odata-vocabularies/blob/main/vocabularies/Org.OData.Capabilities.V1.md#ChangeTracking"><code>Capabilities.ChangeTracking</code></a> term defined in <a href="#ODataVocCap">OData-VocCap</a>.</p>
<p>Any <code>GET</code> request to retrieve one or more entities MAY allow change-tracking.</p>
<p>Clients request that the service track changes to a result by specifying the <a href="#Preferencetrackchangesodatatrackchanges"><code>track-changes</code></a> preference on a request. If supported for the request, the service includes a <a href="#HeaderPreferenceApplied"><code>Preference-Applied</code></a> header in the response containing the <code>track-changes</code> preference and includes a <em>delta link</em> in a result for a single entity, and on the last page of results for a collection of entities in place of the next link.</p>
<details open><summary>
<h3 id="1131-delta-links"><a name="DeltaLinks" href="#DeltaLinks">11.3.1 Delta Links</a></h3>
</summary>
<p>Delta links are opaque, service-generated links that the client uses to retrieve subsequent changes to a result.</p>
<p>Delta links are based on a <em>defining query</em> that describes the set of results for which changes are being tracked; for example, the request that generated the results containing the delta link. The delta link encodes the collection of entities for which changes are being tracked, along with a starting point from which to track changes. OData services may use the reserved system query option <code>$deltatoken</code> when building delta links. Its content is opaque, service-specific, and must only follow the rules for URL query parts.</p>
<p>If the defining query contains a <a href="#SystemQueryOptionschemaversion"><code>$schemaversion</code></a> system query option, the response MUST be represented according to that schema version.</p>
<p>If the defining query contains a <a href="#SystemQueryOptionfilter"><code>$filter</code></a> or <a href="#SystemQueryOptionsearch"><code>$search</code></a>, the response MUST include only changes to entities matching the specified criteria. Added entities MUST be returned for entities that were added or changed and now match the specified criteria, and deleted entities MUST be returned for entities that are changed to no longer match the criteria of <a href="#SystemQueryOptionfilter"><code>$filter</code></a> or <a href="#SystemQueryOptionsearch"><code>$search</code></a>.</p>
<p>The delta link MUST NOT encode any client <a href="#SystemQueryOptiontop">top</a> or <a href="#SystemQueryOptionskip">skip</a> value, and SHOULD NOT encode a request for an inline count.</p>
<p>If the defining query includes expanded relationships, the delta link MUST return changes, additions, or deletions to the expanded entities, as well as added or deleted links to expanded entities or nested collections representing current membership. If the defining query includes expanded references, then the delta link MUST return changes to the membership in the set of expanded references.</p>
<p>Navigation properties specified in the <a href="#SystemQueryOptionselect"><code>$select</code></a> list of a defining query are not used to define the scope or contents of the items being tracked. Clients can specify <code>/$ref</code> in <a href="#SystemQueryOptionexpand"><code>$expand</code></a> in order to specify interest in the set of related entities without interest in changes to the content of those related entities.</p>
<p>If an expanded entity becomes orphaned because all paths to the entity as specified in the defining query have been broken (i.e. due to relationship changes and/or changes or deletions to parent entities) then the service MUST return the appropriate notifications for the client to determine that the entity has been orphaned (i.e. the changed relationships and removed parent entities). The client should not assume that it will receive additional notifications for such an orphaned entity.</p>
<p>Entities are considered changed if any of the structural properties have changed. Changes to related entities and to streams are not considered a change to the entity containing the stream or navigation property.</p>
<p>If the defining query contains a <a href="#SpecifyingPropertiestoReturn">projection</a>, the generated delta link SHOULD logically include the same projection, such that the delta query only includes fields specified in the projection. Services MAY use the projection to limit the entities returned to those that have changed within the selected fields, but the client MUST be prepared to receive entities returned whether or not the field that changed was specified in the projection.</p>
</details>
<details open><summary>
<h3 id="1132-using-delta-links"><a name="UsingDeltaLinks" href="#UsingDeltaLinks">11.3.2 Using Delta Links</a></h3>
</summary>
<p>The client requests changes by invoking the <code>GET</code> method on the <a href="#DeltaLinks">delta link</a>. The client MUST NOT attempt to append system query options to the delta link. The <a href="#HeaderAccept"><code>Accept</code></a> header MAY be used to specify the desired response format.</p>
<p>Clients SHOULD specify the same <a href="#HeaderAcceptLanguage"><code>Accept-Language</code></a> header when querying the delta link as was specified in the defining query. Services MAY return <a href="#ResponseCode406NotAcceptable"><code>406 Not Acceptable</code></a> if a different <code>Accept-Language</code> is specified. If a service does support an <code>Accept-Language</code> header it MAY return changes only visible in that language, or MAY include records that have changes not visible in the requested language.</p>
<p>The <a href="#RequestingtheNumberofItemsinaCollection"><code>/$count</code></a> segment can be appended to the path of a delta link in order to get just the number of changes available. The count includes all added, changed, or deleted entities, as well as added or deleted links.</p>
<p>The results of a request against the delta link may span one or more pages and MUST be ordered by the service across all pages in such a way as to guarantee consistency when applied in order to the response which contained the delta link.</p>
<p>Services SHOULD return only changed entities, but MAY return additional entities matching the defining query for which the client may not see a change.</p>
<p>In order to continue tracking changes beyond the current set, the client specifies <a href="#Preferencetrackchangesodatatrackchanges"><code>track-changes</code></a> on the initial request to the delta link but is not required to repeat it for subsequent <a href="#ServerDrivenPaging">pages</a>. The new delta link appears at the end of the last page of changes in place of the next link and MUST return all changes subsequent to the last change of the previous delta link.</p>
<p>If no changes have occurred, the response is an empty collection that contains a delta link for subsequent changes if requested. This delta link MAY be identical to the delta link resulting in the empty collection of changes.</p>
<p>If the delta link is no longer valid, the service responds with <a href="#ResponseCode410Gone"><code>410 Gone</code></a>, and SHOULD include the URL for refetching the entire set in the <code>Location</code> header of the response.</p>
</details>
<details open><summary>
<h3 id="1133-delta-payloads"><a name="DeltaPayloads" href="#DeltaPayloads">11.3.3 Delta Payloads</a></h3>
</summary>
<p>A delta payload represents changes to a known state. A delta payload includes added entities, changed entities, and deleted entities, as well as a representation of added and removed relationships.</p>
<p>Services that support the use of <a href="#UseofETagsforAvoidingUpdateConflicts">ETags</a> for optimistic concurrency control SHOULD return ETag values for added or changed entities within the delta payload.</p>
<p>Delta payloads can be <a href="#RequestingChanges">requested</a> from the service using a delta link or provided as updates to the service.</p>
</details>
</details>
<details open><summary>
<h2 id="114-data-modification"><a name="DataModification" href="#DataModification">11.4 Data Modification</a></h2>
</summary>
<p>Updatable OData services support Create, Update, and Delete operations for some or all exposed entities. Additionally, <a href="#Actions">Actions</a> supported by a service can affect the state of the system.</p>
<p>A successfully completed <a href="#DataModification">Data Modification Request</a> must not violate the integrity of the data.</p>
<p>The client may request whether content be returned from a Create, Update, or Delete request, or the invocation of an Action, by specifying the <a href="#Preferencereturnrepresentationandreturnminimal"><code>return</code></a> preference. A <a href="#SuccessResponses">success response</a> indicates that data have been modified, regardless of whether the requested content could be returned.</p>
<details open><summary>
<h3 id="1141-common-data-modification-semantics"><a name="CommonDataModificationSemantics" href="#CommonDataModificationSemantics">11.4.1 Common Data Modification Semantics</a></h3>
</summary>
<p><a href="#DataModification">Data Modification Requests</a> share the following semantics.</p>
<details open><summary>
<h4 id="11411-use-of-etags-for-avoiding-update-conflicts"><a name="UseofETagsforAvoidingUpdateConflicts" href="#UseofETagsforAvoidingUpdateConflicts">11.4.1.1 Use of ETags for Avoiding Update Conflicts</a></h4>
</summary>
<p>Each entity has its own ETag value that MUST change when structural properties or links from that entity have changed. In addition, modifying, adding, or deleting a contained entity MAY change the ETag of the parent entity.</p>
<p>Collections of entities (including collections of related entities) MAY have their own ETag value whose semantics is service-specific. It typically changes if entities are added to or removed from the collection, or if an entity in the collection is changed. The ETag of a collection of related entities reached via a navigation property MAY differ from the ETag of the entity containing the navigation property.</p>
<p>A <a href="#DataModification">Data Modification Request</a> on an existing resource or an <a href="#Actions">Action Request</a> invoking an action bound to an existing resource MAY require optimistic concurrency control. Services SHOULD announce this via annotations with the terms <a href="https://github.com/oasis-tcs/odata-vocabularies/blob/main/vocabularies/Org.OData.Core.V1.md#OptimisticConcurrency"><code>Core.OptimisticConcurrency</code></a> in <a href="#ODataVocCore">OData-VocCore</a> and <a href="https://github.com/oasis-tcs/odata-vocabularies/blob/main/vocabularies/Org.OData.Capabilities.V1.md#NavigationRestrictions"><code>Capabilities.NavigationRestrictions</code></a> (nested property <code>OptimisticConcurrencyControl</code>) in <a href="#ODataVocCap">OData-VocCap</a>.</p>
<p>If optimistic concurrency control is required for a resource, the service MUST include an <a href="#HeaderETag"><code>ETag</code></a> header in a response to a <code>GET</code> request to the resource, and MAY include the ETag in a format-specific manner in responses containing that resource.</p>
<p>The presence of an <a href="#HeaderETag"><code>ETag</code></a> header in a response does not imply in itself that the resource requires optimistic concurrency control; the ETag may just be used for caching and/or conditional <code>GET</code> requests.</p>
<p>If an ETag value is specified in an <a href="#HeaderIfMatch"><code>If-Match</code></a> or <a href="#HeaderIfNoneMatch"><code>If-None-Match</code></a> header of a <a href="#DataModification">Data Modification Request</a> or <a href="#Actions">Action Request</a>, the operation MUST only be invoked if the <code>If-Match</code> or <code>If-None-Match</code> condition is satisfied.</p>
<p>If the client does not specify an <a href="#HeaderIfMatch"><code>If-Match</code></a> request header in a <a href="#DataModification">Data Modification Request</a> or <a href="#Actions">Action Request</a> on a resource that requires optimistic concurrency control, the service responds with a <code>428 Precondition Required</code> and MUST ensure that no observable change occurs as a result of the request. Clients can attempt to disable optimistic concurrency control by specifying <code>If-Match</code> with a value of <code>*</code>. Services MAY reject such requests.</p>
<p>For requests including an <a href="#HeaderODataVersion"><code>OData-Version</code></a> header value of <code>4.01</code>, any ETag values specified in the request body of an <a href="#UpdateanEntity">update request</a> MUST be <code>*</code> or match the current value for the record being updated.</p>
</details>
<details open><summary>
<h4 id="11412-handling-of-datetimeoffset-values"><a name="HandlingofDateTimeOffsetValues" href="#HandlingofDateTimeOffsetValues">11.4.1.2 Handling of DateTimeOffset Values</a></h4>
</summary>
<p>Services SHOULD preserve the offset of <code>Edm.DateTimeOffset</code> values, if possible. However, where the underlying storage does not support offset services may be forced to normalize the value to some common time zone (for example UTC) in which case the result would be returned with that time zone offset. If the service normalizes values, it MUST fail evaluation of the <a href="#BuiltinQueryFunctions">query functions</a> <code>year</code>, <code>month</code>, <code>day</code>, <code>hour</code>, and <code>time</code> for literal values that are not stated in the time zone of the normalized values.</p>
</details>
<details open><summary>
<h4 id="11413-handling-of-properties-not-advertised-in-metadata"><a name="HandlingofPropertiesNotAdvertisedinMetadata" href="#HandlingofPropertiesNotAdvertisedinMetadata">11.4.1.3 Handling of Properties Not Advertised in Metadata</a></h4>
</summary>
<p>Clients MUST be prepared to receive additional properties in an entity or complex type instance that are not advertised in metadata, even for types not marked as open. By using <code>PATCH</code> when <a href="#UpdateanEntity">updating entities</a>, clients can ensure that such properties values are not lost if omitted from the update request.</p>
</details>
<details open><summary>
<h4 id="11414-handling-of-integrity-constraints"><a name="HandlingofIntegrityConstraints" href="#HandlingofIntegrityConstraints">11.4.1.4 Handling of Integrity Constraints</a></h4>
</summary>
<p>Services may impose cross-entity integrity constraints. Certain referential constraints, such as requiring an entity to be created with related entities can be satisfied through <a href="#CreateRelatedEntitiesWhenCreatinganEntity">creating</a> or <a href="#LinktoRelatedEntitiesWhenCreatinganEntity">linking</a> related entities when creating the entity. Other constraints might require multiple changes to be processed in an all-or-nothing fashion.</p>
</details>
<details open><summary>
<h4 id="11415-returning-results-from-data-modification-requests"><a name="ReturningResultsfromDataModificationRequests" href="#ReturningResultsfromDataModificationRequests">11.4.1.5 Returning Results from Data Modification Requests</a></h4>
</summary>
<p>Clients can request whether created or modified resources are returned from <a href="#CreateanEntity">create</a>, <a href="#UpdateanEntity">update</a>, and <a href="#UpsertanEntity">upsert</a> operations using the <a href="#Preferencereturnrepresentationandreturnminimal"><code>return</code></a> preference header. In the absence of such a header, services SHOULD return the created or modified content unless the resource is a stream property value.</p>
<p>When returning content other than for an update to a media entity stream, services MUST return the same content as a subsequent request to retrieve the same resource. For updating media entity streams, the content of a non-empty response body MUST be the updated media entity.</p>
<p>Requests that return a single instance of a structured type or a collection of structured type instances MAY specify the system query options <a href="#SystemQueryOptionexpand"><code>$expand</code></a> and <a href="#SystemQueryOptionselect"><code>$select</code></a>.</p>
<p>Requests that return a collection MAY specify the system query option <a href="#SystemQueryOptionfilter"><code>$filter</code></a>.</p>
<p>If one or more of these query options are present, this implies a <code>return=representation</code> preference if no <a href="#Preferencereturnrepresentationandreturnminimal"><code>return</code></a> preference is specified.</p>
<p>If one or more of these query options are present with a <code>return=minimal</code> preference, the service SHOULD NOT return a representation and MUST include a <a href="#HeaderPreferenceApplied"><code>Preference-Applied</code></a> header if it does not return a representation.</p>
<p>If one or more of these query options are present and the service returns a representation, then the service MUST apply the specified query options. If it cannot apply the specified query options appropriately, it MUST NOT fail the request solely due to the presence of these query options and instead MUST return <a href="#ResponseCode204NoContent"><code>204 No Content</code></a>.</p>
</details>
</details>
<details open><summary>
<h3 id="1142-create-an-entity"><a name="CreateanEntity" href="#CreateanEntity">11.4.2 Create an Entity</a></h3>
</summary>
<p>To create an entity in a collection, the client sends a <code>POST</code> request to that collection‚Äôs URL. The <code>POST</code> body MUST contain a single valid representation of an entity of the declared target entity type, or one of its derived types.</p>
<p>The entity representation MAY include <a href="#LinktoRelatedEntitiesWhenCreatinganEntity">references to existing entities</a> as well as content for <a href="#CreateRelatedEntitiesWhenCreatinganEntity">new related entities</a>, but MUST NOT contain content for existing related entities. The result of the operation is the entity with relationships to all included references to existing entities as well as all related entities created inline. If the key properties for an entity include key properties of a directly related entity, those related entities MUST be included either as references to existing entities or as content for new related entities.</p>
<p>An entity may also be created as the result of an <a href="#UpsertanEntity">Upsert</a> operation.</p>
<p>If the target URL for the collection is a navigation link, the new entity is automatically linked to the entity containing the navigation link.</p>
<p>If the target URL terminates in a type cast segment, then the segment MUST specify the type of, or a type derived from, the type of the collection, and the entity MUST be created as that specified type.</p>
<p>To create an <em>open entity</em> (an instance of an open type), additional property values beyond those specified in the metadata MAY be sent in the request body. The service MUST treat these as dynamic properties and add them to the created instance.</p>
<p>If the entity being created is not an open entity, additional property values beyond those specified in the metadata SHOULD NOT be sent in the request body. The service MUST fail if unable to persist all property values specified in the request.</p>
<p>If non-insertable properties are included in the request body, services MUST either ignore them or fail the request if the provided values do not match the service-determined values.</p>
<p>Non-insertable properties include (and are not limited to)</p>
<ul>
<li>dependent properties that are tied to non-key properties of the principal entity through a referential constraint <a href="#ODataCSDL">OData-CSDL, section 8.5</a> (informally: ‚Äúdenormalized‚Äù properties),</li>
<li>properties tagged with the term <a href="https://github.com/oasis-tcs/odata-vocabularies/blob/main/vocabularies/Org.OData.Core.V1.md#Computed"><code>Core.Computed</code></a>, see <a href="#ODataVocCore">OData-VocCore</a>,</li>
<li>properties listed as <code>NonInsertableProperties</code> of term <a href="https://github.com/oasis-tcs/odata-vocabularies/blob/main/vocabularies/Org.OData.Capabilities.V1.md#InsertRestrictions"><code>Capabilities.InsertRestrictions</code></a>, see <a href="#ODataVocCap">OData-VocCap</a>,</li>
<li>properties annotated with term <a href="https://github.com/oasis-tcs/odata-vocabularies/blob/main/vocabularies/Org.OData.Core.V1.md#Permissions"><code>Core.Permissions</code></a>, see <a href="#ODataVocCore">OData-VocCore</a>, where the annotation value does not have the <code>Write</code> flag.</li>
</ul>
<p>Properties tagged with <code>Core.Computed</code> MAY additionally be tagged with the term <a href="https://github.com/oasis-tcs/odata-vocabularies/blob/main/vocabularies/Org.OData.Core.V1.md#PostCondition"><code>Core.PostCondition</code></a>, see <a href="#ODataVocCore">OData-VocCore</a>, if the service does not ignore them. Clients can then provide these properties in an insert request and benefit from the certainty that, if the request succeeds, their service-determined values match the provided values. Providing such properties effectively imposes ‚Äúpost-conditions‚Äù that must be met for the request to succeed.</p>
<p>Otherwise, clients SHOULD omit non-insertable properties from the request body.</p>
<div class="example">
<p>Example 76: The entity <code>SalesOrder</code> has a property <code>ExportRegulationsState</code> which is tagged with <code>Core.Computed</code> and <code>Core.PostCondition</code> and which the service determines based on the product and destination country. Clients can specify it with value <code>Allowed</code> to impose a ‚Äúpost-condition‚Äù that a sales order is created only if it meets export regulations.</p>
</div>
<p>Services MUST return an error if the request body contains a value for a property that in principle can be specified on insert but the request cannot currently be executed respecting the specified value, for example, due to permissions or state of the object.</p>
<p>Properties with a default value, nullable properties, and collection-valued properties omitted from the request are set to the default value, null, or an empty collection, respectively.</p>
<p>Services MAY add dynamic properties to the created entity as long as their names do not conflict with the names of declared properties and client-specified dynamic properties.</p>
<p>Upon successful creation of the entity, the service MUST respond with either <a href="#ResponseCode201Created"><code>201 Created</code></a> and a representation of the created entity, or <a href="#ResponseCode204NoContent"><code>204 No Content</code></a> if the request included a <a href="#Preferencereturnrepresentationandreturnminimal"><code>return=minimal</code></a> preference and did not include the system query options <a href="#SystemQueryOptionselect"><code>$select</code></a> and <a href="#SystemQueryOptionexpand"><code>$expand</code></a>, or if a representation of the created entity could not be constructed. In either case, if the service is able to construct the edit URL or read URL of the created entity, the response MUST contain that URL in a <a href="#HeaderLocation"><code>Location</code></a> header.</p>
<details open><summary>
<h4 id="11421-link-to-related-entities-when-creating-an-entity"><a name="LinktoRelatedEntitiesWhenCreatinganEntity" href="#LinktoRelatedEntitiesWhenCreatinganEntity">11.4.2.1 Link to Related Entities When Creating an Entity</a></h4>
</summary>
<p>To create a new entity with links to existing entities in a single request, the client includes references to the related entities in the request body.</p>
<p>The representation for referencing related entities is format-specific.</p>
<div class="example">
<p>Example 77: using the JSON format, 4.0 clients can create a new manager entity with links to an existing manager (of managers) and to two existing employees by applying the <code>odata.bind</code> annotation to the <code>Manager</code> and <code>DirectReports</code> navigation properties</p>
<div class="sourceCode" id="cb95"><pre class="sourceCode json"><code class="sourceCode json"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb95-2"><a href="#cb95-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;@type&quot;</span><span class="fu">:</span> <span class="st">&quot;#Northwind.Manager&quot;</span><span class="fu">,</span></span>
<span id="cb95-3"><a href="#cb95-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;ID&quot;</span><span class="fu">:</span> <span class="dv">1</span><span class="fu">,</span></span>
<span id="cb95-4"><a href="#cb95-4" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;FirstName&quot;</span><span class="fu">:</span> <span class="st">&quot;Pat&quot;</span><span class="fu">,</span></span>
<span id="cb95-5"><a href="#cb95-5" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;LastName&quot;</span><span class="fu">:</span> <span class="st">&quot;Griswold&quot;</span><span class="fu">,</span></span>
<span id="cb95-6"><a href="#cb95-6" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;Manager@odata.bind&quot;</span><span class="fu">:</span> <span class="st">&quot;http://host/service/Employees(0)&quot;</span><span class="fu">,</span></span>
<span id="cb95-7"><a href="#cb95-7" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;DirectReports@odata.bind&quot;</span><span class="fu">:</span> <span class="ot">[</span></span>
<span id="cb95-8"><a href="#cb95-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;http://host/service/Employees(5)&quot;</span><span class="ot">,</span></span>
<span id="cb95-9"><a href="#cb95-9" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;http://host/service/Employees(6)&quot;</span></span>
<span id="cb95-10"><a href="#cb95-10" aria-hidden="true" tabindex="-1"></a>  <span class="ot">]</span></span>
<span id="cb95-11"><a href="#cb95-11" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code></pre></div>
</div>
<div class="example">
<p>Example 78: using the JSON format, 4.01 clients can create a new manager entity with links to an existing manager (of managers) and to two existing employees by including the entity-ids within the <code>Manager</code> and <code>DirectReports</code> navigation properties</p>
<div class="sourceCode" id="cb96"><pre class="sourceCode json"><code class="sourceCode json"><span id="cb96-1"><a href="#cb96-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb96-2"><a href="#cb96-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;@type&quot;</span><span class="fu">:</span> <span class="st">&quot;#Northwind.Manager&quot;</span><span class="fu">,</span></span>
<span id="cb96-3"><a href="#cb96-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;ID&quot;</span><span class="fu">:</span> <span class="dv">1</span><span class="fu">,</span></span>
<span id="cb96-4"><a href="#cb96-4" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;FirstName&quot;</span><span class="fu">:</span> <span class="st">&quot;Pat&quot;</span><span class="fu">,</span></span>
<span id="cb96-5"><a href="#cb96-5" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;LastName&quot;</span><span class="fu">:</span> <span class="st">&quot;Griswold&quot;</span><span class="fu">,</span></span>
<span id="cb96-6"><a href="#cb96-6" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;Manager&quot;</span><span class="fu">:</span> <span class="fu">{</span> <span class="dt">&quot;@id&quot;</span><span class="fu">:</span> <span class="st">&quot;Employees(0)&quot;</span> <span class="fu">},</span></span>
<span id="cb96-7"><a href="#cb96-7" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;DirectReports&quot;</span><span class="fu">:</span> <span class="ot">[</span><span class="fu">{</span> <span class="dt">&quot;@id&quot;</span><span class="fu">:</span> <span class="st">&quot;Employees(5)&quot;</span> <span class="fu">}</span><span class="ot">,</span> <span class="fu">{</span> <span class="dt">&quot;@id&quot;</span><span class="fu">:</span> <span class="st">&quot;Employees(6)&quot;</span> <span class="fu">}</span><span class="ot">]</span></span>
<span id="cb96-8"><a href="#cb96-8" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code></pre></div>
</div>
<p>Upon successful completion of the operation, the service creates the requested entity and relates it to the requested existing entities.</p>
<p>If the target URL for the collection the entity is created in and binding information provided in the <code>POST</code> body contradicts the implicit binding information provided by the request URL, the request MUST fail, and the service responds with <code>400 Bad Request</code>.</p>
<p>Upon failure of the operation, the service MUST NOT create the new entity. In particular, the service MUST never create an entity in a partially valid state (with the navigation property unset).</p>
</details>
<details open><summary>
<h4 id="11422-create-related-entities-when-creating-an-entity"><a name="CreateRelatedEntitiesWhenCreatinganEntity" href="#CreateRelatedEntitiesWhenCreatinganEntity">11.4.2.2 Create Related Entities When Creating an Entity</a></h4>
</summary>
<p>A request to create an entity that includes related entities, represented using the appropriate inline representation, is referred to as a ‚Äúdeep insert‚Äù.</p>
<p>Media entities MUST contain the format-specific representation of their media stream as a virtual property <code>$value</code> when nested within a deep insert.</p>
<p>Each included related entity is processed observing the rules for <a href="#CreateanEntity">creating an entity</a> as if it was posted against the original target URL extended with the navigation path to this related entity.</p>
<p>On success, the service MUST create all entities and relate them. If the service responds with <a href="#ResponseCode201Created"><code>201 Created</code></a>, the response MUST be expanded to at least the level that was present in the deep-insert request.</p>
<p>Clients MAY associate an id with individual nested entities in the request by applying the <a href="https://github.com/oasis-tcs/odata-vocabularies/blob/main/vocabularies/Org.OData.Core.V1.md#ContentID"><code>Core.ContentID</code></a> term using the namespace or alias defined for the <a href="#ODataVocCore">OData-VocCore</a> vocabulary in the service‚Äôs <code>$metadata</code> document. Services that respond with <a href="#ResponseCode201Created"><code>201 Created</code></a> SHOULD annotate the entities in the response using the same <a href="https://github.com/oasis-tcs/odata-vocabularies/blob/main/vocabularies/Org.OData.Core.V1.md#ContentID"><code>Core.ContentID</code></a> value as specified in the request. Services SHOULD advertise support for deep inserts, including support for returning the <a href="https://github.com/oasis-tcs/odata-vocabularies/blob/main/vocabularies/Org.OData.Core.V1.md#ContentID"><code>Core.ContentID</code></a>, through the <a href="https://github.com/oasis-tcs/odata-vocabularies/blob/main/vocabularies/Org.OData.Capabilities.V1.md#DeepInsertSupport"><code>Capabilities.DeepInsertSupport</code></a> term, defined in <a href="#ODataVocCap">OData-VocCap</a>; services that advertise support through <a href="https://github.com/oasis-tcs/odata-vocabularies/blob/main/vocabularies/Org.OData.Capabilities.V1.md#DeepInsertSupport"><code>Capabilities.DeepInsertSupport</code></a> MUST return the <a href="https://github.com/oasis-tcs/odata-vocabularies/blob/main/vocabularies/Org.OData.Core.V1.md#ContentID"><code>Core.ContentID</code></a> for the inserted or updated entities.</p>
<p>The <code>continue-on-error</code> preference is not supported for deep insert operations.</p>
<p>On failure, the service MUST NOT create any of the entities.</p>
</details>
</details>
<details open><summary>
<h3 id="1143-update-an-entity"><a name="UpdateanEntity" href="#UpdateanEntity">11.4.3 Update an Entity</a></h3>
</summary>
<p>To update an individual entity, the client makes a <code>PATCH</code> or <code>PUT</code> request to a URL that identifies the entity. Services MAY restrict updates only to requests addressing the <a href="#ReadURLsandEditURLs">edit URL</a> of the entity.</p>
<p>The body of the request MUST be a valid representation of the declared target entity type, or one of its derived types.</p>
<p>Services SHOULD support <code>PATCH</code> as the preferred means of updating an entity. <code>PATCH</code> provides more resiliency between clients and services by directly modifying only those values specified by the client.</p>
<p>The semantics of <code>PATCH</code>, as defined in <a href="#rfc5789">RFC5789</a>, is to merge the content in the request payload with the entity‚Äôs current state, applying the update only to those components specified in the request body. Collection properties and primitive properties provided in the payload corresponding to updatable properties MUST replace the value of the corresponding property in the entity or complex type. Complex properties are updated by applying <code>PATCH</code> semantics recursively, see also <a href="#UpdateaComplexProperty">section 11.4.9.3</a>. Omitted properties of the containing entity or complex property, including dynamic properties, MUST NOT be directly altered unless as a side effect of changes resulting from the provided properties.</p>
<p>If the type of the entity in a <code>PATCH</code> request differs from the type of the entity being updated (i.e., a different derived type of the declared target type), then properties shared through inheritance, as well as dynamic properties, are retained (unless overwritten by new values in the payload). Other properties of the original type are discarded.</p>
<p>Services MAY additionally support <code>PUT</code> but should be aware of the potential for data-loss in round-tripping properties that the client may not know about in advance, such as open or added properties, or properties not specified in metadata. Services that support <code>PUT</code> MUST replace all values of structural properties with those specified in the request body. Omitted non-key, updatable structural properties not defined as dependent properties within a referential constraint MUST be set to their default values. Omitting a non-nullable property with no service-generated or default value from a <code>PUT</code> request results in a <code>400 Bad Request</code> error. Omitted dynamic properties MUST be removed, set to <code>null</code>, or set to a service-generated value.</p>
<p>For requests with an <code>OData-Version</code> header with a value of <code>4.01</code> or greater, the media stream of a media entity can be updated by specifying the format-specific representation of the media stream as a virtual property <code>$value</code>.</p>
<p>Updating a dependent property that is tied to a key property of the principal entity through a referential constraint updates the relationship to point to the entity with the specified key value. If there is no such entity, the update fails.</p>
<p>Updating a principal property that is tied to a dependent entity through a referential constraint on the dependent entity updates the dependent property.</p>
<p>Non-updatable properties SHOULD be omitted from the request body. If they are provided, services MUST either ignore the values in the request body or fail the request if the provided values do not match the service-determined values.</p>
<p>Non-updatable properties include (and are not limited to)</p>
<ul>
<li>key properties,</li>
<li>dependent properties that are tied to non-key properties of the principal entity through a referential constraint <a href="#ODataCSDL">OData-CSDL, section 8.5</a> (informally: ‚Äúdenormalized‚Äù properties),</li>
<li>properties tagged with the terms <a href="https://github.com/oasis-tcs/odata-vocabularies/blob/main/vocabularies/Org.OData.Core.V1.md#Computed"><code>Core.Computed</code></a> or <a href="https://github.com/oasis-tcs/odata-vocabularies/blob/main/vocabularies/Org.OData.Core.V1.md#Immutable"><code>Core.Immutable</code></a>, see <a href="#ODataVocCore">OData-VocCore</a>,</li>
<li>properties listed as <code>NonUpdatableProperties</code> of term <a href="https://github.com/oasis-tcs/odata-vocabularies/blob/main/vocabularies/Org.OData.Capabilities.V1.md#UpdateRestrictions"><code>Capabilities.UpdateRestrictions</code></a>, see <a href="#ODataVocCap">OData-VocCap</a>,</li>
<li>properties annotated with term <a href="https://github.com/oasis-tcs/odata-vocabularies/blob/main/vocabularies/Org.OData.Core.V1.md#Permissions"><code>Core.Permissions</code></a>, see <a href="#ODataVocCore">OData-VocCore</a>, where the annotation value does not have the <code>Write</code> flag.</li>
</ul>
<p>Services MUST return an error if the request body contains a value for a property that in principle can be specified on update but the request cannot currently be executed respecting the specified value, for example, due to permissions or state of the object.</p>
<p>Clients can provide non-updatable properties to impose ‚Äúpost-conditions‚Äù as explained for <a href="#CreateanEntity">non-insertable properties</a>. Otherwise, clients SHOULD use <code>PATCH</code> and specify only those properties intended to be changed.</p>
<p>The entity-id cannot be changed when updating an entity. However, format-specific rules might in some cases require providing the entity-id in the payload when requesting the update.</p>
<p>For requests with an <code>OData-Version</code> header with a value of <code>4.01</code> or greater, if the entity representation in the request body includes an ETag value, the update MUST NOT be performed and SHOULD return <a href="#ResponseCode412PreconditionFailed"><code>412 Precondition Failed</code></a> if the supplied ETag value is not <code>*</code> and does not match the current ETag value for the entity. ETag values in request bodies MUST be ignored for requests containing an OData-Version header with a value of <code>4.0</code>.</p>
<p>If an update specifies both a binding to a single-valued navigation property and a dependent property that is tied to a key property of the principal entity according to the same navigation property, then the dependent property is ignored, and the relationship is updated according to the value specified in the binding.</p>
<p>If the entity being updated is open, then additional values for properties beyond those specified in the metadata or returned in a previous request MAY be sent in the request body. The service MUST treat these as dynamic properties.</p>
<p>If the entity being updated is not open, then additional values for properties beyond those specified in the metadata or returned in a previous request SHOULD NOT be sent in the request body. The service MUST fail if it is unable to persist all updatable property values specified in the request.</p>
<p>Upon successful completion of the update, the service responds with either <a href="#ResponseCode200OK"><code>200 OK</code></a> and a representation of the updated entity, or <a href="#ResponseCode204NoContent"><code>204 No Content</code></a>. The client may request that the response SHOULD include a body by specifying a <a href="#Preferencereturnrepresentationandreturnminimal"><code>return=representation</code></a> preference, or by specifying the system query options <a href="#SystemQueryOptionselect"><code>$select</code></a> or <a href="#SystemQueryOptionexpand"><code>$expand</code></a>. If the service uses ETags for optimistic concurrency control, the entities in the response MUST include ETags. If a representation of the updated entity could not be constructed, the service MAY ignore the system query options and respond with <code>204 No Content</code>.</p>
<details open><summary>
<h4 id="11431-update-related-entities-when-updating-an-entity"><a name="UpdateRelatedEntitiesWhenUpdatinganEntity" href="#UpdateRelatedEntitiesWhenUpdatinganEntity">11.4.3.1 Update Related Entities When Updating an Entity</a></h4>
</summary>
<p>Update requests with an OData-Version header with a value of <code>4.0</code> MUST NOT contain related entities as inline content. Such requests MAY contain binding information for navigation properties. For single-valued navigation properties this replaces the relationship. For collection-valued navigation properties this adds to the relationship.</p>
<p>Payloads with an <code>OData-Version</code> header with a value of <code>4.01</code> or greater MAY include nested entities and entity references that specify the full set of to be related entities, or a nested <a href="#DeltaPayloads">delta payload</a> representing the related entities that have been added, removed, or changed. Such a request is referred to as a ‚Äúdeep update‚Äù. If the nested collection is represented identical to an expanded navigation property, then the set of nested entities and entity references specified in a successful update request represents the full set of entities to be related according to that relationship and MUST NOT include added links, deleted links, or deleted entities.</p>
<div class="example">
<p>Example 79: using the JSON format, a 4.01 <code>PATCH</code> request can update a manager entity. Following the update, the manager has three direct reports; two existing employees and one new employee named <code>Suzanne Brown</code>. The <code>LastName</code> of employee 6 is updated to <code>Smith</code>.</p>
<div class="sourceCode" id="cb97"><pre class="sourceCode json"><code class="sourceCode json"><span id="cb97-1"><a href="#cb97-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb97-2"><a href="#cb97-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;@type&quot;</span><span class="fu">:</span> <span class="st">&quot;#Northwind.Manager&quot;</span><span class="fu">,</span></span>
<span id="cb97-3"><a href="#cb97-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;FirstName&quot;</span><span class="fu">:</span> <span class="st">&quot;Patricia&quot;</span><span class="fu">,</span></span>
<span id="cb97-4"><a href="#cb97-4" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;DirectReports&quot;</span><span class="fu">:</span> <span class="ot">[</span></span>
<span id="cb97-5"><a href="#cb97-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">{</span></span>
<span id="cb97-6"><a href="#cb97-6" aria-hidden="true" tabindex="-1"></a>      <span class="dt">&quot;@id&quot;</span><span class="fu">:</span> <span class="st">&quot;Employees(5)&quot;</span></span>
<span id="cb97-7"><a href="#cb97-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">}</span><span class="ot">,</span></span>
<span id="cb97-8"><a href="#cb97-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">{</span></span>
<span id="cb97-9"><a href="#cb97-9" aria-hidden="true" tabindex="-1"></a>      <span class="dt">&quot;@id&quot;</span><span class="fu">:</span> <span class="st">&quot;Employees(6)&quot;</span><span class="fu">,</span></span>
<span id="cb97-10"><a href="#cb97-10" aria-hidden="true" tabindex="-1"></a>      <span class="dt">&quot;LastName&quot;</span><span class="fu">:</span> <span class="st">&quot;Smith&quot;</span></span>
<span id="cb97-11"><a href="#cb97-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">}</span><span class="ot">,</span></span>
<span id="cb97-12"><a href="#cb97-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">{</span></span>
<span id="cb97-13"><a href="#cb97-13" aria-hidden="true" tabindex="-1"></a>      <span class="dt">&quot;FirstName&quot;</span><span class="fu">:</span> <span class="st">&quot;Suzanne&quot;</span><span class="fu">,</span></span>
<span id="cb97-14"><a href="#cb97-14" aria-hidden="true" tabindex="-1"></a>      <span class="dt">&quot;LastName&quot;</span><span class="fu">:</span> <span class="st">&quot;Brown&quot;</span></span>
<span id="cb97-15"><a href="#cb97-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">}</span></span>
<span id="cb97-16"><a href="#cb97-16" aria-hidden="true" tabindex="-1"></a>  <span class="ot">]</span></span>
<span id="cb97-17"><a href="#cb97-17" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code></pre></div>
</div>
<p>If the nested collection is represented as a delta annotation on the navigation property, then the collection contains members to be added or changed and MAY include deleted entities for entities that are no longer part of the collection, using the <a href="#DeltaPayloads">delta payload</a> format. If the deleted entity specifies a <code>reason</code> as <code>deleted</code>, then the entity is both removed from the collection and deleted, otherwise it is removed from the collection and only deleted if the relationship is contained. Non-key properties of the deleted entity are ignored. Nested collections MUST NOT contain added or deleted links. If the request contains nested delta collections, then the <code>PATCH</code> verb must be specified.</p>
<p>If a nested entity has the same id or key fields as an existing entity, the existing entity is updated according to the semantics of the <code>PUT</code> or <code>PATCH</code> request. Nested entities that have no id or key fields, or for which the id or key fields do not match existing entities, are treated as inserts. If the nested collection does not represent a containment relationship and has no navigation property binding, then such entities MUST include a context URL specifying the entity set in which the new entity is to be created. If any nested entities contain both id and key fields, they MUST identify the same entity, or the request is invalid.</p>
<div class="example">
<p>Example 80: using the JSON format, a 4.01 <code>PATCH</code> request can specify a nested delta representation to:</p>
<ul>
<li>delete employee 3 and remove link to it</li>
<li>remove the link to employee 4 and do not delete it</li>
<li>add a link to employee 5</li>
<li>change the last name of employee 6 and link to it if necessary</li>
<li>add a new employee named ‚ÄúSuzanne Brown‚Äù and link to it</li>
</ul>
<div class="sourceCode" id="cb98"><pre class="sourceCode json"><code class="sourceCode json"><span id="cb98-1"><a href="#cb98-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb98-2"><a href="#cb98-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;@type&quot;</span><span class="fu">:</span> <span class="st">&quot;#Northwind.Manager&quot;</span><span class="fu">,</span></span>
<span id="cb98-3"><a href="#cb98-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;FirstName&quot;</span><span class="fu">:</span> <span class="st">&quot;Patricia&quot;</span><span class="fu">,</span></span>
<span id="cb98-4"><a href="#cb98-4" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;DirectReports@delta&quot;</span><span class="fu">:</span> <span class="ot">[</span></span>
<span id="cb98-5"><a href="#cb98-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">{</span></span>
<span id="cb98-6"><a href="#cb98-6" aria-hidden="true" tabindex="-1"></a>      <span class="dt">&quot;@removed&quot;</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb98-7"><a href="#cb98-7" aria-hidden="true" tabindex="-1"></a>        <span class="dt">&quot;reason&quot;</span><span class="fu">:</span> <span class="st">&quot;deleted&quot;</span></span>
<span id="cb98-8"><a href="#cb98-8" aria-hidden="true" tabindex="-1"></a>      <span class="fu">},</span></span>
<span id="cb98-9"><a href="#cb98-9" aria-hidden="true" tabindex="-1"></a>      <span class="dt">&quot;@id&quot;</span><span class="fu">:</span> <span class="st">&quot;Employees(3)&quot;</span></span>
<span id="cb98-10"><a href="#cb98-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">}</span><span class="ot">,</span></span>
<span id="cb98-11"><a href="#cb98-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">{</span></span>
<span id="cb98-12"><a href="#cb98-12" aria-hidden="true" tabindex="-1"></a>      <span class="dt">&quot;@removed&quot;</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb98-13"><a href="#cb98-13" aria-hidden="true" tabindex="-1"></a>        <span class="dt">&quot;reason&quot;</span><span class="fu">:</span> <span class="st">&quot;changed&quot;</span></span>
<span id="cb98-14"><a href="#cb98-14" aria-hidden="true" tabindex="-1"></a>      <span class="fu">},</span></span>
<span id="cb98-15"><a href="#cb98-15" aria-hidden="true" tabindex="-1"></a>      <span class="dt">&quot;@id&quot;</span><span class="fu">:</span> <span class="st">&quot;Employees(4)&quot;</span></span>
<span id="cb98-16"><a href="#cb98-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">}</span><span class="ot">,</span></span>
<span id="cb98-17"><a href="#cb98-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">{</span></span>
<span id="cb98-18"><a href="#cb98-18" aria-hidden="true" tabindex="-1"></a>      <span class="dt">&quot;@id&quot;</span><span class="fu">:</span> <span class="st">&quot;Employees(5)&quot;</span></span>
<span id="cb98-19"><a href="#cb98-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">}</span><span class="ot">,</span></span>
<span id="cb98-20"><a href="#cb98-20" aria-hidden="true" tabindex="-1"></a>    <span class="fu">{</span></span>
<span id="cb98-21"><a href="#cb98-21" aria-hidden="true" tabindex="-1"></a>      <span class="dt">&quot;@id&quot;</span><span class="fu">:</span> <span class="st">&quot;Employees(6)&quot;</span><span class="fu">,</span></span>
<span id="cb98-22"><a href="#cb98-22" aria-hidden="true" tabindex="-1"></a>      <span class="dt">&quot;LastName&quot;</span><span class="fu">:</span> <span class="st">&quot;Smith&quot;</span></span>
<span id="cb98-23"><a href="#cb98-23" aria-hidden="true" tabindex="-1"></a>    <span class="fu">}</span><span class="ot">,</span></span>
<span id="cb98-24"><a href="#cb98-24" aria-hidden="true" tabindex="-1"></a>    <span class="fu">{</span></span>
<span id="cb98-25"><a href="#cb98-25" aria-hidden="true" tabindex="-1"></a>      <span class="dt">&quot;FirstName&quot;</span><span class="fu">:</span> <span class="st">&quot;Suzanne&quot;</span><span class="fu">,</span></span>
<span id="cb98-26"><a href="#cb98-26" aria-hidden="true" tabindex="-1"></a>      <span class="dt">&quot;LastName&quot;</span><span class="fu">:</span> <span class="st">&quot;Brown&quot;</span></span>
<span id="cb98-27"><a href="#cb98-27" aria-hidden="true" tabindex="-1"></a>    <span class="fu">}</span></span>
<span id="cb98-28"><a href="#cb98-28" aria-hidden="true" tabindex="-1"></a>  <span class="ot">]</span></span>
<span id="cb98-29"><a href="#cb98-29" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code></pre></div>
</div>
<p>Clients MAY associate an id with individual nested entities in the request by using the <a href="https://github.com/oasis-tcs/odata-vocabularies/blob/main/vocabularies/Org.OData.Core.V1.md#ContentID"><code>Core.ContentID</code></a> term defined in <a href="#ODataVocCore">OData-VocCore</a>. Services that respond with <a href="#ResponseCode200OK"><code>200 OK</code></a> SHOULD annotate the entities in the response using the same <a href="https://github.com/oasis-tcs/odata-vocabularies/blob/main/vocabularies/Org.OData.Core.V1.md#ContentID"><code>Core.ContentID</code></a> value as specified in the request. Services SHOULD advertise support for deep updates, including support for returning the <a href="https://github.com/oasis-tcs/odata-vocabularies/blob/main/vocabularies/Org.OData.Core.V1.md#ContentID"><code>Core.ContentID</code></a>, through the <a href="https://github.com/oasis-tcs/odata-vocabularies/blob/main/vocabularies/Org.OData.Capabilities.V1.md#DeepUpdateSupport"><code>Capabilities.DeepUpdateSupport</code></a> term, defined in <a href="#ODataVocCap">OData-VocCap</a>.</p>
<p>The <code>continue-on-error</code> preference is not supported for deep update operations.</p>
<p>On failure, the service MUST NOT apply any of the changes specified in the request.</p>
</details>
</details>
<details open><summary>
<h3 id="1144-upsert-an-entity"><a name="UpsertanEntity" href="#UpsertanEntity">11.4.4 Upsert an Entity</a></h3>
</summary>
<p>An upsert occurs when the client sends an <a href="#UpdateanEntity">update request</a> to a valid URL that identifies a single entity that does not yet exist. In this case the service MUST handle the request as a <a href="#CreateanEntity">create entity request</a> or fail the request altogether.</p>
<p>Upserts to single-valued navigation properties are possible for</p>
<ul>
<li>containment navigation properties,</li>
<li>non-containment navigation properties with a navigation property binding, or</li>
<li>payloads including a context URL specifying the entity set or contained collection of entities in which the new entity is to be created.</li>
</ul>
<p>Upserts are not supported against entities whose keys‚Äô values are generated by the service. Services MUST fail an update request to a URL that would identify such an entity and the entity does not yet exist.</p>
<p>Similarly, services MUST fail an update request to the URL of a <a href="#RequestingtheMediaStreamofaMediaEntityusingvalue">media entity</a> that does not yet exist. However, a <code>PUT</code> request to the <em>media edit URL</em> of a media entity does have Upsert semantics, in that the media entity is <a href="#CreateaMediaEntity">created</a> with the specified media stream if it does not already exist, otherwise the media stream of the existing media entity is <a href="#UpdateaMediaEntityStream">updated</a>.</p>
<p>Singleton entities can be upserted if they are nullable. Services supporting this SHOULD advertise it by annotating the singleton with the term <code>Capabilities.UpdateRestrictions</code> (nested property <code>Upsertable</code> with value <code>true</code>) defined in <a href="#ODataVocCap">OData-VocCap</a>.</p>
<p>A key property whose value is provided in the request URL SHOULD be omitted from the request body. If key properties are provided in the request URL and the request body with different values, services MUST either fail the request or ignore the value in the request body.</p>
<p>To ensure that an update request is not treated as an insert, the client MAY specify an <a href="#HeaderIfMatch"><code>If-Match</code></a> header in the update request. The service MUST NOT treat an update request containing an <code>If-Match</code> header as an insert.</p>
<p>A <code>PUT</code> or <code>PATCH</code> request MUST NOT be treated as an update if an <a href="#HeaderIfNoneMatch"><code>If-None-Match</code></a> header is specified with a value of <code>*</code>.</p>
</details>
<details open><summary>
<h3 id="1145-delete-an-entity"><a name="DeleteanEntity" href="#DeleteanEntity">11.4.5 Delete an Entity</a></h3>
</summary>
<p>To delete an individual entity, the client makes a <code>DELETE</code> request to a URL that identifies the entity. Services MAY restrict deletes only to requests addressing the <a href="#ReadURLsandEditURLs">edit URL</a> of the entity.</p>
<p>The request body SHOULD be empty. Top-level singleton entities can be deleted if they are nullable. Services supporting this MAY advertise it by annotating the singleton with the term <code>Capabilities.DeleteRestrictions</code> (nested property <code>Deletable</code> with value <code>true</code>) defined in <a href="#ODataVocCap">OData-VocCap</a>.</p>
<p>On successful completion of the delete, the response MUST either be <a href="#ResponseCode204NoContent"><code>204 No Content</code></a> and contain an empty body, or <a href="#ResponseCode200OK"><code>200 OK</code></a> and contain a representation of a deleted entity according to the specified format.</p>
<p>Services MUST implicitly remove relations to and from an entity when deleting it; clients need not delete the relations explicitly.</p>
<p>Services MAY implicitly delete or modify related entities if required by <a href="#HandlingofIntegrityConstraints">integrity constraints</a>. If integrity constraints are declared in <code>$metadata</code> using a <code>ReferentialConstraint</code> element, services MUST modify affected related entities according to the declared integrity constraints, e.g. by deleting dependent entities, or setting dependent properties to <code>null</code> or their default value.</p>
<p>One such integrity constraint results from using a navigation property in a key definition of an entity type. If the related ‚Äúkey‚Äù entity is deleted, the dependent entity is also deleted.</p>
</details>
<details open><summary>
<h3 id="1146-modifying-relationships-between-entities"><a name="ModifyingRelationshipsbetweenEntities" href="#ModifyingRelationshipsbetweenEntities">11.4.6 Modifying Relationships between Entities</a></h3>
</summary>
<p>Relationships between entities are represented by navigation properties as described in <a href="#DataModel">Data Model</a>. URL conventions for navigation properties are described in <a href="#ODataURL">OData-URL</a>.</p>
<details open><summary>
<h4 id="11461-add-a-reference-to-a-collection-valued-navigation-property"><a name="AddaReferencetoaCollectionValuedNavigationProperty" href="#AddaReferencetoaCollectionValuedNavigationProperty">11.4.6.1 Add a Reference to a Collection-Valued Navigation Property</a></h4>
</summary>
<p>A successful <code>POST</code> request to a navigation property‚Äôs references collection adds a relationship to an existing entity. The request body MUST contain a single entity reference that identifies the entity to be added. See the appropriate format document for details.</p>
<p>On successful completion, the response MUST be <a href="#ResponseCode204NoContent"><code>204 No Content</code></a> and contain an empty body.</p>
<p>Note that if the two entities are already related prior to the request, the request is completed successfully.</p>
</details>
<details open><summary>
<h4 id="11462-remove-a-reference-to-an-entity"><a name="RemoveaReferencetoanEntity" href="#RemoveaReferencetoanEntity">11.4.6.2 Remove a Reference to an Entity</a></h4>
</summary>
<p>A successful <code>DELETE</code> request to the URL that represents a reference to a related entity removes the relationship to that entity.</p>
<p>In OData 4.0, the entity reference to be removed within a collection-valued navigation property is the URL that represents the collection of related references, with the reference to be removed identified by the <a href="#ResolvinganEntityId"><code>$id</code></a> query option. OData 4.01 services additionally support using the URL that represents the reference of the collection member to be removed, identified by key, as described in <a href="#ODataURL">OData-URL</a>.</p>
<p>For single-valued navigation properties, the <a href="#ResolvinganEntityId"><code>$id</code></a> query option MUST NOT be specified.</p>
<p>The <code>DELETE</code> request MUST NOT violate any <a href="#HandlingofIntegrityConstraints">integrity constraints</a> in the data model.</p>
<p>On successful completion, the response MUST be <a href="#ResponseCode204NoContent"><code>204 No Content</code></a> and contain an empty body.</p>
</details>
<details open><summary>
<h4 id="11463-change-the-reference-in-a-single-valued-navigation-property"><a name="ChangetheReferenceinaSingleValuedNavigationProperty" href="#ChangetheReferenceinaSingleValuedNavigationProperty">11.4.6.3 Change the Reference in a Single-Valued Navigation Property</a></h4>
</summary>
<p>A successful <code>PUT</code> request to a single-valued navigation property‚Äôs reference resource changes the related entity. The request body MUST contain a single entity reference that identifies the existing entity to be related. See the appropriate format document for details.</p>
<p>On successful completion, the response MUST be <a href="#ResponseCode204NoContent"><code>204 No Content</code></a> and contain an empty body.</p>
<p>Alternatively, a relationship MAY be updated as part of an update to the source entity by including the required binding information for the new target entity. This binding information is format-specific, see <a href="#ODataJSON">OData-JSON</a> for details.</p>
<p>If the single-valued navigation property is used in the key definition of an entity type, it cannot be changed and the request MUST fail with <a href="#ResponseCode405MethodNotAllowed"><code>405 Method Not Allowed</code></a> or an other appropriate error.</p>
</details>
<details open><summary>
<h4 id="11464-replace-all-references-in-a-collection-valued-navigation-property"><a name="ReplaceallReferencesinaCollectionValuedNavigationProperty" href="#ReplaceallReferencesinaCollectionValuedNavigationProperty">11.4.6.4 Replace all References in a Collection-Valued Navigation Property</a></h4>
</summary>
<p>A successful <code>PUT</code> request to a collection-valued navigation property‚Äôs reference resource replaces the set of related entities. The request body MUST contain a collection of entity references in the same format as returned by a <code>GET</code> request to the navigation property‚Äôs reference resource.</p>
<p>A successful <code>DELETE</code> request to a collection-valued navigation property‚Äôs reference resource removes all related references from the collection.</p>
</details>
</details>
<details open><summary>
<h3 id="1147-managing-media-entities"><a name="ManagingMediaEntities" href="#ManagingMediaEntities">11.4.7 Managing Media Entities</a></h3>
</summary>
<p>A <a href="#RequestingtheMediaStreamofaMediaEntityusingvalue">media entity</a> MUST have a source URL that can be used to read the media stream, and MAY have a media edit URL that can be used to write to the media stream.</p>
<p>Because a media entity has both a media stream and standard entity properties special handling is required.</p>
<details open><summary>
<h4 id="11471-create-a-media-entity"><a name="CreateaMediaEntity" href="#CreateaMediaEntity">11.4.7.1 Create a Media Entity</a></h4>
</summary>
<p>A <code>PUT</code> request to the media edit URL of a null-valued singleton media entity (by convention, the resource path of the media entity URL appended with <code>/$value</code>), or a <code>POST</code> request to a media entity‚Äôs entity set, create a new media entity. The request body MUST contain the media value (for example, the photograph) whose media type MUST be specified in a <a href="#HeaderContentType"><code>Content-Type</code></a> header. The request body is always interpreted as the media value, even if it has the media type of an OData format supported by the service. The service may set other structural properties of the media entity upon creation, but it is not possible for clients to specify structural properties when creating the media entity.</p>
<p>Upon successful completion, the response MUST contain <a href="#HeaderLocation"><code>Location</code></a> header that contains the edit URL of the created media entity.</p>
<p>Upon successful completion the service responds with either <a href="#ResponseCode201Created"><code>201 Created</code></a>, or <a href="#ResponseCode204NoContent"><code>204 No Content</code></a> if the request included a <a href="#Preferencereturnrepresentationandreturnminimal"><code>return=minimal</code></a> preference.</p>
</details>
<details open><summary>
<h4 id="11472-update-a-media-entity-stream"><a name="UpdateaMediaEntityStream" href="#UpdateaMediaEntityStream">11.4.7.2 Update a Media Entity Stream</a></h4>
</summary>
<p>A successful <code>PUT</code> request to the media edit URL of an existing media entity changes the media stream of the entity.</p>
<p>If the media entity did not previously exist, then the request is interpreted as a creation request according to <a href="#CreateaMediaEntity">Create a Media Entity</a></p>
<p>If the entity includes an ETag value for the media stream, the client MUST include an <a href="#HeaderIfMatch"><code>If-Match</code></a> header with the ETag value.</p>
<p>The request body MUST contain the new media value for the entity whose media type MUST be specified in a <a href="#HeaderContentType"><code>Content-Type</code></a> header.</p>
<p>The service may set other structural properties of the media entity when updating the media entity stream, but it is not possible for clients to specify structural properties when updating the media entity stream.</p>
<p>On success, the service MUST respond with either <a href="#ResponseCode204NoContent"><code>204 No Content</code></a> and an empty body, or <a href="#ResponseCode200OK"><code>200 OK</code></a> if the client specified the preference <a href="#Preferencereturnrepresentationandreturnminimal"><code>return=representation</code></a>, in which case the response body MUST contain the updated media entity.</p>
</details>
<details open><summary>
<h4 id="11473-delete-a-media-entity"><a name="DeleteaMediaEntity" href="#DeleteaMediaEntity">11.4.7.3 Delete a Media Entity</a></h4>
</summary>
<p>A successful <code>DELETE</code> request to the entity‚Äôs edit URL or to the edit URL of its media stream deletes the media entity as described in <a href="#DeleteanEntity">Delete an Entity</a>.</p>
<p>Deleting a media entity also deletes the media associated with the entity.</p>
</details>
</details>
<details open><summary>
<h3 id="1148-managing-stream-properties"><a name="ManagingStreamProperties" href="#ManagingStreamProperties">11.4.8 Managing Stream Properties</a></h3>
</summary>
<p>An entity may have one or more <em>stream properties</em>. Stream properties are properties of type <code>Edm.Stream</code>.</p>
<p>The values for stream properties do not usually appear in the entity payload unless explicitly requested with <a href="#SystemQueryOptionexpand"><code>$expand</code></a>. Instead, the values are generally read or written through URLs.</p>
<div class="example">
<p>Example <a name="entityWithStreamProperty" href="#entityWithStreamProperty">81</a>: read an entity and select a stream property</p>
<pre><code>GET http://host/service/Products(1)?$select=Thumbnail</code></pre>
<p>would only include control information for the stream property, not the stream data itself</p>
<div class="sourceCode" id="cb100"><pre class="sourceCode json"><code class="sourceCode json"><span id="cb100-1"><a href="#cb100-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb100-2"><a href="#cb100-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;@context&quot;</span><span class="fu">:</span> <span class="st">&quot;http://host/service/$metadata#Products/$entity&quot;</span><span class="fu">,</span></span>
<span id="cb100-3"><a href="#cb100-3" aria-hidden="true" tabindex="-1"></a>  <span class="er">‚Ä¶</span></span>
<span id="cb100-4"><a href="#cb100-4" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;Thumbnail@mediaReadLink&quot;</span><span class="fu">:</span> <span class="st">&quot;http://server/Thumbnail546.jpg&quot;</span><span class="fu">,</span></span>
<span id="cb100-5"><a href="#cb100-5" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;Thumbnail@mediaEditLink&quot;</span><span class="fu">:</span> <span class="st">&quot;http://server/uploads/Thumbnail546.jpg&quot;</span><span class="fu">,</span></span>
<span id="cb100-6"><a href="#cb100-6" aria-hidden="true" tabindex="-1"></a>  <span class="er">‚Ä¶</span></span>
<span id="cb100-7"><a href="#cb100-7" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code></pre></div>
<p>The stream data can then be requested using the media read link:</p>
<pre><code>GET http://server/Thumbnail546.jpg</code></pre>
</div>
<p>Services SHOULD support direct property access to a stream property‚Äôs canonical URL. The response MAY be a redirect to the media read link of the stream property if the media read link is different from the canonical URL.</p>
<div class="example">
<p>Example 82: directly read a stream property of an entity</p>
<pre><code>GET http://host/service/Products(1)/Thumbnail</code></pre>
<p>can return <a href="#ResponseCode200OK"><code>200 OK</code></a> and the stream data (see <a href="#RequestingStreamProperties">section 11.2.4.1</a>), or a <a href="#ResponseCode3xxRedirection"><code>3xx Redirect</code></a> to the media read link of the stream property.</p>
</div>
<p>Note: for scenarios in which the media value can only be inlined, the property should instead be modeled with type <code>Edm.Binary</code>.</p>
<details open><summary>
<h4 id="11481-update-stream-values"><a name="UpdateStreamValues" href="#UpdateStreamValues">11.4.8.1 Update Stream Values</a></h4>
</summary>
<p>A successful <code>PUT</code> request to the edit URL of a stream property changes the media stream associated with that property.</p>
<p>If the stream metadata includes an ETag value, the client SHOULD include an <a href="#HeaderIfMatch"><code>If-Match</code></a> header with the ETag value.</p>
<p>The request body MUST contain the new media value for the stream whose media type MUST be specified in a <a href="#HeaderContentType"><code>Content-Type</code></a> header. It may have a <code>Content-Length</code> of zero to set the stream data to empty.</p>
<p>Stream properties MAY specify a list of acceptable media types using an annotation with term <a href="https://github.com/oasis-tcs/odata-vocabularies/blob/main/vocabularies/Org.OData.Core.V1.md#AcceptableMediaTypes"><code>Core.AcceptableMediaTypes</code></a>, see <a href="#ODataVocCore">OData-VocCore</a>.</p>
<p>On success, the service MUST respond with either <a href="#ResponseCode204NoContent"><code>204 No Content</code></a> and an empty body, or <a href="#ResponseCode200OK"><code>200 OK</code></a> if the client specified the preference <a href="#Preferencereturnrepresentationandreturnminimal"><code>return=representation</code></a>, in which case the response body MUST contain the updated media value for the stream.</p>
<p>Clients MAY change the association between a stream property and a media stream by modifying the edit URL or read URL of the stream property. Services supporting this SHOULD advertise it by annotating the stream property with the term <code>Capabilities.MediaLocationUpdateSupported</code> defined in <a href="#ODataVocCap">OData-VocCap</a>.</p>
</details>
<details open><summary>
<h4 id="11482-delete-stream-values"><a name="DeleteStreamValues" href="#DeleteStreamValues">11.4.8.2 Delete Stream Values</a></h4>
</summary>
<p>A successful <code>DELETE</code> request to the edit URL of a stream property attempts to set the property to null and results in an error if the property is non-nullable.</p>
<div class="example">
<p>Example 83: delete the stream value using the media edit link retrieved in <a href="#entityWithStreamProperty">example 81</a></p>
<pre><code>DELETE http://server/uploads/Thumbnail546.jpg</code></pre>
</div>
<p>Attempting to request a stream property whose value is null results in <a href="#ResponseCode204NoContent"><code>204 No Content</code></a>.</p>
</details>
</details>
<details open><summary>
<h3 id="1149-managing-values-and-properties-directly"><a name="ManagingValuesandPropertiesDirectly" href="#ManagingValuesandPropertiesDirectly">11.4.9 Managing Values and Properties Directly</a></h3>
</summary>
<p>Values and properties can be explicitly addressed with URLs. The edit URL of a property is the edit URL of the entity appended with the path segment(s) specifying the individual property. The edit URL allows properties to be individually modified. See <a href="#ODataURL">OData-URL</a> for details on addressing individual properties.</p>
<details open><summary>
<h4 id="11491-update-a-primitive-property"><a name="UpdateaPrimitiveProperty" href="#UpdateaPrimitiveProperty">11.4.9.1 Update a Primitive Property</a></h4>
</summary>
<p>A successful <code>PUT</code> request to the edit URL for a primitive property updates the value of the property. The message body MUST contain the new value, formatted as a single property according to the specified format.</p>
<p>A successful <code>PUT</code> request to the edit URL for the <a href="#RequestingaRawValueusingvalue">raw value</a> of a primitive property updates the property with the raw value specified in the payload. The payload MUST be formatted as an appropriate content type for the raw value of the property.</p>
<p>The same rules apply whether this is a regular property or a dynamic property.</p>
<p>Upon successful completion the service responds with either <a href="#ResponseCode200OK"><code>200 OK</code></a> or <a href="#ResponseCode204NoContent"><code>204 No Content</code></a>. The client may request that the response SHOULD include a body by specifying a <a href="#Preferencereturnrepresentationandreturnminimal"><code>return=representation</code></a> preference.</p>
<p>Services MUST return an error if the property is not updatable.</p>
</details>
<details open><summary>
<h4 id="11492-set-a-value-to-null"><a name="SetaValuetoNull" href="#SetaValuetoNull">11.4.9.2 Set a Value to Null</a></h4>
</summary>
<p>A successful <code>DELETE</code> request to the edit URL for a structural property, or to the edit URL of the <a href="#RequestingaRawValueusingvalue">raw value</a> of a primitive property, sets the property to null. The request body is ignored and should be empty.</p>
<p>A <code>DELETE</code> request to a non-nullable value MUST fail and the service respond with <code>400 Bad Request</code> or other appropriate error.</p>
<p>The same rules apply whether the target is the value of a regular property or the value of a dynamic property. A missing dynamic property is defined to be the same as a dynamic property with value <code>null</code>. All dynamic properties are nullable.</p>
<p>On success, the service MUST respond with <a href="#ResponseCode204NoContent"><code>204 No Content</code></a> and an empty body.</p>
<p>Services MUST return an error if the property is not updatable.</p>
<p><a href="#UpdateaPrimitiveProperty">Updating a primitive property</a> or a <a href="#UpdateaComplexProperty">complex property</a> with a null value also sets the property to null.</p>
</details>
<details open><summary>
<h4 id="11493-update-a-complex-property"><a name="UpdateaComplexProperty" href="#UpdateaComplexProperty">11.4.9.3 Update a Complex Property</a></h4>
</summary>
<p>A successful <code>PATCH</code> request to the edit URL for a complex typed property updates that property. The request body MUST contain a single valid representation for the declared type of the complex property or one of its derived types.</p>
<p>The service MUST directly modify only those properties of the complex type specified in the payload of the <code>PATCH</code> request.</p>
<p>If a complex-typed property is set to a different type in a <code>PATCH</code> request, properties shared through inheritance, as well as dynamic properties, are retained (unless overwritten by new values in the payload). Other properties of the original type are discarded.</p>
<p>The service MAY additionally support clients sending a <code>PUT</code> request to a URL that specifies a complex type. In this case, the service MUST replace the entire complex property with the values specified in the request body and set all unspecified properties to their default value.</p>
<p>Upon successful completion the service responds with either <a href="#ResponseCode200OK"><code>200 OK</code></a> or <a href="#ResponseCode204NoContent"><code>204 No Content</code></a>. The client may request that the response SHOULD include a body by specifying a <a href="#Preferencereturnrepresentationandreturnminimal"><code>return=representation</code></a> preference.</p>
<p>Services MUST return an error if the property is not updatable.</p>
</details>
<details open><summary>
<h4 id="11494-update-a-collection-property"><a name="UpdateaCollectionProperty" href="#UpdateaCollectionProperty">11.4.9.4 Update a Collection Property</a></h4>
</summary>
<p>A successful <code>PUT</code> request to the edit URL of a collection property updates that collection. The message body MUST contain the desired new value, formatted as a collection property according to the specified format.</p>
<p>The service MUST replace the entire value with the value supplied in the request body.</p>
<p>A successful <code>POST</code> request to the edit URL of a collection property adds an item to the collection. The body of the request MUST be a single item to be added to the collection. If the collection is ordered, the item is added to the end of the collection, and if the collection supports positional insert <a href="#RequestinganIndividualMemberofanOrderedCollection"><code>$index</code></a> MAY be used to specify the insert position.</p>
<p>A successful <code>DELETE</code> request to the edit URL of a collection property deletes all items in that collection.</p>
<p>Since collection members have no individual identity, <code>PATCH</code> is not supported for collection properties.</p>
<p>Upon successful completion the service responds with either <a href="#ResponseCode200OK"><code>200 OK</code></a> and a representation of the updated collection, or <a href="#ResponseCode204NoContent"><code>204 No Content</code></a>. The client may request that the response SHOULD include a body by specifying a <a href="#Preferencereturnrepresentationandreturnminimal"><code>return=representation</code></a> preference.</p>
<p>Services MUST return an error if the property is not updatable.</p>
</details>
</details>
<details open><summary>
<h3 id="11410-managing-members-of-an-ordered-collection"><a name="ManagingMembersofanOrderedCollection" href="#ManagingMembersofanOrderedCollection">11.4.10 Managing Members of an Ordered Collection</a></h3>
</summary>
<p>Collections annotated with the <a href="https://github.com/oasis-tcs/odata-vocabularies/blob/main/vocabularies/Org.OData.Core.V1.md#Ordered"><code>Core.Ordered</code></a> term (see <a href="#ODataVocCore">OData-VocCore</a>) have a stable order. Members of an ordered collection of primitive and complex types can be individually updated or deleted by invoking an update operation against the URL of the collection appended by a segment containing the zero-based ordinal of the item within the collection. A negative ordinal number indexes from the end of the collection, with -1 representing the last item in the collection.</p>
<p>Entities can be updated using their edit URL and SHOULD NOT be addressed using an index.</p>
</details>
<details open><summary>
<h3 id="11411-positional-inserts"><a name="PositionalInserts" href="#PositionalInserts">11.4.11 Positional Inserts</a></h3>
</summary>
<p>Collections of entity, complex, or primitive types annotated with the <a href="https://github.com/oasis-tcs/odata-vocabularies/blob/main/vocabularies/Org.OData.Core.V1.md#PositionalInsert"><code>Core.PositionalInsert</code></a> term (see <a href="#ODataVocCore">OData-VocCore</a>) support inserting items at a specific location via <code>POST</code> requests to the collection URL using the <code>$index</code> system query option. The value of the <code>$index</code> system query option is the zero-based ordinal position where the item is to be inserted. The ordinal positions of items within the collection greater than or equal to the inserted position are increased by one. A negative ordinal number indexes from the end of the collection, with -1 representing an insert as the last item in the collection.</p>
<div class="example">
<p>Example 84: Insert a new email address at the second position</p>
<div class="sourceCode" id="cb104"><pre class="sourceCode json"><code class="sourceCode json"><span id="cb104-1"><a href="#cb104-1" aria-hidden="true" tabindex="-1"></a><span class="er">POST</span> <span class="er">/service/Customers(&#39;ALFKI&#39;)/EmailAddresses?$index=1</span></span>
<span id="cb104-2"><a href="#cb104-2" aria-hidden="true" tabindex="-1"></a><span class="er">Content-Type:</span> <span class="er">application/json</span></span>
<span id="cb104-3"><a href="#cb104-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb104-4"><a href="#cb104-4" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb104-5"><a href="#cb104-5" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;value&quot;</span><span class="fu">:</span> <span class="st">&quot;alfred@futterkiste.de&quot;</span></span>
<span id="cb104-6"><a href="#cb104-6" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code></pre></div>
</div>
</details>
<details open><summary>
<h3 id="11412-update-a-collection-of-entities"><a name="UpdateaCollectionofEntities" href="#UpdateaCollectionofEntities">11.4.12 Update a Collection of Entities</a></h3>
</summary>
<p>Collections of entities can be updated by submitting a <code>PATCH</code> request to the resource path of the collection. The body of the request MUST be a <a href="#DeltaPayloads">delta payload</a>, and the resource path of the collection MUST NOT contain type cast or filter segments, and MUST NOT contain any system query options that affect the shape of the result.</p>
<p>Added/changed entities are applied as <a href="#UpsertanEntity">upserts</a>, and deleted entities as <a href="#DeleteanEntity">deletions</a>. Non-key properties of deleted entities are ignored. The top-level collection may include added and deleted links, and related entities represented inline are updated according to the rules for <a href="#UpdateRelatedEntitiesWhenUpdatinganEntity">treating related entities when updating an entity</a>.</p>
<p>Clients MAY associate an id with individual nested entities in the request by using the <a href="https://github.com/oasis-tcs/odata-vocabularies/blob/main/vocabularies/Org.OData.Core.V1.md#ContentID"><code>Core.ContentID</code></a> term defined in <a href="#ODataVocCore">OData-VocCore</a>. Services that respond with <a href="#ResponseCode200OK"><code>200 OK</code></a> SHOULD annotate the entities in the response using the same <a href="https://github.com/oasis-tcs/odata-vocabularies/blob/main/vocabularies/Org.OData.Core.V1.md#ContentID"><code>Core.ContentID</code></a> value as specified in the request.</p>
<p>Services SHOULD advertise support for updating a collection using a delta payload through the <code>DeltaUpdateSupported</code> property of the <a href="https://github.com/oasis-tcs/odata-vocabularies/blob/main/vocabularies/Org.OData.Capabilities.V1.md#UpdateRestrictionsType"><code>Capabilities.UpdateRestrictions</code></a> term, and SHOULD advertise support for returning the <a href="https://github.com/oasis-tcs/odata-vocabularies/blob/main/vocabularies/Org.OData.Core.V1.md#ContentID"><code>Core.ContentID</code></a> through the <code>ContentIDSupported</code> property of the <a href="https://github.com/oasis-tcs/odata-vocabularies/blob/main/vocabularies/Org.OData.Capabilities.V1.md#DeepUpdateSupportType"><code>Capabilities.DeepUpdateSupport</code></a> term, both defined in <a href="#ODataVocCap">OData-VocCap</a>.</p>
<p>For each entity being updated or removed, clients MAY specify an <a href="#UseofETagsforAvoidingUpdateConflicts">ETag</a> value obtained from a previous request. If an ETag is provided that does not match the ETag value of the entity being updated or removed, or if an ETag is provided when adding or updating an entity that does not currently exist, then services that support ETags MUST NOT apply the change and instead <a href="#ErrorHandlingwhenUpdatingaCollectionofEntities">report</a> a <code>412 Precondition Failed</code> error. The special value <code>*</code> can be used to match any existing entity but fail if the entity does not already exist.</p>
<p>The response, if requested, is a delta payload, in the same structure and order as the request payload, representing the applied changes.</p>
<details open><summary>
<h4 id="114121-error-handling-when-updating-a-collection-of-entities"><a name="ErrorHandlingwhenUpdatingaCollectionofEntities" href="#ErrorHandlingwhenUpdatingaCollectionofEntities">11.4.12.1 Error Handling when Updating a Collection of Entities</a></h4>
</summary>
<p>If the <code>continue-on-error</code> preference has not been applied, and the service is unable to apply all of the changes in the request, then it MUST return an error response and MUST NOT apply any of the changes specified in the request payload.</p>
<p>If the <a href="#Preferencecontinueonerrorodatacontinueonerror"><code>continue-on-error</code></a> preference has been applied and any errors occur in processing the changes, then a delta response MUST be returned regardless of the <a href="#Preferencereturnrepresentationandreturnminimal"><code>return</code></a> preference and MUST contain at least the failed changes. The service represents failed changes in the delta response as follows:</p>
<ul>
<li>Failed deletes in the request MUST be represented in the response as either entities or entity references, annotated with the term <code>Core.DataModificationException</code>, see <a href="#ODataVocCore">OData-VocCore</a>. If the deleted entity specified a reason of <code>deleted</code>, or the target collection is an entity set or containment navigation property, then the value of <code>failedOperation</code> MUST be <code>delete</code>, otherwise <code>unlink</code>.</li>
<li>Failed inserts within the request MUST be represented in the response as deleted entities annotated with the term <code>Core.DataModificationException</code> with a <code>failedOperation</code> value of <code>insert</code>.</li>
<li>Failed updates within the request SHOULD be annotated in the response with the term <code>Core.DataModificationException</code> with a <code>failedOperation</code> value of <code>update</code>.</li>
<li>Failed added links within the request MUST be represented in the response as deleted links annotated with the term <code>Core.DataModificationException</code> with a <code>failedOperation</code> value of <code>link</code>.</li>
<li>Failed deleted links within the request MUST be represented in the response as added links annotated with the term <code>Core.DataModificationException</code> with a <code>failedOperation</code> value of <code>unlink</code>.</li>
<li>Delta collections within the request are returned as delta collections in the response, according to these same rules.</li>
<li>Collections within the request are represented as collections in the response according to the rules specified in <a href="#ErrorHandlingwhenReplacingaCollectionofEntities">Replace a Collection of Entities</a>.</li>
</ul>
<p>If an individual change fails due to a failed dependency, it MUST be annotated with the term <a href="https://github.com/oasis-tcs/odata-vocabularies/blob/main/vocabularies/Org.OData.Core.V1.md#DataModificationException"><code>Core.DataModificationException</code></a> and SHOULD specify a <code>responseCode</code> of <code>424</code> (<a href="#ResponseCode424FailedDependency">Failed Dependency</a>).</p>
</details>
</details>
<details open><summary>
<h3 id="11413-replace-a-collection-of-entities"><a name="ReplaceaCollectionofEntities" href="#ReplaceaCollectionofEntities">11.4.13 Replace a Collection of Entities</a></h3>
</summary>
<p>Collections of entities can be replaced by submitting a <code>PUT</code> request to the resource path of the collection. The body of the request MUST be the representation of the complete collection of replacement entities. In this case all entities provided in the request are applied as <a href="#UpsertanEntity">upserts</a>, and any entities not provided in the request are deleted.</p>
<p>For each entity being updated, clients MAY specify an <a href="#UseofETagsforAvoidingUpdateConflicts">ETag</a> value obtained from a previous request. If an ETag is provided that does not match the ETag value of the entity being updated, or if an ETag is provided for an entity that does not currently exist, then services that support ETags MUST NOT apply the change and instead <a href="#ErrorHandlingwhenReplacingaCollectionofEntities">report</a> a <code>412 Precondition Failed</code>. The special ETag value <code>*</code> can be used to match any existing entity but fail if the entity does not already exist.</p>
<details open><summary>
<h4 id="114131-error-handling-when-replacing-a-collection-of-entities"><a name="ErrorHandlingwhenReplacingaCollectionofEntities" href="#ErrorHandlingwhenReplacingaCollectionofEntities">11.4.13.1 Error Handling when Replacing a Collection of Entities</a></h4>
</summary>
<p>If the <code>continue-on-error</code> preference has not been applied, and the service is unable to apply all of the changes in the request, then it MUST return an error response and MUST NOT apply any of the changes specified in the request payload.</p>
<p>If the <code>continue-on-error</code> preference has been applied and any errors occur in processing the changes, then a response MUST be returned regardless of the <a href="#Preferencereturnrepresentationandreturnminimal"><code>return</code></a> preference, and MUST contain the full membership and values of the collection as it exists in the service, as follows:</p>
<ul>
<li>Entities missing in the request that cannot be removed from the collection MUST be represented in the response as either entities or entity references, and SHOULD be annotated with the term <code>Core.DataModificationException</code>, see <a href="#ODataVocCore">OData-VocCore</a>. If the target collection is an entity set or containment navigation property, then the value of <code>failedOperation</code> MUST be <code>delete</code>, otherwise <code>unlink</code>.</li>
<li>Failed inserts within the request MUST NOT be represented in the response.</li>
<li>Failed updates within the request MUST be represented in the response with their current values and SHOULD be annotated with the term <code>Core.DataModificationException</code> with a <code>failedOperation</code> value of <code>update</code>.</li>
<li>Collections within the request MUST also be represented in the response following these same rules.</li>
</ul>
</details>
</details>
<details open><summary>
<h3 id="11414-update-members-of-a-collection"><a name="UpdateMembersofaCollection" href="#UpdateMembersofaCollection">11.4.14 Update Members of a Collection</a></h3>
</summary>
<p>Members of a collection can be updated by submitting a <code>PATCH</code> request to the URL constructed by appending <code>/$each</code> to the resource path of the collection. The additional path segment expresses that the request body describes an update to each member of the collection, not an update to the collection itself.</p>
<p>The resource path of the collection MAY contain type-cast or filter segments to subset the collection, see <a href="#ODataURL">OData-URL</a>.</p>
<p>For primitive-typed collections the body of the request MUST be a primitive value. Each member of the potentially filtered collection is updated to the specified primitive value.</p>
<p>For collections of structured type, the body of the request MUST be a full or partial representation of an instance of the collection‚Äôs structured type. Each member of the potentially filtered collection is <a href="#UpdateanEntity">updated</a> using <code>PATCH</code> semantics. Structured types MAY include nested collections or delta collections, in which case the semantics described in <a href="#UpdateaCollectionofEntities">Update a Collection of Entities</a> applies.</p>
<div class="example">
<p>Example 85: change the color of all beige-brown products</p>
<div class="sourceCode" id="cb105"><pre class="sourceCode json"><code class="sourceCode json"><span id="cb105-1"><a href="#cb105-1" aria-hidden="true" tabindex="-1"></a><span class="er">PATCH</span> <span class="er">/service/Products/$filter(@bar)/$each?@bar=Color</span> <span class="er">eq</span> <span class="er">&#39;beige-brown&#39;</span></span>
<span id="cb105-2"><a href="#cb105-2" aria-hidden="true" tabindex="-1"></a><span class="er">Content-Type:</span> <span class="er">application/json</span></span>
<span id="cb105-3"><a href="#cb105-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-4"><a href="#cb105-4" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb105-5"><a href="#cb105-5" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;Color&quot;</span><span class="fu">:</span> <span class="st">&quot;taupe&quot;</span></span>
<span id="cb105-6"><a href="#cb105-6" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code></pre></div>
</div>
<p>The response, if requested, is a collection payload containing the updated representation of each member identified by the request. If the update payload includes nested collections or nested delta collections, then they MUST be included in the response, as described in <a href="#UpdateaCollectionofEntities">Update a Collection of Entities</a>.</p>
<p>Clients should note that requesting a response may be expensive for services that could otherwise efficiently apply updates to a (possibly filtered) collection.</p>
<p>If the <code>continue-on-error</code> preference has been specified, the service MAY continue processing updates after a failure. In this case, the service MUST return a response containing at least the members of the collection that failed to update, which MUST be annotated with the term <code>Core.DataModificationException</code> with a <code>failedOperation</code> value of <code>update</code>.</p>
<p>If the <code>continue-on-error</code> preference has not been specified, and the service is unable to update all of the members identified by the request, then it MUST return an error response and MUST NOT apply any updates.</p>
</details>
<details open><summary>
<h3 id="11415-delete-members-of-a-collection"><a name="DeleteMembersofaCollection" href="#DeleteMembersofaCollection">11.4.15 Delete Members of a Collection</a></h3>
</summary>
<p>Members of a collection can be deleted by submitting a <code>DELETE</code> request to the URL constructed by appending <code>/$each</code> to the resource path of the collection. The additional path segment expresses that the collection itself is not deleted.</p>
<p>The request resource path of the collection MAY contain type-cast or filter segments to subset the collection.</p>
<div class="example">
<p>Example 86: delete all products older than 3</p>
<pre><code>DELETE /service/Products/$filter(Age gt 3)/$each</code></pre>
</div>
<p>If the path identifies a collection of entities and if the service returns a representation, then the response is a delta response containing a representation of a deleted entity for each deleted member.</p>
<p>If the collection is a collection of entities, then the client MAY specify the <code>continue-on-error</code> preference, in which case the service MAY continue processing deletes after a failure. In this case, the service MUST return a response containing at least an entity or entity reference for each entity identified by the request that failed to delete, which MUST be annotated with the term <code>Core.DataModificationException</code> with a <code>failedOperation</code> value of <code>delete</code>.</p>
<p>Clients should note that requesting a response may be expensive for services that could otherwise efficiently apply deletes to a (possibly filtered) collection.</p>
<p>If the <code>continue-on-error</code> preference has not been specified, and the service is unable to delete all of the entities identified by the request, then it MUST return an error response and MUST NOT apply any changes.</p>
</details>
</details>
<details open><summary>
<h2 id="115-operations"><a name="Operations" href="#Operations">11.5 Operations</a></h2>
</summary>
<p>Custom operations (<a href="#Actions">Actions</a> and <a href="#Functions">Functions</a>) allow encapsulating logic for modifying or requesting data that goes beyond simple CRUD described in the preceding sections of this chapter. See <code>Action</code>, <code>ActionImport</code>, <code>Function</code>, and <code>FunctionImport</code> in <a href="#ODataCSDL">OData-CSDLJSON</a> or <a href="#ODataCSDL">OData-CSDLXML</a>.</p>
<details open><summary>
<h3 id="1151-binding-an-operation-to-a-resource"><a name="BindinganOperationtoaResource" href="#BindinganOperationtoaResource">11.5.1 Binding an Operation to a Resource</a></h3>
</summary>
<p><a href="#Actions">Actions</a> and <a href="#Functions">Functions</a> MAY be bound to any type or collection, similar to defining a method in a class in object-oriented programming. The first parameter of a bound operation is the <em>binding parameter</em>.</p>
<p>The namespace- or alias-qualified name of a bound operation may be appended to any URL that identifies a resource whose type matches, or is derived from, the type of the binding parameter. The resource identified by that URL is used as the <em>binding parameter value</em>. Only aliases defined in the metadata document of the service can be used in URLs.</p>
<div class="example">
<p>Example 87: the function <code>MostRecentOrder</code> can be bound to any URL that identifies a <code>SampleModel.Customer</code></p>
<div class="sourceCode" id="cb107"><pre class="sourceCode xml"><code class="sourceCode xml"><span id="cb107-1"><a href="#cb107-1" aria-hidden="true" tabindex="-1"></a>&lt;<span class="kw">Function</span><span class="ot"> Name=</span><span class="st">&quot;MostRecentOrder&quot;</span><span class="ot"> IsBound=</span><span class="st">&quot;true&quot;</span>&gt;</span>
<span id="cb107-2"><a href="#cb107-2" aria-hidden="true" tabindex="-1"></a>  &lt;<span class="kw">Parameter</span><span class="ot"> Name=</span><span class="st">&quot;customer&quot;</span><span class="ot"> Type=</span><span class="st">&quot;SampleModel.Customer&quot;</span> /&gt;</span>
<span id="cb107-3"><a href="#cb107-3" aria-hidden="true" tabindex="-1"></a>  &lt;<span class="kw">ReturnType</span><span class="ot"> Type=</span><span class="st">&quot;SampleModel.Order&quot;</span> /&gt;</span>
<span id="cb107-4"><a href="#cb107-4" aria-hidden="true" tabindex="-1"></a>&lt;/<span class="kw">Function</span>&gt;</span></code></pre></div>
</div>
<div class="example">
<p>Example 88: invoke the <code>MostRecentOrder</code> function with the value of the binding parameter <code>customer</code> being the entity identified by <code>http://host/service/Customers(6)</code></p>
<pre><code>GET http://host/service/Customers(6)/SampleModel.MostRecentOrder()</code></pre>
</div>
<div class="example">
<p>Example 89: the function <code>Comparison</code> can be bound to any URL that identifies a collection of entities</p>
<div class="sourceCode" id="cb109"><pre class="sourceCode xml"><code class="sourceCode xml"><span id="cb109-1"><a href="#cb109-1" aria-hidden="true" tabindex="-1"></a>&lt;<span class="kw">Function</span><span class="ot"> Name=</span><span class="st">&quot;Comparison&quot;</span><span class="ot"> IsBound=</span><span class="st">&quot;true&quot;</span>&gt;</span>
<span id="cb109-2"><a href="#cb109-2" aria-hidden="true" tabindex="-1"></a>  &lt;<span class="kw">Parameter</span><span class="ot"> Name=</span><span class="st">&quot;in&quot;</span><span class="ot"> Type=</span><span class="st">&quot;Collection(Edm.EntityType)&quot;</span> /&gt;</span>
<span id="cb109-3"><a href="#cb109-3" aria-hidden="true" tabindex="-1"></a>  &lt;<span class="kw">ReturnType</span><span class="ot"> Type=</span><span class="st">&quot;Diff.Overview&quot;</span> /&gt;</span>
<span id="cb109-4"><a href="#cb109-4" aria-hidden="true" tabindex="-1"></a>&lt;/<span class="kw">Function</span>&gt;</span></code></pre></div>
</div>
<div class="example">
<p>Example 90: invoke the <code>Comparison</code> function on the set of red products</p>
<pre><code>GET http://host/service/Products/$filter(Color eq &#39;Red&#39;)/Diff.Comparison()</code></pre>
</div>
</details>
<details open><summary>
<h3 id="1152-applying-an-operation-to-members-of-a-collection"><a name="ApplyinganOperationtoMembersofaCollection" href="#ApplyinganOperationtoMembersofaCollection">11.5.2 Applying an Operation to Members of a Collection</a></h3>
</summary>
<p>A bound operation with a single-valued binding parameter can be applied to each member of a collection by appending the path segment <code>/$each</code> to the resource path of the collection, followed by a forward slash and the namespace- or alias-qualified name of the bound operation. In this case the type of the collection members MUST match or be derived from the type of the binding parameter.</p>
<p>The resource path of the collection MAY contain type-cast or filter segments to subset the collection.</p>
<p>The response is a collection with members that are instances of the result type of the bound operation. If the bound operation returns a collection, the response is a collection of collections.</p>
<div class="example">
<p>Example 91: invoke the <code>MostRecentOrder</code> function on each entity in the entity set <code>Customers</code></p>
<pre><code>GET http://host/service/Customers/$each/SampleModel.MostRecentOrder()</code></pre>
</div>
<p>The client MAY specify the <code>continue-on-error</code> preference, in which case the service MAY continue processing actions after a failure. In this case, the service MUST, regardless of the <code>return</code> preference, return a response containing at least the members identified by the request for which the action failed. Such members MUST be annotated with the term <code>Core.DataModificationException</code> with a <code>failedOperation</code> value of <code>invoke</code>.</p>
<p>If the <code>continue-on-error</code> preference has not been specified, and the service is unable to invoke the action against all of the entities identified by the request, then it MUST return an error response and MUST NOT apply the action to any of the members of the collection.</p>
</details>
<details open><summary>
<h3 id="1153-advertising-available-operations-within-a-payload"><a name="AdvertisingAvailableOperationswithinaPayload" href="#AdvertisingAvailableOperationswithinaPayload">11.5.3 Advertising Available Operations within a Payload</a></h3>
</summary>
<p>Services MAY return actions and/or functions bound to a particular entity or entity collection as part of the representation of the entity or entity collection within the payload. The representation of an action or function depends on the <a href="#Formats">format</a>.</p>
<div class="example">
<p>Example 92: given a <code>GET</code> request to <code>http://host/service/Customers('ALFKI')</code>, the service might respond with a Customer that includes the <code>SampleEntities.MostRecentOrder</code> function bound to the entity</p>
<div class="sourceCode" id="cb112"><pre class="sourceCode json"><code class="sourceCode json"><span id="cb112-1"><a href="#cb112-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb112-2"><a href="#cb112-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;@context&quot;</span><span class="fu">:</span> <span class="er">‚Ä¶</span><span class="fu">,</span></span>
<span id="cb112-3"><a href="#cb112-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;CustomerID&quot;</span><span class="fu">:</span> <span class="st">&quot;ALFKI&quot;</span><span class="fu">,</span></span>
<span id="cb112-4"><a href="#cb112-4" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;CompanyName&quot;</span><span class="fu">:</span> <span class="st">&quot;Alfreds Futterkiste&quot;</span><span class="fu">,</span></span>
<span id="cb112-5"><a href="#cb112-5" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;#SampleEntities.MostRecentOrder&quot;</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb112-6"><a href="#cb112-6" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;title&quot;</span><span class="fu">:</span> <span class="st">&quot;Most Recent Order&quot;</span><span class="fu">,</span></span>
<span id="cb112-7"><a href="#cb112-7" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;target&quot;</span><span class="fu">:</span> <span class="st">&quot;Customers(&#39;ALFKI&#39;)/SampleEntities.MostRecentOrder()&quot;</span></span>
<span id="cb112-8"><a href="#cb112-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">},</span></span>
<span id="cb112-9"><a href="#cb112-9" aria-hidden="true" tabindex="-1"></a>  <span class="er">‚Ä¶</span></span>
<span id="cb112-10"><a href="#cb112-10" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code></pre></div>
</div>
<p>An efficient format that assumes client knowledge of metadata may omit actions and functions from the payload whose target URL can be computed via metadata following standard conventions defined in <a href="#ODataURL">OData-URL</a>.</p>
<p>Services can advertise that a function or action is not available for a particular instance by setting its value to null.</p>
<div class="example">
<p>Example 93: the <code>SampleEntities.MostRecentOrder</code> function is not available for customer <code>ALFKI</code></p>
<div class="sourceCode" id="cb113"><pre class="sourceCode json"><code class="sourceCode json"><span id="cb113-1"><a href="#cb113-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb113-2"><a href="#cb113-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;@context&quot;</span><span class="fu">:</span> <span class="er">‚Ä¶</span><span class="fu">,</span></span>
<span id="cb113-3"><a href="#cb113-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;CustomerID&quot;</span><span class="fu">:</span> <span class="st">&quot;ALFKI&quot;</span><span class="fu">,</span></span>
<span id="cb113-4"><a href="#cb113-4" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;CompanyName&quot;</span><span class="fu">:</span> <span class="st">&quot;Alfreds Futterkiste&quot;</span><span class="fu">,</span></span>
<span id="cb113-5"><a href="#cb113-5" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;#SampleEntities.MostRecentOrder&quot;</span><span class="fu">:</span> <span class="kw">null</span><span class="fu">,</span></span>
<span id="cb113-6"><a href="#cb113-6" aria-hidden="true" tabindex="-1"></a>  <span class="er">‚Ä¶</span></span>
<span id="cb113-7"><a href="#cb113-7" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code></pre></div>
</div>
</details>
<details open><summary>
<h3 id="1154-functions"><a name="Functions" href="#Functions">11.5.4 Functions</a></h3>
</summary>
<p>Functions are operations exposed by an OData service that MUST return data and MUST have no observable side effects.</p>
<details open><summary>
<h4 id="11541-invoking-a-function"><a name="InvokingaFunction" href="#InvokingaFunction">11.5.4.1 Invoking a Function</a></h4>
</summary>
<p>To invoke a function bound to a resource, the client issues a <code>GET</code> request to a function URL. A function URL may be <a href="#AdvertisingAvailableOperationswithinaPayload">obtained</a> from a previously returned entity representation or constructed by appending the namespace- or alias-qualified function name to a URL that identifies a resource whose type is the same as, or derived from, the type of the binding parameter of the function. The value for the binding parameter is the value of the resource identified by the URL prior to appending the function name, and additional parameter values are specified using <a href="#InlineParameterSyntax">inline parameter syntax</a>. In parameters containing complex instances or transient entities, properties with a defined default value, nullable properties, and collection-valued properties that are omitted from the request are interpreted as the default value, null, or an empty collection, respectively.</p>
<p>If the function URL is <a href="#AdvertisingAvailableOperationswithinaPayload">obtained</a> from a previously returned entity representation, <a href="#ParameterAliases">parameter aliases</a> that are identical to the parameter name preceded by an at (<code>@</code>) sign MUST be used. Clients MUST check if the obtained URL already contains a query part and appropriately precede the parameters either with an ampersand (<code>&amp;</code>) or a question mark (<code>?</code>).</p>
<p>Services MAY additionally support invoking functions using the unqualified function name by defining one or more <a href="#DefaultNamespaces">default namespaces</a> through the <a href="https://github.com/oasis-tcs/odata-vocabularies/blob/main/vocabularies/Org.OData.Core.V1.md#DefaultNamespace"><code>Core.DefaultNamespace</code></a> term defined in <a href="#ODataVocCore">OData-VocCore</a>.</p>
<p>To request processing of the function only if the binding parameter value, an entity or collection of entities, is unmodified, the client includes the <a href="#HeaderIfMatch"><code>If-Match</code></a> header with the latest known ETag value for the entity or collection of entities. The ETag value for a collection as a whole is transported in the <code>ETag</code> header of a collection response.</p>
<p>Functions can be used within <a href="#SystemQueryOptionfilter"><code>$filter</code></a> or <a href="#SystemQueryOptionorderby"><code>$orderby</code></a> system query options. Such functions can be bound to a resource, as described above, or called directly by specifying the namespace- (or alias-) qualified function name. Parameter values for functions within <a href="#SystemQueryOptionfilter"><code>$filter</code></a> or <a href="#SystemQueryOptionorderby"><code>$orderby</code></a> are specified according to the <a href="#InlineParameterSyntax">inline parameter syntax</a>.</p>
<p>To invoke a function through a function import the client issues a <code>GET</code> request to a URL identifying the function import and passing parameter values using <a href="#InlineParameterSyntax">inline parameter syntax</a>. The canonical URL for a function import is the service root, followed by the name of the function import. Services MAY support omitting the parentheses when invoking a function import with no parameters, but for maximum interoperability MUST also support invoking the function import with empty parentheses.</p>
<p>If the function is composable, additional path segments may be appended to the URL that identifies the composable function (or function import) as appropriate for the type returned by the function (or function import). The last path segment determines the system query options and HTTP verbs that can be used with this this URL, e.g. if the last path segment is a multi-valued navigation property, a <code>POST</code> request may be used to create a new entity in the identified collection.</p>
<div class="example">
<p>Example 94: add a new item to the list of items of the shopping cart returned by the composable <code>MyShoppingCart</code> function import</p>
<pre><code>POST http://host/service/MyShoppingCart()/Items

‚Ä¶</code></pre>
</div>
<p>If the function returns a value of type <code>Edm.Stream</code> and no additional path segments follow the function invocation, the response to the <code>GET</code> request follows the rules for <a href="#RequestingStreamProperties">requesting stream properties</a>.</p>
<p>Parameter values passed to functions MUST be specified either as a URL literal (for primitive values) or as a JSON formatted OData object (for complex values, or collections of primitive or complex values). Entity typed values are passed as JSON formatted entities that MAY include a subset of the properties, or just the entity reference, as appropriate to the function.</p>
<p>If a collection-valued function has no result for a given parameter value combination, the response is the format-specific representation of an empty collection. If a single-valued function with a nullable return-type has no result, the service returns <a href="#ResponseCode204NoContent"><code>204 No Content</code></a>.</p>
<p>If a single-valued function with a non-nullable return type has no result, the service returns <code>4xx</code>. For functions that return a single entity <a href="#ResponseCode404NotFound"><code>404 Not Found</code></a> is the appropriate response code.</p>
<p>For a composable function the processing is stopped when the function result requires a <code>4xx</code> response, and continues otherwise.</p>
<p>Function imports preceded by the <code>$root</code> literal MAY be used in the <a href="#SystemQueryOptionfilter"><code>$filter</code></a> or <a href="#SystemQueryOptionorderby"><code>$orderby</code></a> system query options, see <a href="#ODataURL">OData-URL</a>.</p>
<details open><summary>
<h5 id="115411-inline-parameter-syntax"><a name="InlineParameterSyntax" href="#InlineParameterSyntax">11.5.4.1.1 Inline Parameter Syntax</a></h5>
</summary>
<p>Parameter values are specified inline by appending a comma-separated list of parameter values, enclosed by parenthesis to the function name.</p>
<p>Each parameter value is represented as a name/value pair in the format <code>Name=Value</code>, where <code>Name</code> is the name of the parameter to the function and <code>Value</code> is the parameter value.</p>
<div class="example">
<p>Example 95: invoke a <code>Sales.EmployeesByManager</code> function which takes a single <code>ManagerID</code> parameter via the function import <code>EmployeesByManager</code></p>
<pre><code>GET http://host/service/EmployeesByManager(ManagerID=3)</code></pre>
</div>
<div class="example">
<p>Example 96: return all Customers whose <code>City</code> property returns <code>Western</code> when passed to the <code>Sales.SalesRegion</code> function</p>
<pre><code>GET http://host/service/Customers?
      $filter=Sales.SalesRegion(City=$it/City) eq &#39;Western&#39;</code></pre>
</div>
<p>A <a href="#ParameterAliases">parameter alias</a> can be used in place of an inline parameter value. The value for the alias is specified as a separate query option using the name of the parameter alias.</p>
<div class="example">
<p>Example 97: invoke a <code>Sales.EmployeesByManager</code> function via the function import <code>EmployeesByManager</code>, passing 3 for the <code>ManagerID</code> parameter</p>
<pre><code>GET http://host/service/EmployeesByManager(ManagerID=@p1)?@p1=3</code></pre>
</div>
<p>Services MAY in addition allow implicit <a href="#ParameterAliases">parameter aliases</a> for function imports and for functions that are the last path segment of the URL. An implicit parameter alias is the parameter name, optionally preceded by an at (<code>@</code>) sign. When using implicit parameter aliases, parentheses MUST NOT be appended to the function (import) name. The value for each parameter MUST be specified as a separate query option with the name of the parameter alias. If a parameter name is identical to a system query option name (without the optional <code>$</code> prefix), the parameter name MUST be prefixed with an at (<code>@</code>) sign.</p>
<div class="example">
<p>Example 98: invoke a <code>Sales.EmployeesByManager</code> function via the function import <code>EmployeesByManager</code>, passing 3 for the <code>ManagerID</code> parameter using the implicit parameter alias</p>
<pre><code>GET http://host/service/EmployeesByManager?ManagerID=3</code></pre>
</div>
<p>Non-binding parameters annotated with the term <a href="https://github.com/oasis-tcs/odata-vocabularies/blob/main/vocabularies/Org.OData.Core.V1.md#OptionalParameter"><code>Core.OptionalParameter</code></a> defined in <a href="#ODataVocCore">OData-VocCore</a> MAY be omitted. If it is annotated and the annotation specifies a <code>DefaultValue</code>, the omitted parameter is interpreted as having that default value. If omitted and the annotation does not specify a default value, the service is free on how to interpret the omitted parameter.</p>
</details>
</details>
<details open><summary>
<h4 id="11542-function-overload-resolution"><a name="Functionoverloadresolution" href="#Functionoverloadresolution">11.5.4.2 Function overload resolution</a></h4>
</summary>
<p>The same function name may be used multiple times within a schema, each with a different set of parameters. For unbound overloads the combination of the function name and the unordered set of parameter names MUST identify a particular function overload. For bound overloads the combination of the function name, the binding parameter type, and the unordered set of names of the non-binding parameters MUST identify a particular function overload.</p>
<p>All unbound overloads MUST have the same return type. Also, all bound overloads with a given binding parameter type MUST have the same return type.</p>
<p>If the function is bound and the binding parameter type is part of an inheritance hierarchy, the function overload is selected based on the type of the URL segment preceding the function name. A type-cast segment can be used to select a function defined on a particular type in the hierarchy, see <a href="#ODataURL">OData-URL</a>.</p>
<p>Non-binding parameters MAY be marked as optional by annotating them with the term <a href="https://github.com/oasis-tcs/odata-vocabularies/blob/main/vocabularies/Org.OData.Core.V1.md#OptionalParameter"><code>Core.OptionalParameter</code></a> defined in <a href="#ODataVocCore">OData-VocCore</a>. All parameters marked as optional MUST come after any parameters not marked as optional.</p>
<p>A function overload is selected if</p>
<ul>
<li>The set of specified parameters exactly matches a function overload, or else</li>
<li>The set of specified parameters matches a subset of parameters that includes all non-optional parameters of exactly one function overload.</li>
</ul>
<p>Services SHOULD avoid ambiguity, i.e. the combination of the function name, the unordered set of <em>non-optional</em> non-binding parameter names, plus the binding parameter type for bound overloads SHOULD identify a particular function overload. If there is ambiguity, then services MAY return <code>400 Bad Request</code> with an error response body stating that the request was ambiguous.</p>
</details>
</details>
<details open><summary>
<h3 id="1155-actions"><a name="Actions" href="#Actions">11.5.5 Actions</a></h3>
</summary>
<p>Actions are operations exposed by an OData service that MAY have side effects when invoked. Actions MAY return data but MUST NOT be further composed with additional path segments.</p>
<details open><summary>
<h4 id="11551-invoking-an-action"><a name="InvokinganAction" href="#InvokinganAction">11.5.5.1 Invoking an Action</a></h4>
</summary>
<p>To invoke an action bound to a resource, the client issues a <code>POST</code> request to an action URL. An action URL may be <a href="#AdvertisingAvailableOperationswithinaPayload">obtained</a> from a previously returned entity representation or constructed by appending the namespace- or alias-qualified action name to a URL that identifies a resource whose type is the same as, or derives from, the type of the binding parameter of the action. The value for the binding parameter is the resource identified by the URL preceding the action name, and only the non-binding parameter values are passed in the request body according to the particular format. In parameters containing complex instances or transient entities, properties with a defined default value, nullable properties, and collection-valued properties that are omitted from the request are interpreted as the default value, null, or an empty collection, respectively.</p>
<p>Services MAY additionally support invoking actions using the unqualified action name by defining one or more <a href="#DefaultNamespaces">default namespaces</a> through the <a href="https://github.com/oasis-tcs/odata-vocabularies/blob/main/vocabularies/Org.OData.Core.V1.md#DefaultNamespace"><code>Core.DefaultNamespace</code></a> term defined in <a href="#ODataVocCore">OData-VocCore</a>.</p>
<p>To invoke an action through an action import, the client issues a <code>POST</code> request to a URL identifying the action import. The canonical URL for an action import is the service root, followed by the name of the action import. When invoking an action through an action import all parameter values MUST be passed in the request body according to the particular format.</p>
<p>Non-binding parameters that are nullable or annotated with the term <a href="https://github.com/oasis-tcs/odata-vocabularies/blob/main/vocabularies/Org.OData.Core.V1.md#OptionalParameter"><code>Core.OptionalParameter</code></a> defined in <a href="#ODataVocCore">OData-VocCore</a> MAY be omitted from the request body. If an omitted parameter is not annotated (and thus nullable), it MUST be interpreted as having the <code>null</code> value. If it is annotated and the annotation specifies a <code>DefaultValue</code>, the omitted parameter is interpreted as having that default value. If omitted and the annotation does not specify a default value, the service is free on how to interpret the omitted parameter. Note: a nullable non-binding parameter is equivalent to being annotated as optional with a default value of <code>null</code>.</p>
<p>4.01 services MUST support invoking actions with no non-binding parameters and parameterless action imports both without a request body and with a request body representing no parameters, according to the particular format. Interoperable clients SHOULD always include a request body, even when invoking actions with no non-binding parameters and parameterless action imports.</p>
<p>If the action returns results, the client SHOULD use content type negotiation to request the results in the desired format, otherwise the default content type will be used.</p>
<p>The client can request whether any results from the action be returned using the <a href="#Preferencereturnrepresentationandreturnminimal"><code>return</code></a> preference.</p>
<p>Actions that create and return a single entity follow the rules for <a href="#CreateanEntity">entity creation</a> and return a <a href="#HeaderLocation"><code>Location</code></a> header that contains the edit URL or read URL of the created entity. They MAY be annotated with the term <a href="https://github.com/oasis-tcs/odata-vocabularies/blob/main/vocabularies/Org.OData.Core.V1.md#Constructor"><code>Core.Constructor</code></a> defined in <a href="#ODataVocCore">OData-VocCore</a>.</p>
<p>If the action returns a value of type <code>Edm.Stream</code>, the response to the <code>POST</code> request follows the rules for <a href="#RequestingStreamProperties">requesting stream properties</a>.</p>
<p>Actions without a return type respond with <a href="#ResponseCode204NoContent"><code>204 No Content</code></a> on success.</p>
<p>To request processing of the action only if the binding parameter value, an entity or collection of entities, is unmodified, the client includes the <a href="#HeaderIfMatch"><code>If-Match</code></a> header with the latest known ETag value for the entity or collection of entities. The ETag value for a collection as a whole is transported in the <a href="#HeaderETag"><code>ETag</code></a> header of a collection response.</p>
<div class="example">
<p>Example 99: invoke the <code>SampleEntities.CreateOrder</code> action using <code>Customers('ALFKI')</code> as the customer (or binding parameter). The values <code>2</code> for the <code>quantity</code> parameter and <code>BLACKFRIDAY</code> for the <code>discountCode</code> parameter are passed in the body of the request. Invoke the action only if the customer‚Äôs ETag still matches.</p>
<div class="sourceCode" id="cb119"><pre class="sourceCode json"><code class="sourceCode json"><span id="cb119-1"><a href="#cb119-1" aria-hidden="true" tabindex="-1"></a><span class="er">POST</span> <span class="er">http://host/service/Customers(&#39;ALFKI&#39;)/SampleEntities.CreateOrder</span></span>
<span id="cb119-2"><a href="#cb119-2" aria-hidden="true" tabindex="-1"></a><span class="er">If-Match:</span> <span class="er">W/&quot;MjAxOS0wMy0yMVQxMzowNVo=&quot;</span></span>
<span id="cb119-3"><a href="#cb119-3" aria-hidden="true" tabindex="-1"></a><span class="er">Content-Type:</span> <span class="er">application/json</span></span>
<span id="cb119-4"><a href="#cb119-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-5"><a href="#cb119-5" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb119-6"><a href="#cb119-6" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;items&quot;</span><span class="fu">:</span> <span class="ot">[</span></span>
<span id="cb119-7"><a href="#cb119-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">{</span> <span class="dt">&quot;product&quot;</span><span class="fu">:</span> <span class="dv">4001</span><span class="fu">,</span> <span class="dt">&quot;quantity&quot;</span><span class="fu">:</span> <span class="dv">2</span> <span class="fu">}</span><span class="ot">,</span></span>
<span id="cb119-8"><a href="#cb119-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">{</span> <span class="dt">&quot;product&quot;</span><span class="fu">:</span> <span class="dv">7062</span><span class="fu">,</span> <span class="dt">&quot;quantity&quot;</span><span class="fu">:</span> <span class="dv">1</span> <span class="fu">}</span><span class="ot">,</span></span>
<span id="cb119-9"><a href="#cb119-9" aria-hidden="true" tabindex="-1"></a>  <span class="ot">]</span><span class="fu">,</span></span>
<span id="cb119-10"><a href="#cb119-10" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;discountCode&quot;</span><span class="fu">:</span> <span class="st">&quot;BLACKFRIDAY&quot;</span></span>
<span id="cb119-11"><a href="#cb119-11" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code></pre></div>
</div>
</details>
<details open><summary>
<h4 id="11552-action-overload-resolution"><a name="ActionOverloadResolution" href="#ActionOverloadResolution">11.5.5.2 Action Overload Resolution</a></h4>
</summary>
<p>The same action name may be used multiple times within a schema provided there is at most one unbound overload, and each bound overload specifies a different binding parameter type.</p>
<p>If the action is bound and the binding parameter type is part of an inheritance hierarchy, the action overload is selected based on the type of the URL segment preceding the action name. A type-cast segment can be used to select an action defined on a particular type in the hierarchy, see <a href="#ODataURL">OData-URL</a>.</p>
</details>
</details>
</details>
<details open><summary>
<h2 id="116-asynchronous-requests"><a name="AsynchronousRequests" href="#AsynchronousRequests">11.6 Asynchronous Requests</a></h2>
</summary>
<p>A <a href="#HeaderPrefer"><code>Prefer</code></a> header with a <a href="#Preferencerespondasync"><code>respond-async</code></a> preference allows clients to request that the service process a <a href="#DataServiceRequests">Data Service Request</a> asynchronously.</p>
<p>If the client has specified<code> respond-async</code> in the request, the service MAY process the request asynchronously and return a <a href="#ResponseCode202Accepted"><code>202 Accepted</code></a> response. A service MUST NOT reply to a <a href="#DataServiceRequests">Data Service Request</a> with <code>202 Accepted</code> if the request has not included the <code>respond-async</code> preference.</p>
<p>Responses that return <code>202 Accepted</code> MUST include a <a href="#HeaderLocation"><code>Location</code></a> header pointing to a <em>status monitor resource</em> that represents the current state of the asynchronous processing in addition to an optional <a href="#HeaderRetryAfter"><code>Retry-After</code></a> header indicating the time, in seconds, the client should wait before querying the service for status. Services MAY include a response body, for example, to provide additional status information.</p>
<p>A <code>GET</code> request to the status monitor resource again returns <code>202 Accepted</code> response if the asynchronous processing has not finished. This response MUST again include a <a href="#HeaderLocation"><code>Location</code></a> header and MAY include a <a href="#HeaderRetryAfter"><code>Retry-After</code></a> header to be used for a subsequent request. The <code>Location</code> header and optional <code>Retry-After</code> header may or may not contain the same values as returned by the previous request.</p>
<p>A <code>GET</code> request to the status monitor resource returns <a href="#ResponseCode200OK"><code>200 OK</code></a> once the asynchronous processing has completed. For OData 4.01 or greater responses, or OData 4.0 requests that include an <code>Accept</code> header that does not specify <code>application/http</code>, the response MUST include the <a href="#HeaderAsyncResult"><code>AsyncResult</code></a> response header. Any other headers, along with the response body, represent the result of the completed asynchronous operation. If the <code>GET</code> request to the status monitor includes an <code>OData-MaxVersion</code> header with a value of <code>4.0</code> and no <code>Accept</code> header, or an <code>Accept</code> header that includes <code>application/http</code>, then the body of the final <code>200 OK</code> response MUST be represented as an HTTP message, as described in <a href="#rfc9110">RFC9110</a>, which is the full HTTP response to the completed asynchronous operation.</p>
<p>A <code>DELETE</code> request sent to the status monitor resource requests that the asynchronous processing be canceled. A <code>200 OK</code> or a <a href="#ResponseCode204NoContent"><code>204 No Content</code></a> response indicates that the asynchronous processing has been successfully canceled. A client can request that the <code>DELETE</code> should be executed asynchronously. A <code>202 Accepted</code> response indicates that the cancellation is being processed asynchronously; the client can use the returned <a href="#HeaderLocation"><code>Location</code></a> header (which MUST be different from the status monitor resource of the initial request) to query for the status of the cancellation. If a delete request is not supported by the service, the service returns <a href="#ResponseCode405MethodNotAllowed"><code>405 Method Not Allowed</code></a>.</p>
<p>After a successful <code>DELETE</code> request against the status monitor resource, any subsequent <code>GET</code> requests for the same status monitor resource returns <a href="#ResponseCode404NotFound"><code>404 Not Found</code></a>.</p>
<p>If an asynchronous request is cancelled for reasons other than the consumers issuing a <code>DELETE</code> request against the status monitor resource, a <code>GET</code> request to the status monitor resource returns <code>200 OK</code> with a response body containing a single HTTP response with a status code in the <a href="#ServerErrorResponses"><code>5xx Server Error</code></a> range indicating that the operation was cancelled.</p>
<p>The service MUST ensure that no observable change has occurred as a result of a canceled request.</p>
<p>If the client waits too long to request the result of the asynchronous processing, the service responds with a <a href="#ResponseCode410Gone"><code>410 Gone</code></a> or <a href="#ResponseCode404NotFound"><code>404 Not Found</code></a>.</p>
<p>The status monitor resource URL MUST differ from any other resource URL.</p>
</details>
<details open><summary>
<h2 id="117-batch-requests"><a name="BatchRequests" href="#BatchRequests">11.7 Batch Requests</a></h2>
</summary>
<p>Batch requests allow grouping multiple individual requests into a single HTTP request payload. An individual request in the context of a batch request is a <a href="#MetadataRequests">Metadata Request</a>, <a href="#RequestingData">Data Request</a>, <a href="#DataModification">Data Modification Request</a>, <a href="#InvokinganAction">Action invocation</a> request, or <a href="#InvokingaFunction">Function invocation</a> request.</p>
<p>Batch requests are submitted as a single HTTP <code>POST</code> request to the batch endpoint of a service, located at the URL <code>$batch</code> relative to the service root.</p>
<p>Individual requests within a batch request are evaluated according to the same semantics used when the request appears outside the context of a batch request.</p>
<p>A batch request is represented using either the <a href="#MultipartBatchFormat">multipart batch format</a> defined in this document or the JSON batch format defined in <a href="#ODataJSON">OData-JSON</a>.</p>
<p>If the set of request headers of a batch request are valid the service MUST return a <a href="#ResponseCode200OK"><code>200 OK</code></a> HTTP response code to indicate that the batch request was accepted for processing, even if the processing is yet to be completed. The individual requests within the body of the batch request may be processed as soon as they are received, this enables clients to stream batch requests, and batch implementations to stream the results.</p>
<p>If the service receives a batch request with an invalid set of headers it MUST return a <a href="#ClientErrorResponses"><code>4xx</code> response code</a> and perform no further processing of the batch request.</p>
<details open><summary>
<h3 id="1171-batch-request-headers"><a name="BatchRequestHeaders" href="#BatchRequestHeaders">11.7.1 Batch Request Headers</a></h3>
</summary>
<p>A batch request using the <a href="#MultipartBatchFormat">multipart batch format</a> MUST contain a <a href="#HeaderContentType"><code>Content-Type</code></a> header specifying a content type of <code>multipart/mixed</code> and a <code>boundary</code> parameter as defined in <a href="#rfc2046">RFC2046</a>.</p>
<div class="example">
<p>Example 100: multipart batch request</p>
<pre><code>POST /service/$batch HTTP/1.1
Host: odata.org
OData-Version: 4.0
Content-Type: multipart/mixed; boundary=batch_36522ad7-fc75-4b56-8c71-56071383e77b

&lt;Multipart Batch request body&gt;</code></pre>
</div>
<p>A batch request using the JSON batch format MUST contain a <code>Content-Type</code> header specifying a content type of <code>application/json</code>.</p>
<div class="example">
<p>Example 101: JSON batch request</p>
<pre><code>POST /service/$batch HTTP/1.1
Host: odata.org
OData-Version: 4.01
Content-Type: application/json

&lt;JSON Batch request body&gt;</code></pre>
</div>
<p>Batch requests SHOULD contain the applicable <code>OData-Version</code> header.</p>
<p>Batch requests SHOULD contain an <a href="#HeaderAccept"><code>Accept</code></a> header specifying the desired batch response format, either <code>multipart/mixed</code> or <code>application/json</code>. If no <code>Accept</code> header is provided, services SHOULD respond with the content type of the request.</p>
</details>
<details open><summary>
<h3 id="1172-request-dependencies"><a name="RequestDependencies" href="#RequestDependencies">11.7.2 Request Dependencies</a></h3>
</summary>
<p>Requests within a batch may have dependencies on other requests according to the particular batch format.</p>
<p>In the JSON format, requests may explicitly declare a dependency on other requests that must be successfully processed before the current request. In addition, requests may be specified as part of an <em>atomicity group</em> whose members MUST either all succeed, or all fail. If a request fails, then any dependent requests within the JSON format return <a href="#ResponseCode424FailedDependency"><code>424 Failed Dependency</code></a>.</p>
<p>In the Multipart format, <a href="#DataModification">data modification</a> requests or <a href="#InvokinganAction">action invocation</a> requests may be grouped as part of an atomic change set. Operations outside the change set are executed sequentially, while operations within the change set may be executed in any order.</p>
</details>
<details open><summary>
<h3 id="1173-identifying-individual-requests"><a name="IdentifyingIndividualRequests" href="#IdentifyingIndividualRequests">11.7.3 Identifying Individual Requests</a></h3>
</summary>
<p>Each individual request within a batch request MAY have a request identifier assigned. The request identifier is case-sensitive, MUST be unique within the batch request, and MUST satisfy the rule <code>request-id</code> in <a href="#ODataABNF">OData-ABNF</a>.</p>
<p>The representation of the request identifier is format-specific, as are the rules for which individual requests require an identifier.</p>
</details>
<details open><summary>
<h3 id="1174-referencing-returned-entities"><a name="ReferencingReturnedEntities" href="#ReferencingReturnedEntities">11.7.4 Referencing Returned Entities</a></h3>
</summary>
<p>Entities created by an <a href="#CreateanEntity">insert</a> request or an <a href="#InvokinganAction">action</a> can be referenced in the request URL of subsequent requests by using the request identifier prefixed with a <code>$</code> character as the first segment of the request URL. Services MUST treat this segment like the URL in the <a href="#HeaderLocation"><code>Location</code></a> header of the response to the request identified by the segment. If the <code>Location</code> header in the response to the subsequent request contains a relative URL, clients MUST be able to resolve it relative to the request‚Äôs URL even if that contains such a reference. See <a href="#batchcontentid">example 106</a>.</p>
<p>If the <code>$</code>-prefixed request identifier is identical to the name of a top-level system resource (<code>$batch</code>, <code>$crossjoin</code>, <code>$all</code>, <code>$entity</code>, <code>$root</code>, <code>$id</code>, <code>$metadata</code>, or other system resources defined according to the <a href="#HeaderODataVersion"><code>OData-Version</code></a> of the protocol specified in the request), then the reference to the top-level system resource is used. This collision can be avoided by e.g. using only numeric request identifiers.</p>
<p>Services MAY also support referencing within request bodies, in which case they SHOULD advertise this support by specifying the <code>ReferencesInRequestBodiesSupported</code> property in the <a href="https://github.com/oasis-tcs/odata-vocabularies/blob/main/vocabularies/Org.OData.Capabilities.V1.md#BatchSupport"><code>Capabilities.BatchSupport</code></a> term applied to the entity container, see <a href="#ODataVocCap">OData-VocCap</a>.</p>
</details>
<details open><summary>
<h3 id="1175-referencing-the-etag-of-an-entity"><a name="ReferencingtheETagofanEntity" href="#ReferencingtheETagofanEntity">11.7.5 Referencing the ETag of an Entity</a></h3>
</summary>
<p>Services MAY support the use of an ETag returned from a previous operation in an <a href="#HeaderIfMatch"><code>If-Match</code></a> or <a href="#HeaderIfNoneMatch"><code>If-None-Match</code></a> header of a subsequent statement. Services SHOULD advertise this support by specifying the <code>EtagReferencesSupported</code> property in the <a href="https://github.com/oasis-tcs/odata-vocabularies/blob/main/vocabularies/Org.OData.Capabilities.V1.md#BatchSupport"><code>Capabilities.BatchSupport</code></a> annotation term applied to the entity container, see <a href="#ODataVocCap">OData-VocCap</a>.</p>
<p>The ETag for a previous operation can be referenced by using the request identifier prefixed with a <code>$</code> character as the unquoted value of the <code>If-Match</code> or <code>If-None-Match</code> header.</p>
</details>
<details open><summary>
<h3 id="1176-referencing-values-from-response-bodies"><a name="ReferencingValuesfromResponseBodies" href="#ReferencingValuesfromResponseBodies">11.7.6 Referencing Values from Response Bodies</a></h3>
</summary>
<p>Services MAY support using values from a response body in the query part of the URL or in the request body of subsequent requests. A value reference can consist of a <code>$</code> character followed by the identifier of the preceding request, then the referenced value is the value represented by the response body of that preceding request. Alternatively, a value reference can consist of a <code>$</code> character followed by the value of an instance annotation with term <a href="https://github.com/oasis-tcs/odata-vocabularies/blob/main/vocabularies/Org.OData.Core.V1.md#ContentID"><code>Core.ContentID</code></a> (see <a href="#ODataVocCore">OData-VocCore</a>) that occurs in the payload of the preceding request as described in <a href="#CreateRelatedEntitiesWhenCreatinganEntity">section 11.4.2.2</a> and <a href="#UpdateRelatedEntitiesWhenUpdatinganEntity">section 11.4.3.1</a>, then the referenced value is the corresponding value in the response, which the service SHOULD annotate with the same <code>Core.ContentID</code> value.</p>
<p>In both cases, if the referenced value is a collection, the value reference MAY be followed by a <code>collectionNavigationExpr</code>, as defined in <a href="#ODataABNF">OData-ABNF</a>, that is evaluated relative to the referenced value. Otherwise the value reference MAY be followed by a forward slash and a <code>memberExpr</code> that is evaluated relative to the referenced value.</p>
<p>If the <code>$</code>-prefixed identifier is identical to the name of a predefined literal for query expressions (<code>$it</code>, <code>$root</code>, or other literals defined according to the <a href="#HeaderODataVersion"><code>OData-Version</code></a> of the protocol specified in the request), then the predefined literal is used. This collision can be avoided by e.g. using only numeric identifiers.</p>
</details>
<details open><summary>
<h3 id="1177-multipart-batch-format"><a name="MultipartBatchFormat" href="#MultipartBatchFormat">11.7.7 Multipart Batch Format</a></h3>
</summary>
<p>The multipart batch format is represented as a Multipart Media Type message <a href="#rfc2046">RFC2046</a>, a standard format allowing the representation of multiple parts, each of which may have a different content type.</p>
<details open><summary>
<h4 id="11771-multipart-batch-request-body"><a name="MultipartBatchRequestBody" href="#MultipartBatchRequestBody">11.7.7.1 Multipart Batch Request Body</a></h4>
</summary>
<p>The body of a multipart batch request is made up of a series of individual requests and <em>change sets</em>, each represented as a distinct body part (i.e. preceded by a boundary delimiter line consisting of two dashes and the value of the <code>boundary</code> parameter specified in the <code>Content-Type</code> header, and the last body part followed by a closing boundary delimiter line consisting of two dashes, the boundary, and another two dashes).</p>
<p>A body part representing an individual request MUST include a <code>Content-Type</code> header with value <code>application/http</code>.</p>
<p>The contents of a body part representing a change set MUST itself be a multipart document (see <a href="#rfc2046">RFC2046</a>) with one body part for each operation in the change set. Each body part representing an operation in the change set MUST specify a <code>Content-ID</code> header with a <a href="#IdentifyingIndividualRequests">request identifier</a> that is unique within the batch request.</p>
<p>A <code>Content-Transfer-Encoding</code> header with value <code>binary</code> may be included for historic reasons although this header is not used by HTTP and only needed for transmission via E-Mail. Neither clients nor services should rely on this header being present.</p>
<p>Preambles and epilogues in the multipart batch request body, as defined in <a href="#rfc2046">RFC2046</a>, are valid but are assigned no meaning and thus MUST be ignored by processors of multipart batch requests.</p>
<p>The request URL of individual requests within a batch request or change set can use one of the following three formats:</p>
<ul>
<li>Absolute URI with schema, host, port, and absolute resource path.</li>
</ul>
<div class="example">
<p>Example 102:</p>
<pre><code>GET https://host:1234/path/service/People(1) HTTP/1.1</code></pre>
</div>
<ul>
<li>Absolute resource path and separate <code>Host</code> header</li>
</ul>
<div class="example">
<p>Example <a name="batchhost" href="#batchhost">103</a>:</p>
<div class="sourceCode" id="cb123"><pre class="sourceCode json"><code class="sourceCode json"><span id="cb123-1"><a href="#cb123-1" aria-hidden="true" tabindex="-1"></a><span class="er">PATCH</span> <span class="er">/path/service/People(1)¬†HTTP/1.1</span></span>
<span id="cb123-2"><a href="#cb123-2" aria-hidden="true" tabindex="-1"></a><span class="er">Host:</span> <span class="er">myserver.mydomain.org:1234</span></span>
<span id="cb123-3"><a href="#cb123-3" aria-hidden="true" tabindex="-1"></a><span class="er">Content-Type:</span> <span class="er">application/json</span></span>
<span id="cb123-4"><a href="#cb123-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb123-5"><a href="#cb123-5" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span> <span class="dt">&quot;Name&quot;</span><span class="fu">:</span> <span class="st">&quot;Peter&quot;</span> <span class="fu">}</span></span></code></pre></div>
</div>
<ul>
<li>Resource path relative to the batch request URI.</li>
</ul>
<div class="example">
<p>Example 104:</p>
<pre><code>DELETE People(1)¬†HTTP/1.1</code></pre>
</div>
<p>Services MUST support all three formats for URLs of individual requests.</p>
<p>URLs must be correctly percent-encoded. For relative URLs this means that colons in the path part, especially within key values, MUST be percent-encoded to avoid confusion with the scheme separator. Colons within the query part, i.e. after the question mark character (<code>?</code>), need not be percent-encoded.</p>
<p>Each body part that represents a single request MUST NOT include:</p>
<ul>
<li><code>authentication</code> or <code>authorization</code> related HTTP headers</li>
<li><code>Expect</code>, <code>From</code>, <code>Max-Forwards</code>, <code>Range</code>, or <code>TE</code> headers</li>
</ul>
<p>Processors of batch requests MAY choose to disallow additional HTTP constructs in HTTP requests serialized within body parts. For example, a processor may choose to disallow chunked encoding to be used by such HTTP requests.</p>
<div class="example">
<p>Example <a name="batchRequest" href="#batchRequest">105</a>: a batch request that contains the following individual requests in the order listed</p>
<ol type="1">
<li>A query request</li>
<li>A change set that contains the following requests:
<ul>
<li>Insert entity (with <code>Content-ID = 1</code>)</li>
<li>Update entity (with <code>Content-ID = 2</code>)</li>
</ul></li>
<li>A second query request</li>
</ol>
<p>Note: For brevity, in the example, request bodies are excluded in favor of English descriptions inside <code>&lt;&gt;</code> brackets and <code>OData-Version</code> headers are omitted.</p>
<p>Note also that the two empty lines after the <code>Host</code> header of the <code>GET</code> request are necessary: the first is part of the <code>GET</code> request header; the second is the empty body of the <code>GET</code> request, followed by a <code>CRLF</code> according to <a href="#rfc2046">RFC2046</a>.</p>
<pre><code>POST /service/$batch HTTP/1.1
Host: host
OData-Version: 4.0
Content-Type: multipart/mixed; boundary=batch_36522ad7-fc75-4b56-8c71-56071383e77b
Content-Length: ###

--batch_36522ad7-fc75-4b56-8c71-56071383e77b
Content-Type: application/http

GET /service/Customers(&#39;ALFKI&#39;)
Host: host


--batch_36522ad7-fc75-4b56-8c71-56071383e77b
Content-Type: multipart/mixed; boundary=changeset_77162fcd-b8da-41ac-a9f8-9357efbbd

--changeset_77162fcd-b8da-41ac-a9f8-9357efbbd
Content-Type: application/http
Content-ID: 1

POST /service/Customers HTTP/1.1
Host: host
Content-Type: application/json
Content-Length: ###

&lt;JSON representation of a new Customer&gt;
--changeset_77162fcd-b8da-41ac-a9f8-9357efbbd
Content-Type: application/http
Content-ID: 2

PATCH /service/Customers(&#39;ALFKI&#39;) HTTP/1.1
Host: host
Content-Type: application/json
If-Match: xxxxx
Prefer: return=minimal
Content-Length: ###

&lt;JSON representation of changes to Customer ALFKI&gt;
--changeset_77162fcd-b8da-41ac-a9f8-9357efbbd--
--batch_36522ad7-fc75-4b56-8c71-56071383e77b
Content-Type: application/http

GET /service/Products HTTP/1.1
Host: host


--batch_36522ad7-fc75-4b56-8c71-56071383e77b--</code></pre>
</div>
</details>
<details open><summary>
<h4 id="11772-referencing-new-entities"><a name="ReferencingNewEntities" href="#ReferencingNewEntities">11.7.7.2 Referencing New Entities</a></h4>
</summary>
<p>Entities created by an <a href="#CreateanEntity">insert</a> request or an <a href="#InvokinganAction">action</a> can be referenced in the request URL of subsequent requests within the same change set. Services MAY also support referencing across change sets, in which case they SHOULD advertise this support by specifying the <code>ReferencesAcrossChangeSetsSupported</code> property in the <a href="https://github.com/oasis-tcs/odata-vocabularies/blob/main/vocabularies/Org.OData.Capabilities.V1.md#BatchSupport"><code>Capabilities.BatchSupport</code></a> term applied to the entity container, see <a href="#ODataVocCap">OData-VocCap</a>.</p>
<div class="example">
<p>Example <a name="batchcontentid" href="#batchcontentid">106</a>: a batch request that contains the following operations in the order listed:</p>
<p>A change set that contains the following requests:</p>
<ul>
<li>Insert a new entity (with <code>Content-ID = 1</code>)</li>
<li>Insert a second new entity (references request with <code>Content-ID = 1</code>)</li>
</ul>
<pre><code>POST /service/$batch HTTP/1.1
Host: host
OData-Version: 4.0
Content-Type: multipart/mixed; boundary=batch_36522ad7-fc75-4b56-8c71-56071383e77b
Content-Length: ###

--batch_36522ad7-fc75-4b56-8c71-56071383e77b
Content-Type: multipart/mixed; boundary=changeset_77162fcd-b8da-41ac-a9f8-9357efbbd

--changeset_77162fcd-b8da-41ac-a9f8-9357efbbd
Content-Type: application/http
Content-ID: 1

POST /service/Customers HTTP/1.1
Host: host
Content-Type: application/json
Content-Length: ###

&lt;JSON representation of a new Customer entity&gt;
--changeset_77162fcd-b8da-41ac-a9f8-9357efbbd
Content-Type: application/http
Content-ID: 2

POST $1/Orders HTTP/1.1
Host: host
Content-Type: application/json
Content-Length: ###

&lt;JSON representation of a new Order&gt;
--changeset_77162fcd-b8da-41ac-a9f8-9357efbbd--
--batch_36522ad7-fc75-4b56-8c71-56071383e77b--</code></pre>
<p>The response contains relative <code>Location</code> headers.</p>
<pre><code>HTTP/1.1 200 OK
OData-Version: 4.0
Content-Length: ####
Content-Type: multipart/mixed; boundary=batch_36522ad7-fc75-4b56-8c71-56071383e77a

--batch_36522ad7-fc75-4b56-8c71-56071383e77a
Content-Type: multipart/mixed; boundary=changeset_77162fcd-b8da-41ac-a9f8-9357efbbe

--changeset_77162fcd-b8da-41ac-a9f8-9357efbbe
Content-Type: application/http

HTTP/1.1 201 OK
Location: Customers(&#39;ALFKI&#39;)
‚Ä¶
--changeset_77162fcd-b8da-41ac-a9f8-9357efbbe
Content-Type: application/http

HTTP/1.1 201 OK
Location: Orders(1)
‚Ä¶
--changeset_77162fcd-b8da-41ac-a9f8-9357efbbe--
--batch_36522ad7-fc75-4b56-8c71-56071383e77a--</code></pre>
<p>The second <code>Location</code> URL <code>Orders(1)</code> is relative with its base URI being the second request URL <code>$1/Orders</code>. To get an absolute base URI, the client must replace the <code>$1</code> with the first <code>Location</code> URL <code>Customers('ALFKI')</code> and resolve the resulting URL <code>Customers('ALFKI')/Orders(1)</code> relative to its base URI, which is <code>http://host/service/Customers</code> (determined from the first request URL <code>/service/Customers</code> and the <code>Host: host</code> header as in <a href="#batchhost">example 103</a>). This gives the effective second request URL <code>http://host/service/Customers('ALFKI')/Orders</code> as base URI for the second <code>Location</code> URL, which therefore resolves to <code>http://host/service/Customers('ALFKI')/Orders(1)</code>.</p>
</div>
</details>
<details open><summary>
<h4 id="11773-referencing-an-etag"><a name="ReferencinganETag" href="#ReferencinganETag">11.7.7.3 Referencing an ETag</a></h4>
</summary>
<div class="example">
<p>Example 107: a batch request that contains the following operations in the order listed:</p>
<ul>
<li>Get an employee (with <code>Content-ID = 1</code>)</li>
<li>Update the salary only if the employee has not changed</li>
</ul>
<div class="sourceCode" id="cb128"><pre class="sourceCode json"><code class="sourceCode json"><span id="cb128-1"><a href="#cb128-1" aria-hidden="true" tabindex="-1"></a><span class="er">POST</span> <span class="er">/service/$batch</span> <span class="er">HTTP/1.1</span></span>
<span id="cb128-2"><a href="#cb128-2" aria-hidden="true" tabindex="-1"></a><span class="er">Host:</span> <span class="er">host</span></span>
<span id="cb128-3"><a href="#cb128-3" aria-hidden="true" tabindex="-1"></a><span class="er">OData-Version:</span> <span class="er">4.0</span></span>
<span id="cb128-4"><a href="#cb128-4" aria-hidden="true" tabindex="-1"></a><span class="er">Content-Type:</span> <span class="er">multipart/mixed;</span> <span class="er">boundary=batch_36522ad7-fc75-4b56-8c71-56071383e77b</span></span>
<span id="cb128-5"><a href="#cb128-5" aria-hidden="true" tabindex="-1"></a><span class="er">Content-Length:</span> <span class="er">###</span></span>
<span id="cb128-6"><a href="#cb128-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-7"><a href="#cb128-7" aria-hidden="true" tabindex="-1"></a><span class="er">--batch_36522ad7-fc75-4b56-8c71-56071383e77b</span></span>
<span id="cb128-8"><a href="#cb128-8" aria-hidden="true" tabindex="-1"></a><span class="er">Content-Type:</span> <span class="er">application/http</span></span>
<span id="cb128-9"><a href="#cb128-9" aria-hidden="true" tabindex="-1"></a><span class="er">Content-ID:</span> <span class="er">1</span></span>
<span id="cb128-10"><a href="#cb128-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-11"><a href="#cb128-11" aria-hidden="true" tabindex="-1"></a><span class="er">GET</span> <span class="er">/service/Employees(0)</span> <span class="er">HTTP/1.1</span></span>
<span id="cb128-12"><a href="#cb128-12" aria-hidden="true" tabindex="-1"></a><span class="er">Host:</span> <span class="er">host</span></span>
<span id="cb128-13"><a href="#cb128-13" aria-hidden="true" tabindex="-1"></a><span class="er">Accept:</span> <span class="er">application/json</span></span>
<span id="cb128-14"><a href="#cb128-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-15"><a href="#cb128-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-16"><a href="#cb128-16" aria-hidden="true" tabindex="-1"></a><span class="er">--batch_36522ad7-fc75-4b56-8c71-56071383e77b</span></span>
<span id="cb128-17"><a href="#cb128-17" aria-hidden="true" tabindex="-1"></a><span class="er">Content-Type:</span> <span class="er">application/http</span></span>
<span id="cb128-18"><a href="#cb128-18" aria-hidden="true" tabindex="-1"></a><span class="er">Content-ID:</span> <span class="er">2</span></span>
<span id="cb128-19"><a href="#cb128-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-20"><a href="#cb128-20" aria-hidden="true" tabindex="-1"></a><span class="er">PATCH</span> <span class="er">/service/Employees(0)</span> <span class="er">HTTP/1.1</span></span>
<span id="cb128-21"><a href="#cb128-21" aria-hidden="true" tabindex="-1"></a><span class="er">Host:</span> <span class="er">host</span></span>
<span id="cb128-22"><a href="#cb128-22" aria-hidden="true" tabindex="-1"></a><span class="er">Content-Type:</span> <span class="er">application/json</span></span>
<span id="cb128-23"><a href="#cb128-23" aria-hidden="true" tabindex="-1"></a><span class="er">Content-Length:</span> <span class="er">###</span></span>
<span id="cb128-24"><a href="#cb128-24" aria-hidden="true" tabindex="-1"></a><span class="er">If-Match:</span> <span class="er">$1</span></span>
<span id="cb128-25"><a href="#cb128-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-26"><a href="#cb128-26" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb128-27"><a href="#cb128-27" aria-hidden="true" tabindex="-1"></a>   <span class="dt">&quot;Salary&quot;</span><span class="fu">:</span> <span class="dv">75000</span></span>
<span id="cb128-28"><a href="#cb128-28" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span>
<span id="cb128-29"><a href="#cb128-29" aria-hidden="true" tabindex="-1"></a><span class="er">--batch_36522ad7-fc75-4b56-8c71-56071383e77b--</span></span></code></pre></div>
</div>
</details>
<details open><summary>
<h4 id="11774-referencing-response-body-values"><a name="ReferencingResponseBodyValues" href="#ReferencingResponseBodyValues">11.7.7.4 Referencing Response Body Values</a></h4>
</summary>
<div class="example">
<p>Example 108: a batch request that contains the following operations in the order listed:</p>
<ul>
<li>Get an employee (with <code>Content-ID = 1</code>)</li>
<li>Get all employees residing in the same building</li>
</ul>
<pre><code>POST /service/$batch HTTP/1.1
Host: host
OData-Version: 4.01
Content-Type: multipart/mixed; boundary=batch_36522ad7-fc75-4b56-8c71-56071383e77b
Content-Length: ###

--batch_36522ad7-fc75-4b56-8c71-56071383e77b
Content-Type: application/http
Content-ID: 1

GET /service/Employees/0?$select=Building HTTP/1.1
Host: host
Accept: application/json


--batch_36522ad7-fc75-4b56-8c71-56071383e77b
Content-Type: application/http
Content-ID: 2

GET /service/Employees?$filter=Building eq $1/Building HTTP/1.1
Host: host
Accept: application/json


--batch_36522ad7-fc75-4b56-8c71-56071383e77b--</code></pre>
</div>
</details>
<details open><summary>
<h4 id="11775-processing-a-multipart-batch-request"><a name="ProcessingaMultipartBatchRequest" href="#ProcessingaMultipartBatchRequest">11.7.7.5 Processing a Multipart Batch Request</a></h4>
</summary>
<p>The service MUST process the individual requests and change sets within a multipart batch request in the order received. Processing stops on the first error unless the <a href="#Preferencecontinueonerrorodatacontinueonerror"><code>continue-on-error</code></a> preference is specified with an explicit or implicit value of <code>true</code>.</p>
<p>All requests in a change set represent a single change unit so a service MUST successfully process and apply all the requests in the change set or else apply none of them. It is up to the service implementation to define rollback semantics to undo any requests within a change set that may have been applied before another request in that same change set failed and thereby apply this all-or-nothing requirement. The service MAY execute the requests within a change set in any order and MAY return the responses to the individual requests in any order. If a request specifies a request identifier, the service MUST include the <code>Content-ID</code> header with the request identifier in the corresponding response so clients can correlate requests and responses.</p>
</details>
<details open><summary>
<h4 id="11776-multipart-batch-response"><a name="MultipartBatchResponse" href="#MultipartBatchResponse">11.7.7.6 Multipart Batch Response</a></h4>
</summary>
<p>A multipart response to a batch request MUST contain a <code>Content-Type</code> header with value <code>multipart/mixed</code>.</p>
<p>The body of a multipart response to a multipart batch request MUST structurally match one-to-one with the multipart batch request body, such that the same multipart message structure defined for requests is used for responses. There are three exceptions to this rule:</p>
<ul>
<li>When a request within a change set fails, the change set response is not represented using the <code>multipart/mixed</code> media type. Instead, a single response, using the <code>application/http</code> media type, is returned that applies to all requests in the change set and MUST be a valid OData error response.</li>
<li>When an error occurs processing a request and the <a href="#Preferencecontinueonerrorodatacontinueonerror"><code>continue-on-error</code></a> preference is not specified, or specified with an explicit value of <code>false</code>, processing of the batch is terminated and the error response is the last part of the multipart response.</li>
<li><a href="#AsynchronousBatchRequests">Asynchronously processed batch requests</a> can return interim results and end with a <code>202 Accepted</code> as the last part of the multipart response. Therefore, the <a href="#Preferencerespondasync"><code>respond-async</code></a> preference MUST NOT be applied to individual requests within a batch if the batch response is a multipart response.</li>
</ul>
<p>The body of a multipart response to a JSON batch request contains one body part for each processed or accepted request. The order of the body parts is insignificant as each body part MUST contain the <code>Content-ID</code> header with the value of the <code>id</code> name/value pair of the corresponding request object.</p>
<p>A response to an operation in a batch MUST be formatted exactly as it would have appeared outside of a batch as described in the corresponding subsections of chapter <a href="#DataServiceRequests">Data Service Requests</a>. Relative URLs in each individual response are relative to the request URL of the corresponding individual request (see <a href="#batchcontentid">example 106</a>). URLs in responses MUST NOT contain <code>$</code>-prefixed request identifiers.</p>
<div class="example">
<p>Example 109: referencing the batch request <a href="#batchRequest">example 105</a> above, assume all the requests except the final query request succeed. In this case the response would be</p>
<pre><code>HTTP/1.1 200 OK
OData-Version: 4.0
Content-Length: ####
Content-Type: multipart/mixed; boundary=b_243234_25424_ef_892u748

--b_243234_25424_ef_892u748
Content-Type: application/http

HTTP/1.1 200 OK
Content-Type: application/json
Content-Length: ###

&lt;JSON representation of the Customer entity with key ALFKI&gt;
--b_243234_25424_ef_892u748
Content-Type: multipart/mixed; boundary=cs_12u7hdkin252452345eknd_383673037

--cs_12u7hdkin252452345eknd_383673037
Content-Type: application/http
Content-ID: 1

HTTP/1.1 201 Created
Content-Type: application/json
Location: http://host/service.svc/Customer(&#39;POIUY&#39;)
Content-Length: ###

&lt;JSON representation of the new Customer entity&gt;
--cs_12u7hdkin252452345eknd_383673037
Content-Type: application/http
Content-ID: 2

HTTP/1.1 204 No Content


--cs_12u7hdkin252452345eknd_383673037--
--b_243234_25424_ef_892u748
Content-Type: application/http

HTTP/1.1 404 Not Found
Content-Type: application/xml
Content-Length: ###

&lt;Error message&gt;
--b_243234_25424_ef_892u748---</code></pre>
</div>
</details>
<details open><summary>
<h4 id="11777-asynchronous-batch-requests"><a name="AsynchronousBatchRequests" href="#AsynchronousBatchRequests">11.7.7.7 Asynchronous Batch Requests</a></h4>
</summary>
<p>Batch requests MAY be executed asynchronously by including the <a href="#Preferencerespondasync"><code>respond-async</code></a> preference in the <a href="#HeaderPrefer"><code>Prefer</code></a> header. If the service responds with a multipart batch response, it MUST ignore the <code>respond-async</code> preference for individual requests within a batch.</p>
<p>After successful execution of the batch request the response to the batch request is returned in the body of a response to an interrogation request against the <em>status monitor resource</em> URL (see <a href="#AsynchronousRequests">Asynchronous Requests</a>).</p>
<p>A service MAY return interim results to an asynchronously executing batch. It does this by responding with <a href="#ResponseCode200OK"><code>200 OK</code></a> to a <code>GET</code> request to the monitor resource and including a <a href="#ResponseCode202Accepted"><code>202 Accepted</code></a> response as the last part of the multipart response. The client can use the monitor URL returned in this <code>202 Accepted</code> response to continue processing the batch response.</p>
<p>Since a change set is executed atomically, <code>202 Accepted</code> MUST NOT be returned within a change set.</p>
<div class="example">
<p>Example 110: referencing the <a href="#batchRequest">example 105</a> above again, assume that</p>
<pre><code>HTTP/1.1 202 Accepted
Location: http://service-root/async-monitor-0
Retry-After: ###
</code></pre>
<p>When interrogating the monitor URL only the first request in the batch has finished processing and all the remaining requests are still being processed. Note that the actual multipart batch response itself is contained in an <code>application/http</code> wrapper as it is a response to a status monitor resource:</p>
<pre><code>HTTP/1.1 200 OK
Content-Type: application/http

HTTP/1.1 200 OK
OData-Version: 4.0
Content-Length: ####
Content-Type: multipart/mixed; boundary=b_243234_25424_ef_892u748

--b_243234_25424_ef_892u748
Content-Type: application/http

HTTP/1.1 200 OK
Content-Type: application/json
Content-Length: ###

&lt;JSON representation of the Customer entity with key ALFKI&gt;
--b_243234_25424_ef_892u748
Content-Type: application/http

HTTP/1.1 202 Accepted
Location: http://service-root/async-monitor
Retry-After: ###


--b_243234_25424_ef_892u748--</code></pre>
<p>After some time the client makes a second request using the returned monitor URL, not explicitly accepting <code>application/http</code>. The batch is completely processed and the response is the final result.</p>
<pre><code>HTTP/1.1 200 OK
AsyncResult: 200
OData-Version: 4.0
Content-Length: ####
Content-Type: multipart/mixed; boundary=b_243234_25424_ef_892u748

--b_243234_25424_ef_892u748
Content-Type: multipart/mixed; boundary=cs_12u7hdkin252452345eknd_383673037

--cs_12u7hdkin252452345eknd_383673037
Content-Type: application/http
Content-ID: 1

HTTP/1.1 201 Created
Content-Type: application/json
Location: http://host/service.svc/Customer(&#39;POIUY&#39;)
Content-Length: ###

&lt;JSON representation of a new Customer entity&gt;
--cs_12u7hdkin252452345eknd_383673037
Content-Type: application/http
Content-ID: 2

HTTP/1.1 204 No Content


--cs_12u7hdkin252452345eknd_383673037--
--b_243234_25424_ef_892u748
Content-Type: application/http

HTTP/1.1 404 Not Found
Content-Type: application/xml
Content-Length: ###

&lt;Error message&gt;
--b_243234_25424_ef_892u748--</code></pre>
</div>
</details>
</details>
</details>
</details>
<hr />
<details open><summary>
<h1 id="12-conformance"><a name="Conformance" href="#Conformance">12 Conformance</a></h1>
</summary>
<p>OData is designed as a set of conventions that can be layered on top of existing standards to provide common representations for common functionality. Not all services will support all of the conventions defined in the protocol; services choose those conventions defined in OData as the representation to expose that functionality appropriate for their scenarios.</p>
<p>To aid in client/server interoperability, this specification defines multiple levels of conformance for an OData Service, as well as the <a href="#InteroperableODataClients">minimal requirements</a> for an OData Client to be interoperable across OData services.</p>
<details open><summary>
<h2 id="121-odata-40-service-conformance-levels"><a name="OData40ServiceConformanceLevels" href="#OData40ServiceConformanceLevels">12.1 OData 4.0 Service Conformance Levels</a></h2>
</summary>
<p>OData 4.0 defines three levels of conformance for an OData Service.</p>
<p>Note: The conformance levels are design to correspond to different service scenarios. For example, a service that publishes data compliant with one or more of the OData defined formats may comply with the <a href="#OData40MinimalConformanceLevel">OData 4.0 Minimal Conformance Level</a> without supporting any additional functionality. A service that offers more control over the data that the client retrieves may comply with the <a href="#OData40IntermediateConformanceLevel">OData 4.0 Intermediate Conformance Level</a>. Services that conform to the <a href="#OData40AdvancedConformanceLevel">OData 4.0 Advanced Conformance Level</a> can expect to interoperate with the most functionality against the broadest range of generic clients.</p>
<p>Services can advertise their level of conformance by annotating their entity container with the term <a href="https://github.com/oasis-tcs/odata-vocabularies/blob/main/vocabularies/Org.OData.Capabilities.V1.md#ConformanceLevel"><code>Capabilities.ConformanceLevel</code></a> defined in <a href="#ODataVocCap">OData-VocCap</a>.</p>
<p>Note: Services are encouraged to support as much additional functionality beyond their level of conformance as is appropriate for their intended scenario.</p>
<details open><summary>
<h3 id="1211-odata-40-minimal-conformance-level"><a name="OData40MinimalConformanceLevel" href="#OData40MinimalConformanceLevel">12.1.1 OData 4.0 Minimal Conformance Level</a></h3>
</summary>
<p>In order to conform to the OData 4.0 Minimal conformance level, a service:</p>
<ol type="1">
<li>MUST publish a service document at the service root (<a href="#ServiceDocumentRequest">section 11.1.1</a>)</li>
<li>MUST return data according to the <a href="#ODataJSON">OData-JSON</a> format</li>
<li>MUST use server-driven paging when returning partial results (<a href="#ServerDrivenPaging">section 11.2.6.7</a>) and not use any other mechanism</li>
<li>MUST return the appropriate <code>OData-Version</code> header (<a href="#HeaderODataVersion">section 8.1.5</a>)</li>
<li>MUST conform to the semantics the following headers, or fail the request
<ol type="1">
<li><code>Accept</code> (<a href="#HeaderAccept">section 8.2.1</a>)</li>
<li><code>OData-MaxVersion</code> (<a href="#HeaderODataMaxVersion">section 8.2.7</a>)</li>
</ol></li>
<li>MUST follow OData guidelines for extensibility (<a href="#Extensibility">section 6</a> and all subsections)</li>
<li>MUST successfully parse the request according to <a href="#ODataABNF">OData-ABNF</a> for any supported system query options and follow the specification or fail the request</li>
<li>MUST expose only data types defined in <a href="#ODataCSDL">OData-CSDLXML</a></li>
<li>MUST NOT require clients to understand any metadata or instance annotations (<a href="#VocabularyExtensibility">section 6.4</a>), custom headers (<a href="#HeaderFieldExtensibility">section 6.5</a>), or custom content (<a href="#PayloadExtensibility">section 6.2</a>) in the payload in order to correctly consume the service</li>
<li>MUST NOT violate any OData update semantics (<a href="#DataModification">section 11.4</a> and all subsections)</li>
<li>MUST NOT violate any other OData-defined semantics</li>
<li>SHOULD support <code>$expand</code> (<a href="#SystemQueryOptionexpand">section 11.2.5.2</a>)</li>
<li>SHOULD publish metadata at <code>$metadata</code> according to <a href="#ODataCSDL">OData-CSDLXML</a> and MAY publish metadata according to <a href="#ODataCSDL">OData-CSDLJSON</a> (<a href="#MetadataDocumentRequest">section 11.1.2</a>)</li>
<li>MUST support prefixed variants of supported headers and preference values</li>
<li>MUST support enumeration and duration literals in URLs with the type prefix</li>
</ol>
<p>Additionally, if async operations are supported:</p>
<ol start="16" type="1">
<li>MUST return an HTTP message as the final response to an asynchronous request with an <code>OData-MaxVersion</code> value of <code>4.0</code> and an <code>Accept</code> header including <code>application/http</code>.</li>
<li>MAY return the <a href="#HeaderAsyncResult"><code>AsyncResult</code></a> header in the final response to an asynchronous request</li>
</ol>
<p>To be considered an <em>Updatable OData Service</em>, the service additionally:</p>
<ol start="18" type="1">
<li>MUST include edit links (explicitly or implicitly) for all updatable or deletable resources according to <a href="#ODataJSON">OData-JSON</a></li>
<li>MUST support <code>POST</code> of new entities to insertable entity sets (<a href="#ReturningResultsfromDataModificationRequests">section 11.4.1.5</a>)</li>
<li>MUST support <code>POST</code> of new related entities to updatable navigation properties (<a href="#CreateanEntity">section 11.4.2</a>)</li>
<li>MUST support <code>POST</code> to <code>$ref</code> to add an existing entity to an updatable related collection (<a href="#AddaReferencetoaCollectionValuedNavigationProperty">section 11.4.6.1</a>)</li>
<li>MUST support <code>PUT</code> to <code>$ref</code> to set an existing single updatable related entity (<a href="#ChangetheReferenceinaSingleValuedNavigationProperty">section 11.4.6.3</a>)</li>
<li>MUST support <code>PATCH</code> to all edit URLs for updatable resources (<a href="#UpdateanEntity">section 11.4.3</a>)</li>
<li>MUST support <code>DELETE</code> to all edit URLs for deletable resources (<a href="#DeleteanEntity">section 11.4.5</a>)</li>
<li>MUST support <code>DELETE</code> to <code>$ref</code> to remove a reference to an entity from an updatable navigation property (<a href="#RemoveaReferencetoanEntity">section 11.4.6.2</a>)</li>
<li>MUST support <code>If-Match</code> header in update/delete of any resources returned with an ETag (<a href="#UseofETagsforAvoidingUpdateConflicts">section 11.4.1.1</a>)</li>
<li>MUST return a <code>Location</code> header with the edit URL or read URL of a created resource (<a href="#CreateanEntity">section 11.4.2</a>)</li>
<li>MUST include the <code>OData-EntityId</code> header in response to any create or upsert operation that returns <code>204 No Content</code> (<a href="#HeaderODataEntityId">section 8.3.4</a>)</li>
<li>MUST support Upserts (<a href="#UpsertanEntity">section 11.4.4</a>)</li>
<li>SHOULD support <code>PUT</code> and <code>PATCH</code> to an individual primitive (<a href="#UpdateaPrimitiveProperty">section 11.4.9.1</a>) or complex (<a href="#UpdateaComplexProperty">section 11.4.9.3</a>) property (respectively)</li>
<li>SHOULD support <code>DELETE</code> to set an individual property to null (<a href="#SetaValuetoNull">section 11.4.9.2</a>)</li>
<li>SHOULD support deep inserts (<a href="#CreateRelatedEntitiesWhenCreatinganEntity">section 11.4.2.2</a>)</li>
<li>MAY support set-based updates (<a href="#UpdateMembersofaCollection">section 11.4.14</a>) or deletes (<a href="#DeleteMembersofaCollection">section 11.4.15</a>) to members of a collection</li>
</ol>
</details>
<details open><summary>
<h3 id="1212-odata-40-intermediate-conformance-level"><a name="OData40IntermediateConformanceLevel" href="#OData40IntermediateConformanceLevel">12.1.2 OData 4.0 Intermediate Conformance Level</a></h3>
</summary>
<p>In order to conform to the OData Intermediate Conformance Level, a service:</p>
<ol type="1">
<li>MUST conform to the <a href="#OData40MinimalConformanceLevel">OData 4.0 Minimal Conformance Level</a></li>
<li>MUST successfully parse the request according to <a href="#ODataABNF">OData-ABNF</a> and follow the specification or fail the request</li>
<li>MUST support <code>$select</code> (<a href="#SystemQueryOptionselect">section 11.2.5.1</a>)</li>
<li>MUST support casting to a derived type according to <a href="#ODataURL">OData-URL</a> if derived types are present in the model</li>
<li>MUST support <code>$top</code> (<a href="#SystemQueryOptiontop">section 11.2.6.3</a>)</li>
<li>MUST support <code>/$value</code> on media entities (<a href="#MetadataDocumentRequest">section 11.1.2</a>) and individual properties (<a href="#RequestingaRawValueusingvalue">section 11.2.4.2</a>)</li>
<li>MUST support <code>$filter</code> (<a href="#SystemQueryOptionfilter">section 11.2.6.1</a>)
<ol type="1">
<li>MUST support <code>eq</code>, <code>ne</code> filter operations on properties of entities in the requested entity set (<a href="#BuiltinFilterOperations">section 11.2.6.1.1</a>)</li>
<li>MUST support aliases in <code>$filter</code> expressions (<a href="#ParameterAliases">section 11.2.6.1.3</a>)</li>
<li>SHOULD support additional filter operations (<a href="#BuiltinFilterOperations">section 11.2.6.1.1</a>) and MUST fail the request for any unsupported filter operations</li>
<li>SHOULD support the canonical functions (<a href="#BuiltinQueryFunctions">section 11.2.6.1.2</a>) and MUST fail the request for any unsupported canonical functions</li>
<li>SHOULD support <code>$filter</code> on expanded entities (<a href="#ExpandOptions">section 11.2.5.2.1</a>)</li>
</ol></li>
<li>SHOULD publish metadata at <code>$metadata</code> according to <a href="#ODataCSDL">OData-CSDLXML</a> (<a href="#MetadataDocumentRequest">section 11.1.2</a>)</li>
<li>SHOULD support the <a href="#ODataJSON">OData-JSON</a> format</li>
<li>SHOULD consider supporting basic authentication as defined in <a href="#rfc7617">RFC7617</a> over HTTPS for the highest level of interoperability with generic clients</li>
<li>SHOULD support the <code>$search</code> system query option (<a href="#SystemQueryOptionsearch">section 11.2.6.6</a>)</li>
<li>SHOULD support the <code>$skip</code> system query option (<a href="#SystemQueryOptionskip">section 11.2.6.4</a>)</li>
<li>SHOULD support the <code>$count</code> system query option (<a href="#SystemQueryOptioncount">section 11.2.6.5</a>)</li>
<li>SHOULD support <code>$expand</code> (<a href="#SystemQueryOptionexpand">section 11.2.5.2</a>)</li>
<li>SHOULD support the lambda operators <code>any</code> and <code>all</code> on navigation- and collection-valued properties (section 5.1.1.10 in <a href="#ODataURL">OData-URL</a>)</li>
<li>SHOULD support the <code>/$count</code> segment on navigation and collection properties (<a href="#RequestingtheNumberofItemsinaCollection">section 11.2.10</a>)</li>
<li>SHOULD support <code>$orderby asc</code> and <code>desc</code> on individual properties (<a href="#SystemQueryOptionorderby">section 11.2.6.2</a>)</li>
</ol>
</details>
<details open><summary>
<h3 id="1213-odata-40-advanced-conformance-level"><a name="OData40AdvancedConformanceLevel" href="#OData40AdvancedConformanceLevel">12.1.3 OData 4.0 Advanced Conformance Level</a></h3>
</summary>
<p>In order to conform to the OData Advanced Conformance Level, a service:</p>
<ol type="1">
<li>MUST conform to at least the <a href="#OData40IntermediateConformanceLevel">OData 4.0 Intermediate Conformance Level</a></li>
<li>MUST publish metadata at <code>$metadata</code> according to <a href="#ODataCSDL">OData-CSDLXML</a> (<a href="#MetadataDocumentRequest">section 11.1.2</a>)</li>
<li>MUST support the <a href="#ODataJSON">OData-JSON</a> format</li>
<li>MUST support the <code>/$count</code> segment on navigation and collection properties (<a href="#RequestingtheNumberofItemsinaCollection">section 11.2.10</a>)</li>
<li>MUST support the lambda operators <code>any</code> and <code>all</code> on navigation- and collection-valued properties (section 5.1.1.10 in <a href="#ODataURL">OData-URL</a>)</li>
<li>MUST support the <code>$skip</code> system query option (<a href="#SystemQueryOptionskip">section 11.2.6.4</a>)</li>
<li>MUST support the <code>$count</code> system query option (<a href="#SystemQueryOptioncount">section 11.2.6.5</a>)</li>
<li>MUST support <code>$orderby</code> with <code>asc</code> and <code>desc</code> on individual properties (<a href="#SystemQueryOptionorderby">section 11.2.6.2</a>)</li>
<li>MUST support <code>$expand</code> (<a href="#SystemQueryOptionexpand">section 11.2.5.2</a>)
<ol type="1">
<li>MUST support returning references for expanded properties</li>
<li>MUST support <code>$filter</code> on expanded collection-valued properties</li>
<li>MUST support cast segment in expand with derived types</li>
<li>SHOULD support <code>$orderby</code> with <code>asc</code> and <code>desc</code> on expanded collection-valued properties</li>
<li>SHOULD support <code>$count</code> on expanded collection-valued properties</li>
<li>SHOULD support <code>$top</code> and <code>$skip</code> on expanded collection-valued properties</li>
<li>SHOULD support <code>$search</code> on expanded collection-valued properties</li>
<li>SHOULD support <code>$levels</code> for recursive expand (<a href="#ExpandOptionlevels">section 11.2.5.2.1.1</a>)</li>
<li>MAY support <code>$compute</code> on expanded properties</li>
</ol></li>
<li>MUST support the <code>$search</code> system query option (<a href="#SystemQueryOptionsearch">section 11.2.6.6</a>)</li>
<li>MUST support batch requests according to the multipart format (<a href="#BatchRequests">section 11.7</a> and all subsections) and MAY support batch requests according to the JSON Batch format defined in <a href="#ODataJSON">OData-JSON</a></li>
<li>MUST support the resource path conventions defined in <a href="#ODataURL">OData-URL</a></li>
<li>SHOULD support asynchronous requests (<a href="#AsynchronousRequests">section 11.6</a>)</li>
<li>SHOULD support Delta change tracking (<a href="#RequestingChanges">section 11.3</a>)</li>
<li>SHOULD support cross-join queries defined in <a href="#ODataURL">OData-URL</a></li>
<li>MAY support the <code>$compute</code> system query option (<a href="#SystemQueryOptioncompute">section 11.2.5.3</a>)</li>
</ol>
</details>
</details>
<details open><summary>
<h2 id="122-odata-401-service-conformance-levels"><a name="OData401ServiceConformanceLevels" href="#OData401ServiceConformanceLevels">12.2 OData 4.01 Service Conformance Levels</a></h2>
</summary>
<p>OData services can report conformance to the OData 4.01 specification by including <code>4.01</code> in the list of supported protocol versions in the <a href="https://github.com/oasis-tcs/odata-vocabularies/blob/main/vocabularies/Org.OData.Core.V1.md#ODataVersions"><code>Core.ODataVersions</code></a> annotation, as defined in <a href="#ODataVocCore">OData-VocCore</a>. As all OData 4.01 compliant services must also be fully OData 4.0 compliant, OData 4.01 services do not need to separately list <code>4.0</code> as a supported version.</p>
<details open><summary>
<h3 id="1221-odata-401-minimal-conformance-level"><a name="OData401MinimalConformanceLevel" href="#OData401MinimalConformanceLevel">12.2.1 OData 4.01 Minimal Conformance Level</a></h3>
</summary>
<p>In order to conform to the OData 4.01 Minimal Conformance Level, a service:</p>
<ol type="1">
<li>MUST conform to the <a href="#OData40MinimalConformanceLevel">OData 4.0 Minimal Conformance Level</a></li>
<li>MUST be compliant with version 4.01 of the <a href="#ODataJSON">OData-JSON</a> format</li>
<li>MUST return the <a href="#HeaderAsyncResult"><code>AsyncResult</code></a> result header in the final response to an asynchronous request if asynchronous operations are supported.</li>
<li>MUST support both prefixed and non-prefixed variants of supported headers and preference values</li>
<li>MUST reject a request with an incompatible <a href="#SystemQueryOptionschemaversion"><code>$schemaversion</code></a> system query option if a <a href="https://github.com/oasis-tcs/odata-vocabularies/blob/main/vocabularies/Org.OData.Core.V1.md#SchemaVersion"><code>Core.SchemaVersion</code></a> annotation is returned in <code>$metadata</code></li>
<li>MUST support specifying supported system query options with or without the <code>$</code> prefix</li>
<li>MUST support case-insensitive query option, operator, and canonical function names</li>
<li>MUST return identifiers in the case they are specified in <code>$metadata</code></li>
<li>MUST support both 4.0 and 4.01 syntax in URLs for supported functionality regardless of requested <a href="#HeaderODataMaxVersion"><code>OData-MaxVersion</code></a>
<ol type="1">
<li>MUST support casting strings to primitive types in URLs</li>
<li>MUST support enumeration and duration literals in URLs with or without the type prefix</li>
<li>MUST support invoking parameter-less function imports with or without parentheses</li>
<li>MUST support an empty object or no-content for the request body when invoking an action with no non-binding parameters</li>
<li>MUST support invoking functions and actions in a <a href="#DefaultNamespaces">default namespace</a> with or without namespace qualification</li>
<li>MUST support parameter aliases for key values and function parameter values if they allow the octets <code>00</code> (NUL), <code>2F</code> (forward slash), or <code>5C</code> (backslash) in string literals</li>
<li>SHOULD support implicit aliasing of parameters</li>
<li>SHOULD support <code>eq/ne null</code> comparison for navigation properties with a maximum cardinality of one</li>
<li>SHOULD support the <a href="#BuiltinFilterOperations"><code>in</code></a> operator</li>
<li>SHOULD support <code>divby</code></li>
<li>SHOULD support negative indexes for the substring function</li>
<li>MAY support Key-As-Segment URL convention
<ol type="1">
<li>MUST also support canonical URL conventions (described in <a href="#ODataURL">OData-URL</a>) or include URLs in payload</li>
</ol></li>
<li>MAY support the count of a filtered collection in a common expression</li>
<li>MAY support equal and non-equal structural comparison</li>
</ol></li>
<li>SHOULD publish metadata at <code>$metadata</code> according to both <a href="#ODataCSDL">OData-CSDLXML</a> and <a href="#ODataCSDL">OData-CSDLJSON</a> (<a href="#MetadataDocumentRequest">section 11.1.2</a>)</li>
<li>SHOULD NOT have identifiers within a uniqueness scope (e.g. a schema, a structural type, or an entity container) that differ only by case</li>
<li>SHOULD return the <a href="https://github.com/oasis-tcs/odata-vocabularies/blob/main/vocabularies/Org.OData.Core.V1.md#ODataVersions"><code>Core.ODataVersions</code></a> annotation</li>
<li>SHOULD report capabilities through the Capabilities vocabulary</li>
<li>MAY support filtering on annotation values</li>
<li>MAY support <code>$compute</code> system query option</li>
<li>MAY support <code>$search</code> for all collections</li>
<li>MAY support 4.01 behavior, including returning 4.01 content and payloads, if the client does not specify the <code>OData-MaxVersion:4.0</code> request header</li>
</ol>
<p>In addition, to be considered an <em>Updatable OData 4.01 Service</em>, the service:</p>
<ol start="18" type="1">
<li>MUST conform to the <a href="#OData40MinimalConformanceLevel">OData 4.0 Minimal Conformance Level</a> for an Updateable service.</li>
<li>MUST support <code>DELETE</code> to the reference of a collection member to be removed, identified by key (<a href="#RemoveaReferencetoanEntity">section 11.4.6.2</a>)</li>
<li>SHOULD support <code>PUT</code> against single entity with nested content</li>
<li>SHOULD support deep updates (<a href="#UpdateRelatedEntitiesWhenUpdatinganEntity">section 11.4.3.1</a>) and deep inserts (<a href="#CreateRelatedEntitiesWhenCreatinganEntity">section 11.4.2.2</a>)</li>
<li>SHOULD support <code>PUT</code> or <code>DELETE</code> to <code>$ref</code> of a collection-valued nav prop</li>
<li>MAY support <code>POST</code> to collections of complex/primitive types</li>
<li>MAY support <code>PATCH</code> and <code>DELETE</code> to a collection</li>
<li>MAY support <code>POST</code>, <code>PATCH</code> and <code>DELETE</code> to a collection URL terminating in a type cast segment</li>
<li>MAY support <code>PATCH</code> to entity sets using the 4.01 delta payload format</li>
<li>MAY support <code>$select</code> and <code>$expand</code> on data modification requests</li>
</ol>
</details>
<details open><summary>
<h3 id="1222-odata-401-intermediate-conformance-level"><a name="OData401IntermediateConformanceLevel" href="#OData401IntermediateConformanceLevel">12.2.2 OData 4.01 Intermediate Conformance Level</a></h3>
</summary>
<p>In order to conform to the OData 4.01 Intermediate Conformance Level, a service:</p>
<ol type="1">
<li>MUST conform to the <a href="#OData401MinimalConformanceLevel">OData 4.01 Minimal Conformance Level</a></li>
<li>MUST conform to the <a href="#OData40IntermediateConformanceLevel">OData 4.0 Intermediate Conformance Level</a></li>
<li>MUST support <code>eq/ne null</code> comparison for navigation properties with a maximum cardinality of one</li>
<li>MUST support the <a href="#BuiltinFilterOperations"><code>in</code></a> operator</li>
<li>MUST support the <code>$select</code> option nested within <code>$select</code></li>
<li>SHOULD support the count of a filtered collection in a common expression</li>
<li>SHOULD support equal and non-equal structural comparison</li>
<li>SHOULD support <code>$compute</code> system query option</li>
<li>SHOULD support nested query options in <code>$select</code></li>
<li>MAY support nested parameter alias assignments in <code>$select</code> and <code>$expand</code></li>
<li>MAY support filtering a collection using a <code>/$filter</code> path segment</li>
</ol>
</details>
<details open><summary>
<h3 id="1223-odata-401-advanced-conformance-level"><a name="OData401AdvancedConformanceLevel" href="#OData401AdvancedConformanceLevel">12.2.3 OData 4.01 Advanced Conformance Level</a></h3>
</summary>
<p>In order to conform to the OData 4.01 Advanced Conformance Level, a service:</p>
<ol type="1">
<li>MUST conform to the <a href="#OData401IntermediateConformanceLevel">OData 4.01 Intermediate Conformance Level</a></li>
<li>MUST conform to the <a href="#OData40AdvancedConformanceLevel">OData 4.0 Advanced Conformance Level</a></li>
<li>MUST support the count of a filtered/searched collection in a common expression</li>
<li>MUST support <code>$compute</code> system query option</li>
<li>MUST support nested options in <code>$select</code>
<ol type="1">
<li>MUST support <code>$filter</code> on selected collection-valued properties</li>
<li>SHOULD support <code>$orderby</code> with <code>asc</code> and <code>desc</code> on selected collection-valued properties</li>
<li>SHOULD support the <code>$count</code> on selected collection-valued properties</li>
<li>SHOULD support <code>$top</code> and <code>$skip</code> on selected collection-valued properties</li>
<li>SHOULD support <code>$search</code> on selected collection-valued properties</li>
</ol></li>
<li>MUST publish metadata at <code>$metadata</code> according to <a href="#ODataCSDL">OData-CSDLJSON</a> (<a href="#MetadataDocumentRequest">section 11.1.2</a>)</li>
<li>MUST support batch requests according both to the multipart format (<a href="#BatchRequests">section 11.7</a> and all subsections) and the JSON Batch format defined in <a href="#ODataJSON">OData-JSON</a></li>
<li>SHOULD support filtering a collection using a <code>/$filter</code> path segment</li>
<li>SHOULD support nested parameter alias assignments in <code>$select</code> and <code>$expand</code></li>
<li>MAY support case-insensitive comparison of identifiers in URLs and request payloads if no exact match is found, using the same lookup sequence as for <a href="#DefaultNamespaces">default namespaces</a> with a case-insensitive comparison</li>
</ol>
</details>
</details>
<details open><summary>
<h2 id="123-interoperable-odata-clients"><a name="InteroperableODataClients" href="#InteroperableODataClients">12.3 Interoperable OData Clients</a></h2>
</summary>
<p>Interoperable OData clients can expect to work with OData Services that comply with at least the <a href="#OData40MinimalConformanceLevel">OData 4.0 Minimal Conformance Level</a> and implement the <a href="#ODataJSON">OData-JSON</a> format.</p>
<p>To be generally interoperable, OData clients</p>
<ol type="1">
<li>MUST specify the <code>OData-MaxVersion</code> header in requests (<a href="#HeaderODataMaxVersion">section 8.2.7</a>)</li>
<li>MUST specify <code>OData-Version</code> (<a href="#HeaderODataVersion">section 8.1.5</a>) and <code>Content-Type</code> (<a href="#HeaderContentType">section 8.1.1</a>) in any request with a payload</li>
<li>MUST be a conforming consumer of OData as defined in <a href="#ODataJSON">OData-JSON</a></li>
<li>MUST follow redirects (<a href="#ResponseCode3xxRedirection">section 9.1.5</a>)</li>
<li>MUST correctly handle next links (<a href="#ServerDrivenPaging">section 11.2.6.7</a>)</li>
<li>MUST support instances returning properties and navigation properties not specified in metadata (<a href="#RequestingData">section 11.2</a>)</li>
<li>MUST generate <code>PATCH</code> requests for updates, if the client supports updates (<a href="#UpdateanEntity">section 11.4.3</a>)</li>
<li>MUST include the <code>$</code> prefix when specifying OData-defined system query options</li>
<li>MUST use case-sensitive query options, operators, and canonical functions</li>
<li>MUST encode the plus character (octet <code>0x2B</code>) as <code>%2B</code> in URLs to avoid servers mis-interpreting the plus character as an encoded space</li>
<li>SHOULD support basic authentication as defined in <a href="#rfc7617">RFC7617</a> over HTTPS</li>
<li>MAY request entity references in place of entities previously returned in the response (<a href="#RequestingEntityReferences">section 11.2.8</a>)</li>
<li>MAY support deleted entities, link entities, deleted link entities in a delta response (<a href="#RequestingChanges">section 11.3</a>)</li>
<li>MAY support asynchronous responses (<a href="#AsynchronousRequests">section 11.6</a>)</li>
<li>MAY support <code>metadata=minimal</code> in a JSON response (see <a href="#ODataJSON">OData-JSON</a>)</li>
<li>MAY support <code>streaming</code> in a JSON response (see <a href="#ODataJSON">OData-JSON</a>)</li>
</ol>
<p>In addition, interoperable OData 4.01 clients</p>
<ol start="17" type="1">
<li>MUST send OData 4.0-compliant payloads to services that don‚Äôt advertise support for 4.01 or greater through the <a href="https://github.com/oasis-tcs/odata-vocabularies/blob/main/vocabularies/Org.OData.Core.V1.md#ODataVersions"><code>Core.ODataVersions</code></a> metadata annotation (see <a href="#ODataVocCore">OData-VocCore</a>)</li>
<li>MUST specify identifiers in payloads and URLs in the case they are specified in <code>$metadata</code></li>
<li>MUST be prepared to receive any valid 4.01 CSDL</li>
<li>MUST be prepared to receive any valid 4.01 response according to the requested format</li>
<li>SHOULD use capabilities (see <a href="#ODataVocCap">OData-VocCap</a>) to determine if a 4.01 feature is supported but MAY attempt syntax and be prepared to handle <code>400 Bad Request</code> or <a href="#ResponseCode501NotImplemented"><code>501 Not Implemented</code></a></li>
</ol>
</details>
</details>
<hr />
<details open><summary>
<h1 id="appendix-a-references"><a name="References" href="#References">Appendix A. References</a></h1>
</summary>
<p>This appendix contains the normative and informative references that are used in this document.</p>
<p>While any hyperlinks included in this appendix were valid at the time of publication, OASIS cannot guarantee their long-term validity.</p>
<details open><summary>
<h2 id="a1-normative-references"><a name="NormativeReferences" href="#NormativeReferences">A.1 Normative References</a></h2>
</summary>
<p>The following documents are referenced in such a way that some or all of their content constitutes requirements of this document.</p>
<h6 id="odata-abnf"><a name="ODataABNF">[OData-ABNF]</a></h6>
<p><em>ABNF components: OData ABNF Construction Rules Version 4.02 and OData ABNF Test Cases.</em><br />
See link in ‚Äú<a href="#RelatedWork">Related work</a>‚Äù section on cover page.</p>
<h6 id="odata-aggregation"><a name="ODataAggregation">[OData-Aggregation]</a></h6>
<p><em>OData Extension for Data Aggregation Version 4.02.</em><br />
See link in ‚Äú<a href="#RelatedWork">Related work</a>‚Äù section on cover page.</p>
<h6 id="odata-csdl"><a name="ODataCSDL">[OData-CSDL]</a></h6>
<p><em>OData Common Schema Definition Language (CSDL) JSON Representation Version 4.02.</em><br />
See link in ‚Äú<a href="#RelatedWork">Related work</a>‚Äù section on cover page.</p>
<p><em>OData Common Schema Definition Language (CSDL) XML Representation Version 4.02.</em><br />
See link in ‚Äú<a href="#RelatedWork">Related work</a>‚Äù section on cover page.</p>
<h6 id="odata-json"><a name="ODataJSON">[OData-JSON]</a></h6>
<p><em>OData JSON Format Version 4.02.</em><br />
See link in ‚Äú<a href="#RelatedWork">Related work</a>‚Äù section on cover page.</p>
<h6 id="odata-url"><a name="ODataURL">[OData-URL]</a></h6>
<p><em>OData Version 4.02. Part 2: URL Conventions.</em><br />
See link in ‚Äú<a href="#RelatedWork">Related work</a>‚Äù section on cover page.</p>
<h6 id="odata-voccap"><a name="ODataVocCap">[OData-VocCap]</a></h6>
<p><em>OData Vocabularies Version 4.0: Capabilities Vocabulary.</em><br />
See link in ‚Äú<a href="#RelatedWork">Related work</a>‚Äù section on cover page.</p>
<h6 id="odata-voccore"><a name="ODataVocCore">[OData-VocCore]</a></h6>
<p><em>OData Vocabularies Version 4.0: Core Vocabulary.</em><br />
See link in ‚Äú<a href="#RelatedWork">Related work</a>‚Äù section on cover page.</p>
<h6 id="rfc2046"><a name="rfc2046">[RFC2046]</a></h6>
<p><em>Freed, N. and N. Borenstein, ‚ÄúMultipurpose Internet Mail Extensions (MIME) Part Two: Media Types‚Äù, RFC 2046, DOI 10.17487/RFC2046, November 1996</em>. <a href="https://www.rfc-editor.org/info/rfc2046">https://www.rfc-editor.org/info/rfc2046</a>.</p>
<h6 id="rfc2119"><a name="rfc2119">[RFC2119]</a></h6>
<p><em>Bradner, S., ‚ÄúKey words for use in RFCs to Indicate Requirement Levels‚Äù, BCP 14, RFC 2119, DOI 10.17487/RFC2119, March 1997</em>. <a href="https://www.rfc-editor.org/info/rfc2119">https://www.rfc-editor.org/info/rfc2119</a>.</p>
<h6 id="rfc3987"><a name="rfc3987">[RFC3987]</a></h6>
<p><em>Duerst, M. and M. Suignard, ‚ÄúInternationalized Resource Identifiers (IRIs)‚Äù, RFC 3987, DOI 10.17487/RFC3987, January 2005</em>. <a href="https://www.rfc-editor.org/info/rfc3987">https://www.rfc-editor.org/info/rfc3987</a>.</p>
<h6 id="rfc5646"><a name="rfc5646">[RFC5646]</a></h6>
<p><em>Phillips, A., Ed., and M. Davis, Ed., ‚ÄúTags for Identifying Languages‚Äù, BCP 47, RFC 5646, DOI 10.17487/RFC5646, September 2009</em>. <a href="https://www.rfc-editor.org/info/rfc5646">https://www.rfc-editor.org/info/rfc5646</a>.</p>
<h6 id="rfc5789"><a name="rfc5789">[RFC5789]</a></h6>
<p><em>Dusseault, L. and J. Snell, ‚ÄúPATCH Method for HTTP‚Äù, RFC 5789, DOI 10.17487/RFC5789, March 2010</em>. <a href="https://www.rfc-editor.org/info/rfc5789">https://www.rfc-editor.org/info/rfc5789</a>.</p>
<h6 id="rfc7240"><a name="rfc7240">[RFC7240]</a></h6>
<p><em>Snell, J., ‚ÄúPrefer Header for HTTP‚Äù, RFC 7240, DOI 10.17487/RFC7240, June 2014</em>. <a href="https://www.rfc-editor.org/info/rfc7240">https://www.rfc-editor.org/info/rfc7240</a>.</p>
<h6 id="rfc7617"><a name="rfc7617">[RFC7617]</a></h6>
<p><em>Reschke, J., ‚ÄúThe ‚ÄòBasic‚Äô HTTP Authentication Scheme‚Äù, RFC 7617, DOI 10.17487/RFC7617, September 2015</em>. <a href="https://www.rfc-editor.org/info/rfc7617">https://www.rfc-editor.org/info/rfc7617</a>.</p>
<h6 id="rfc8174"><a name="rfc8174">[RFC8174]</a></h6>
<p><em>Leiba, B., ‚ÄúAmbiguity of Uppercase vs Lowercase in RFC 2119 Key Words‚Äù, BCP 14, RFC 8174, DOI 10.17487/RFC8174, May 2017</em>. <a href="https://www.rfc-editor.org/info/rfc8174">https://www.rfc-editor.org/info/rfc8174</a>.</p>
<h6 id="rfc9110"><a name="rfc9110">[RFC9110]</a></h6>
<p><em>Fielding, R., Ed., M. Nottingham, Ed., and J. Reschke, Ed., ‚ÄúHTTP Semantics‚Äù, RFC 9110, June 2022</em><br />
<a href="https://www.rfc-editor.org/info/rfc9110">https://www.rfc-editor.org/info/rfc9110</a>.</p>
</details>
<details open><summary>
<h2 id="a2-informative-references"><a name="InformativeReferences" href="#InformativeReferences">A.2 Informative References</a></h2>
</summary>
<h6 id="ecmascript"><a name="_ECMAScript">[ECMAScript]</a></h6>
<p><em>ECMAScript 2023 Language Specification, 14th Edition</em>, June 2023. Standard ECMA-262. <a href="https://www.ecma-international.org/publications-and-standards/standards/ecma-262/">https://www.ecma-international.org/publications-and-standards/standards/ecma-262/</a>.</p>
<h6 id="well-known-text"><a name="_WKT">[Well-Known Text]</a></h6>
<p><em>OpenGIS Implementation Specification for Geographic information ‚Äì Simple feature access ‚Äì Part 1: Common architecture</em>, May 2011. Open Geospatial Consortium. <a href="https://www.ogc.org/standard/sfa/">https://www.ogc.org/standard/sfa/</a>.</p>
</details>
</details>
<hr />
<details open><summary>
<h1 id="appendix-b-safety-security-and-privacy-considerations"><a name="SafetySecurityandPrivacyConsiderations" href="#SafetySecurityandPrivacyConsiderations">Appendix B. Safety, Security and Privacy Considerations</a></h1>
</summary>
<p>This section is provided as a service to the application developers, information providers, and users of OData version 4.0 giving some references to starting points for securing OData services as specified. OData is a REST-full multi-format service that depends on other services and thus inherits both sides of the coin, security enhancements and concerns alike from the latter.</p>
<p>For HTTP relevant security implications please cf. the relevant sections of <a href="#rfc9110">RFC9110</a> (17. Security Considerations) and for the HTTP <code>PATCH</code> method <a href="#rfc5789">RFC5789</a> (5. Security Considerations) as starting points.</p>
<details open><summary>
<h2 id="b1-authentication"><a name="Authentication" href="#Authentication">B.1 Authentication</a></h2>
</summary>
<p>OData Services requiring authentication SHOULD consider supporting basic authentication as defined in <a href="#rfc7617">RFC7617</a> over HTTPS for the highest level of interoperability with generic clients. They MAY support other authentication methods.</p>
</details>
</details>
<hr />
<details open><summary>
<h1 id="appendix-c-acknowledgments"><a name="Acknowledgments" href="#Acknowledgments">Appendix C. Acknowledgments</a></h1>
</summary>
<details open><summary>
<h2 id="c1-special-thanks"><a name="SpecialThanks" href="#SpecialThanks">C.1 Special Thanks</a></h2>
</summary>
<p>The following individuals were members of the OASIS OData Technical Committee during the creation of this specification and its predecessors, and their contributions are gratefully acknowledged:</p>
<ul>
<li>Howard Abrams (CA Technologies)</li>
<li>Ken Baclawski (Northeastern University)</li>
<li>Jay Balunas (Red Hat)</li>
<li>Stephen Berard (Schneider Electric Industries SAS)</li>
<li>Mark Biamonte (Progress Software)</li>
<li>Matthew Borges (SAP SE)</li>
<li>Edmond Bourne (BlackBerry)</li>
<li>Joseph Boyle (Planetwork, Inc.)</li>
<li>Peter Brown (Individual)</li>
<li>Antonio Campanile (Bank of America)</li>
<li>Pablo Castro (Microsoft)</li>
<li>Axel Conrad (BlackBerry)</li>
<li>Robin Cover (OASIS)</li>
<li>Erik de Voogd (SDL)</li>
<li>Yi Ding (Microsoft)</li>
<li>Diane Downie (Citrix Systems)</li>
<li>Patrick Durusau (Individual)</li>
<li>Andrew Eisenberg (IBM)</li>
<li>Chet Ensign (OASIS)</li>
<li>Davina Erasmus (SDL)</li>
<li>George Ericson (Dell)</li>
<li>Colleen Evans (Microsoft)</li>
<li>Jason Fam (IBM)</li>
<li>Senaka Fernando (WSO2)</li>
<li>Josh Gavant (Microsoft)</li>
<li>Brent Gross (IBM)</li>
<li>Zhun Guo (Individual)</li>
<li>Anila Kumar GVN (CA Technologies)</li>
<li>Stefan Hagen (Individual)</li>
<li>Ralf Handl (SAP SE)</li>
<li>Barbara Hartel (SAP SE)</li>
<li>Hubert Heijkers (IBM)</li>
<li>Jens H√ºsken (SAP SE)</li>
<li>Evan Ireland (SAP SE)</li>
<li>Gershon Janssen (Individual)</li>
<li>Ram Jeyaraman (Microsoft)</li>
<li>Ling Jin (IBM)</li>
<li>Ted Jones (Red Hat)</li>
<li>Diane Jordan (IBM)</li>
<li>Stephan Klevenz (SAP SE)</li>
<li>Gerald Krause (SAP SE)</li>
<li>Nuno Linhares (SDL)</li>
<li>Paul Lipton (CA Technologies)</li>
<li>Susan Malaika (IBM)</li>
<li>Ramanjaneyulu Malisetti (CA Technologies)</li>
<li>Neil McEvoy (iFOSSF ‚Äì International Free and Open Source Solutions Foundation)</li>
<li>Stan Mitranic (CA Technologies)</li>
<li>Dale Moberg (Axway Software)</li>
<li>Graham Moore (BrightstarDB Ltd.)</li>
<li>Farrukh Najmi (Individual)</li>
<li>Shishir Pardikar (Citrix Systems)</li>
<li>Sanjay Patil (SAP SE)</li>
<li>Nuccio Piscopo (iFOSSF ‚Äì International Free and Open Source Solutions Foundation)</li>
<li>Michael Pizzo (Microsoft)</li>
<li>Ramesh Reddy (Red Hat)</li>
<li>Robert Richards (Mashery)</li>
<li>Sumedha Rubasinghe (WSO2)</li>
<li>James Snell (IBM)</li>
<li>Christof Sprenger (Microsoft)</li>
<li>Heiko Thei√üen (SAP SE)</li>
<li>Jeffrey Turpin (Axway Software)</li>
<li>John Willson (Individual)</li>
<li>John Wilmes (Individual)</li>
<li>Christopher Woodruff (Perficient, Inc.)</li>
<li>Martin Zurmuehl (SAP SE)</li>
</ul>
</details>
<details open><summary>
<h2 id="c2-participants"><a name="Participants" href="#Participants">C.2 Participants</a></h2>
</summary>
<p><strong>OData TC Members:</strong></p>
<table>
<thead>
<tr class="header">
<th style="text-align: left;">First Name</th>
<th style="text-align: left;">Last Name</th>
<th style="text-align: left;">Company</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">George</td>
<td style="text-align: left;">Ericson</td>
<td style="text-align: left;">Dell</td>
</tr>
<tr class="even">
<td style="text-align: left;">Hubert</td>
<td style="text-align: left;">Heijkers</td>
<td style="text-align: left;">IBM</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Ling</td>
<td style="text-align: left;">Jin</td>
<td style="text-align: left;">IBM</td>
</tr>
<tr class="even">
<td style="text-align: left;">Stefan</td>
<td style="text-align: left;">Hagen</td>
<td style="text-align: left;">Individual</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Michael</td>
<td style="text-align: left;">Pizzo</td>
<td style="text-align: left;">Microsoft</td>
</tr>
<tr class="even">
<td style="text-align: left;">Christof</td>
<td style="text-align: left;">Sprenger</td>
<td style="text-align: left;">Microsoft</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Ralf</td>
<td style="text-align: left;">Handl</td>
<td style="text-align: left;">SAP SE</td>
</tr>
<tr class="even">
<td style="text-align: left;">Gerald</td>
<td style="text-align: left;">Krause</td>
<td style="text-align: left;">SAP SE</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Heiko</td>
<td style="text-align: left;">Thei√üen</td>
<td style="text-align: left;">SAP SE</td>
</tr>
</tbody>
</table>
</details>
</details>
<hr />
<details open><summary>
<h1 id="appendix-d-revision-history"><a name="RevisionHistory" href="#RevisionHistory">Appendix D. Revision History</a></h1>
</summary>
<table>
<thead>
<tr class="header">
<th style="text-align: left;">Revision</th>
<th style="text-align: left;">Date</th>
<th style="text-align: left;">Editor</th>
<th style="text-align: left;">Changes Made</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Committee Specification Draft 01</td>
<td style="text-align: left;">2024-02-28</td>
<td style="text-align: left;">Michael Pizzo<br>Ralf Handl<br>Heiko Thei√üen</td>
<td style="text-align: left;">Import material from OData Version 4.01 Part 1: Protocol <br>Changes listed in <a href="#ChangesfromEarlierVersions">section 1.1</a></td>
</tr>
</tbody>
</table>
</details>
<hr />
<details open><summary>
<h1 id="appendix-e-notices"><a name="Notices" href="#Notices">Appendix E. Notices</a></h1>
</summary>
<!-- Required section. Do not modify. -->

<p>Copyright ¬© OASIS Open 2024. All Rights Reserved.</p>
<p>All capitalized terms in the following text have the meanings assigned to them in the OASIS Intellectual Property Rights Policy (the ‚ÄúOASIS IPR Policy‚Äù). The full <a href="https://www.oasis-open.org/policies-guidelines/ipr/">Policy</a> may be found at the OASIS website.</p>
<p>This document and translations of it may be copied and furnished to others, and derivative works that comment on or otherwise explain it or assist in its implementation may be prepared, copied, published, and distributed, in whole or in part, without restriction of any kind, provided that the above copyright notice and this section are included on all such copies and derivative works. However, this document itself may not be modified in any way, including by removing the copyright notice or references to OASIS, except as needed for the purpose of developing any document or deliverable produced by an OASIS Technical Committee (in which case the rules applicable to copyrights, as set forth in the OASIS IPR Policy, must be followed) or as required to translate it into languages other than English.</p>
<p>The limited permissions granted above are perpetual and will not be revoked by OASIS or its successors or assigns.</p>
<p>This document and the information contained herein is provided on an ‚ÄúAS IS‚Äù basis and OASIS DISCLAIMS ALL WARRANTIES, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO ANY WARRANTY THAT THE USE OF THE INFORMATION HEREIN WILL NOT INFRINGE ANY OWNERSHIP RIGHTS OR ANY IMPLIED WARRANTIES OF MERCHANTABILITY OR FITNESS FOR A PARTICULAR PURPOSE.</p>
<p>As stated in the OASIS IPR Policy, the following three paragraphs in brackets apply to OASIS Standards Final Deliverable documents (Committee Specification, Candidate OASIS Standard, OASIS Standard, or Approved Errata).</p>
<p>[OASIS requests that any OASIS Party or any other party that believes it has patent claims that would necessarily be infringed by implementations of this OASIS Standards Final Deliverable, to notify OASIS TC Administrator and provide an indication of its willingness to grant patent licenses to such patent claims in a manner consistent with the IPR Mode of the OASIS Technical Committee that produced this deliverable.]</p>
<p>[OASIS invites any party to contact the OASIS TC Administrator if it is aware of a claim of ownership of any patent claims that would necessarily be infringed by implementations of this OASIS Standards Final Deliverable by a patent holder that is not willing to provide a license to such patent claims in a manner consistent with the IPR Mode of the OASIS Technical Committee that produced this OASIS Standards Final Deliverable. OASIS may include such claims on its website, but disclaims any obligation to do so.]</p>
<p>[OASIS takes no position regarding the validity or scope of any intellectual property or other rights that might be claimed to pertain to the implementation or use of the technology described in this OASIS Standards Final Deliverable or the extent to which any license under such rights might or might not be available; neither does it represent that it has made any effort to identify any such rights. Information on OASIS‚Äô procedures with respect to rights in any document or deliverable produced by an OASIS Technical Committee can be found on the OASIS website. Copies of claims of rights made available for publication and any assurances of licenses to be made available, or the result of an attempt made to obtain a general license or permission for the use of such proprietary rights by implementers or users of this OASIS Standards Final Deliverable, can be obtained from the OASIS TC Administrator. OASIS makes no representation that any information or list of intellectual property rights will at any time be complete, or that any claims in such list are, in fact, Essential Claims.]</p>
<p>The name ‚ÄúOASIS‚Äù is a trademark of <a href="https://www.oasis-open.org/">OASIS</a>, the owner and developer of this specification, and should be used only to refer to the organization and its official outputs. OASIS welcomes reference to, and implementation and use of, specifications, while reserving the right to enforce its marks against misleading uses. Please see <a href="https://www.oasis-open.org/policies-guidelines/trademark/">https://www.oasis-open.org/policies-guidelines/trademark/</a> for above guidance.</p>
</body>
</html>
